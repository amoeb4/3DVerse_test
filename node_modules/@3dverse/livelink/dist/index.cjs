"use strict";var Vs=Object.create;var li=Object.defineProperty;var Us=Object.getOwnPropertyDescriptor;var ks=Object.getOwnPropertyNames;var Is=Object.getPrototypeOf,Ns=Object.prototype.hasOwnProperty;var Bs=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports),ie=(i,t)=>{for(var e in t)li(i,e,{get:t[e],enumerable:!0})},rr=(i,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ks(t))!Ns.call(i,r)&&r!==e&&li(i,r,{get:()=>t[r],enumerable:!(n=Us(t,r))||n.enumerable});return i};var Hs=(i,t,e)=>(e=i!=null?Vs(Is(i)):{},rr(t||!i||!i.__esModule?li(e,"default",{value:i,enumerable:!0}):e,i)),Ys=i=>rr(li({},"__esModule",{value:!0}),i);var ls=Bs((Hn,cs)=>{"use strict";(function(i,t){typeof define=="function"&&define.amd?define([],t):typeof Hn=="object"?cs.exports=t():i.YUVCanvas=t()})(Hn,function(){function i(t){t=t||{},this.canvasElement=t.canvas||document.createElement("canvas"),this.contextOptions=t.contextOptions,this.type=t.type||"yuv420",this.customYUV444=t.customYUV444,this.conversionType=t.conversionType||"rec601",this.width=t.width||640,this.height=t.height||320,this.animationTime=t.animationTime||0,this.canvasElement.width=this.width,this.canvasElement.height=this.height,this.fakeAlphaEnabled=t.fakeAlphaEnabled===!0?1:0,this.initContextGL(),this.contextGL&&(this.initProgram(),this.initBuffers(),this.initTextures()),this.type==="yuv420"?this.drawNextOuptutPictureGL=function(e){var n=this.contextGL,r=this.texturePosBuffer,s=this.uTexturePosBuffer,o=this.vTexturePosBuffer,a=this.yTextureRef,h=this.uTextureRef,c=this.vTextureRef,l=e.yData,d=e.uData,m=e.vData,u=this.width,p=this.height,f=e.yDataPerRow||u,_=e.yRowCnt||p,y=e.uDataPerRow||u/2,M=e.uRowCnt||p/2,v=e.vDataPerRow||y,x=e.vRowCnt||M;n.viewport(0,0,this.viewportWidth||u,this.viewportHeight||p);var E=0,w=0,C=p/_,S=u/f,P=new Float32Array([S,E,w,E,S,C,w,C]);n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,P,n.DYNAMIC_DRAW),this.customYUV444?(C=p/M,S=u/y):(C=p/2/M,S=u/2/y);var R=new Float32Array([S,E,w,E,S,C,w,C]);n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,R,n.DYNAMIC_DRAW),this.customYUV444?(C=p/x,S=u/v):(C=p/2/x,S=u/2/v);var F=new Float32Array([S,E,w,E,S,C,w,C]);n.bindBuffer(n.ARRAY_BUFFER,o),n.bufferData(n.ARRAY_BUFFER,F,n.DYNAMIC_DRAW),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,a),n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,f,_,0,n.LUMINANCE,n.UNSIGNED_BYTE,l),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,h),n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,y,M,0,n.LUMINANCE,n.UNSIGNED_BYTE,d),n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,c),n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,v,x,0,n.LUMINANCE,n.UNSIGNED_BYTE,m),n.drawArrays(n.TRIANGLE_STRIP,0,4)}:this.type==="yuv422"&&(this.drawNextOuptutPictureGL=function(e){var n=this.contextGL,r=this.texturePosBuffer,s=this.textureRef,o=e.data,a=this.width,h=this.height,c=e.dataPerRow||a*2,l=e.rowCnt||h;n.viewport(0,0,a,h);var d=0,m=0,u=h/l,p=a/(c/2),f=new Float32Array([p,d,m,d,p,u,m,u]);n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,f,n.DYNAMIC_DRAW),n.uniform2f(n.getUniformLocation(this.shaderProgram,"resolution"),c,h),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,c,l,0,n.LUMINANCE,n.UNSIGNED_BYTE,o),n.drawArrays(n.TRIANGLE_STRIP,0,4)})}return i.prototype.isWebGL=function(){return this.contextGL},i.prototype.initContextGL=function(){for(var t=this.canvasElement,e=null,n=["webgl","experimental-webgl","moz-webgl","webkit-3d"],r=0;!e&&r<n.length;){var s=n[r];try{this.contextOptions?e=t.getContext(s,this.contextOptions):e=t.getContext(s)}catch{e=null}(!e||typeof e.getParameter!="function")&&(e=null),++r}this.contextGL=e},i.prototype.initProgram=function(){var t=this.contextGL,e,n;this.type==="yuv420"?(e=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join(`
`),n=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","uniform int fakeAlphaEnabled;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","  if(fakeAlphaEnabled == 1) {","     highp float maxIntensity = max(max(gl_FragColor.r, gl_FragColor.g), gl_FragColor.b);","     if(maxIntensity < 0.1) gl_FragColor.a = maxIntensity;","  }","}"].join(`
`)):this.type==="yuv422"&&(e=["attribute vec4 vertexPos;","attribute vec4 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","}"].join(`
`),n=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform highp vec2 resolution;","uniform mat4 YUV2RGB;","uniform int fakeAlphaEnabled;","void main(void) {","  highp float texPixX = 1.0 / resolution.x;","  highp float logPixX = 2.0 / resolution.x;","  highp float logHalfPixX = 4.0 / resolution.x;","  highp float steps = floor(textureCoord.x / logPixX);","  highp float uvSteps = floor(textureCoord.x / logHalfPixX);","  highp float y = texture2D(sampler, vec2((logPixX * steps) + texPixX, textureCoord.y)).r;","  highp float u = texture2D(sampler, vec2((logHalfPixX * uvSteps), textureCoord.y)).r;","  highp float v = texture2D(sampler, vec2((logHalfPixX * uvSteps) + texPixX + texPixX, textureCoord.y)).r;","  gl_FragColor = vec4(y, u, v, 1.0) * YUV2RGB;","  if(fakeAlphaEnabled == 1) {","     highp float maxIntensity = max(max(gl_FragColor.r, gl_FragColor.g), gl_FragColor.b);","     if(maxIntensity < 0.1) gl_FragColor.a = maxIntensity;","  }","}"].join(`
`));var r=[];this.conversionType=="rec709"?r=[1.16438,0,1.79274,-.97295,1.16438,-.21325,-.53291,.30148,1.16438,2.1124,0,-1.1334,0,0,0,1]:r=[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];var s=t.createShader(t.VERTEX_SHADER);t.shaderSource(s,e),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)||console.error("Vertex shader failed to compile: "+t.getShaderInfoLog(s));var o=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(o,n),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)||console.error("Fragment shader failed to compile: "+t.getShaderInfoLog(o));var a=t.createProgram();t.attachShader(a,s),t.attachShader(a,o),t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)||console.error("Program failed to compile: "+t.getProgramInfoLog(a)),t.useProgram(a);var h=t.getUniformLocation(a,"YUV2RGB");t.uniformMatrix4fv(h,!1,r);var c=t.getUniformLocation(a,"fakeAlphaEnabled");t.uniform1i(c,this.fakeAlphaEnabled),this.shaderProgram=a},i.prototype.initBuffers=function(){var t=this.contextGL,e=this.shaderProgram,n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),t.STATIC_DRAW);var r=t.getAttribLocation(e,"vertexPos");if(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0),this.animationTime){var s=this.animationTime,o=0,a=15,h=function(){o+=a;var f=1*o/s;o>=s?f=1:setTimeout(h,a);var _=-1*f,y=1*f,M=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,M),t.bufferData(t.ARRAY_BUFFER,new Float32Array([y,y,_,y,y,_,_,_]),t.STATIC_DRAW);var v=t.getAttribLocation(e,"vertexPos");t.enableVertexAttribArray(v),t.vertexAttribPointer(v,2,t.FLOAT,!1,0,0);try{t.drawArrays(t.TRIANGLE_STRIP,0,4)}catch{}};h()}var c=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var l=t.getAttribLocation(e,"texturePos");if(t.enableVertexAttribArray(l),t.vertexAttribPointer(l,2,t.FLOAT,!1,0,0),this.texturePosBuffer=c,this.type==="yuv420"){var d=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var m=t.getAttribLocation(e,"uTexturePos");t.enableVertexAttribArray(m),t.vertexAttribPointer(m,2,t.FLOAT,!1,0,0),this.uTexturePosBuffer=d;var u=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var p=t.getAttribLocation(e,"vTexturePos");t.enableVertexAttribArray(p),t.vertexAttribPointer(p,2,t.FLOAT,!1,0,0),this.vTexturePosBuffer=u}},i.prototype.initTextures=function(){var t=this.contextGL,e=this.shaderProgram;if(this.type==="yuv420"){var n=this.initTexture(),r=t.getUniformLocation(e,"ySampler");t.uniform1i(r,0),this.yTextureRef=n;var s=this.initTexture(),o=t.getUniformLocation(e,"uSampler");t.uniform1i(o,1),this.uTextureRef=s;var a=this.initTexture(),h=t.getUniformLocation(e,"vSampler");t.uniform1i(h,2),this.vTextureRef=a}else if(this.type==="yuv422"){var c=this.initTexture(),l=t.getUniformLocation(e,"sampler");t.uniform1i(l,0),this.textureRef=c}},i.prototype.initTexture=function(){var t=this.contextGL,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),e},i.prototype.drawNextOutputPicture=function(t,e,n,r){var s=this.contextGL;s?this.drawNextOuptutPictureGL(t,e,n,r):this.drawNextOuptutPictureRGBA(t,e,n,r)},i.prototype.drawNextOuptutPictureRGBA=function(t,e,o,r){var s=this.canvasElement,o=null,a=r,h=s.getContext("2d"),c=h.getImageData(0,0,t,e);c.data.set(a),o===null?h.putImageData(c,0,0):h.putImageData(c,-o.left,-o.top,0,0,o.width,o.height)},i})});var Qh={};ie(Qh,{ActivityDetectedEvent:()=>Ie,CameraController:()=>zn,CameraControllerPresets:()=>qi,CameraProjection:()=>Fn,Client:()=>ve,ClientJoinedEvent:()=>Ne,ClientLeftEvent:()=>Be,Context2D:()=>ri,ContextProvider:()=>de,ContextWebGL:()=>si,DisconnectedEvent:()=>Ue,EncodedFrameConsumer:()=>le,Entity:()=>kt,EntityHoveredEvent:()=>qe,EntityPickedEvent:()=>je,EntityUpdatedEvent:()=>Ut,EntityVisibilityChangedEvent:()=>ye,GamepadAxis:()=>tt,GamepadButton:()=>Ah,GamepadInputRelay:()=>re,GamepadJoystick:()=>Mi,InactivityWarningEvent:()=>ke,InvalidSizeError:()=>di,Keyboard:()=>Ye,Livelink:()=>yt,Mouse:()=>He,OffscreenSurface:()=>Xn,OutOfBoundsError:()=>mi,Rect:()=>Dt,RelativeRect:()=>ct,RenderingSurface:()=>jn,RenderingSurfaceBase:()=>Gt,RenderingSurfaceResizedEvent:()=>me,Scene:()=>Le,ScriptEventEmitted:()=>Fe,ScriptEventReceived:()=>ze,Session:()=>ge,SoftwareDecoder:()=>Yn,TO_REMOVE__ViewportsAddedEvent:()=>Ve,Viewport:()=>gn,VirtualSurface:()=>qn,WebCodecsDecoder:()=>Gn,convertRawFrameMetaDataToFrameMetaData:()=>ln});module.exports=Ys(Qh);var Gs=typeof process<"u"&&process.versions!=null&&process.versions.node!=null,cn=class Ft{static#t=null;static#i=null;static get Core(){if(!Ft.#t)throw new Error("Livelink core not initialized");return Ft.#t}static load(t="prod"){return Ft.#i||(Ft.#i=Ft.#e(t)),Ft.#i}static async#e(t){let e=await Ft.#n(t),{LivelinkCore:n}=await e();Ft.#t=n;let r={prod:"#FFC700",dev:"#36D399",debug:"#FB4949"};console.info(`%c Livelink Core initialized \u{1F680} %c ${n.VERSION} %c ${n.COMMIT_SHA} %c${t}`,"background: #080A12; color: #FFC700; font-weight: bold; padding: 8px; padding-right: 164px; border-radius: 16px; margin: 16px 0 16px 0","background: #9EA6D6; color: #0A1018; font-weight: bold; padding: 1px; padding-right: 0px; margin-left: -160px; border-radius: 16px 0 0 16px;","background: #6973A8; color: #0A1018; font-weight: bold; padding: 1px; padding-left: 0; border-radius: 0 16px 16px 0;",`background: ${r[t]}; color: #000; font-weight: bold; padding: 6px 16px; border: 4px solid #080A12; border-radius: 16px; margin-left: 16px`)}static async#n(t){let e="https://cdn.3dverse.com/livelink/core/1.0/"+(t!=="prod"?`core.${t}.mjs`:"core.mjs");if(!Gs)return new Function("return import('"+e+"')");let n=await(await fetch(e)).text(),r=await new Function("return import('node:vm')")();return r.SourceTextModule?(console.info("Using experimental VM SourceTextModule to load Livelink core"),async()=>{let s=new r.SourceTextModule(n,{identifier:e});return await s.link(()=>{}),await s.evaluate(),s.namespace}):new Function("return import('data:text/javascript;base64,"+btoa(n)+"')")}constructor(){}};typeof window<"u"&&(window.__LIVELINK__||(window.__LIVELINK__={}),Object.prototype.hasOwnProperty.call(window.__LIVELINK__,"@3dverse/livelink.core")?console.warn("\u26A0\uFE0F WARNING \u26A0\uFE0F Multiple instances of Livelink Core being imported."):window.__LIVELINK__["@3dverse/livelink.core"]="1.1.4");function ln({raw_frame_meta_data:i,client_id:t,entity_registry:e,viewports:n}){let r={renderer_timestamp:i.renderer_timestamp,frame_counter:i.frame_counter,viewport_layout_camera_entities:[],other_clients_camera_entities:[]};for(let s of i.clients){let o=s.client_id===t;for(let a of s.viewports){let h=e.get({entity_rtid:a.camera_rtid});if(!h)continue;let c=n.find(l=>l.camera_projection?.camera_entity.rtid===h.rtid);if(o){c&&r.viewport_layout_camera_entities.push({camera_entity:h,world_from_view_matrix:a.ws_from_ls,world_position:sr(a.ws_from_ls),world_orientation:or(a.ws_from_ls),viewport:c});continue}c&&c.is_camera_controlled_by_current_client||r.other_clients_camera_entities.push({camera_entity:h,world_from_view_matrix:a.ws_from_ls,world_position:sr(a.ws_from_ls),world_orientation:or(a.ws_from_ls)})}}return r}function sr(i){return[i[12],i[13],i[14]]}function or(i){let t=[0,0,0,0],e=i[0],n=i[1],r=i[2],s=i[4],o=i[5],a=i[6],h=i[8],c=i[9],l=i[10],d=e+o+l;if(d>0){let m=.5/Math.sqrt(d+1);t[3]=.25/m,t[0]=(a-c)*m,t[1]=(h-r)*m,t[2]=(n-s)*m}else if(e>o&&e>l){let m=2*Math.sqrt(1+e-o-l);t[3]=(a-c)/m,t[0]=.25*m,t[1]=(n+s)/m,t[2]=(r+h)/m}else if(o>l){let m=2*Math.sqrt(1+o-e-l);t[3]=(h-r)/m,t[0]=(n+s)/m,t[1]=.25*m,t[2]=(a+c)/m}else{let m=2*Math.sqrt(1+l-e-o);t[3]=(n-s)/m,t[0]=(r+h)/m,t[1]=(a+c)/m,t[2]=.25*m}return t}var Dt=class{left;top;right;bottom;width;height;constructor({left:t=0,top:e=0,right:n,bottom:r,width:s,height:o}){this.#t({left:t,top:e,right:n,bottom:r,width:s,height:o})||console.error("Invalid rect",this),this.left=t,this.top=e,this.right=n!==void 0?n:t+s,this.bottom=r!==void 0?r:e+o,this.width=s!==void 0?s:n-t,this.height=o!==void 0?o:r-e}#t({left:t=0,top:e=0,right:n,bottom:r,width:s,height:o}){return!(t<0||e<0||n!==void 0&&n<0||r!==void 0&&r<0||s!==void 0&&s<0||o!==void 0&&o<0||n===void 0&&s===void 0||r===void 0&&o===void 0||n!==void 0&&t>=n||r!==void 0&&e>=r||s!==void 0&&n!==void 0&&t+s!==n||o!==void 0&&r!==void 0&&e+o!==r)}},di=class extends Error{rect;constructor(t){super(`Element has an invalid size : [${t.width} x ${t.height}]`),this.rect=t}},mi=class extends Error{rect;parentRect;constructor(t,e){super("Element MUST be contained into its parent bounds."),this.rect=t,this.parentRect=e}},ct=class i extends Dt{static default=Object.freeze(new i({left:0,top:0,width:1,height:1}));static from_dom_elements({element:t,parent:e}){let n=t.getBoundingClientRect(),r=e.getBoundingClientRect();if(!n.width||!n.height)throw new di(n);let s={left:n.left-r.left,top:n.top-r.top};if(s.left<0||s.top<0||s.left+n.width>r.left+r.width||s.top+n.height>r.top+r.height)throw new mi(n,r);let o=6;return new i({left:parseFloat((s.left/r.width).toPrecision(o)),top:parseFloat((s.top/r.height).toPrecision(o)),width:parseFloat((n.width/r.width).toPrecision(o)),height:parseFloat((n.height/r.height).toPrecision(o))})}constructor({left:t=0,top:e=0,right:n,bottom:r,width:s=1,height:o=1}){super({left:t,top:e,right:n,bottom:r,width:s,height:o}),this.#t()||console.error("Relative rect values must fall in [0,1] range",this)}#t(){return this.left<1&&this.top<1&&this.right<=1&&this.bottom<=1&&this.width<=1&&this.height<=1}};var ui=class{#t;#i=[];#e=[0,0];#n=[32,32];#r=!0;get dimensions(){return this.#e}get width(){return this.#e[0]}get height(){return this.#e[1]}get viewports(){let t=[];for(let e of this.#i)t.push(...e.viewports);return t}get#o(){let t=[];for(let e of this.#i)t.push(...e._getViewportConfigs({width:this.width,height:this.height}));return t.sort((e,n)=>e.z_index-n.z_index)}constructor(t){this.#t=t}init(){this.#h()}release(){for(let t of this.#i)t.release()}consumeDecodedFrame({decoded_frame:t}){for(let e of this.#i)e.drawFrame({decoded_frame:t})}addViewport({viewport:t}){this.#a({viewport:t}),this.#h()}addViewports({viewports:t}){for(let e of t)this.#a({viewport:e});this.#h()}removeViewport({viewport:t}){let e=this.#i.indexOf(t.rendering_surface);if(e===-1)throw new Error("Viewport without registered surface");let n=this.#i[e];n.removeViewport({viewport:t}),t.release(),n.viewports.length===0&&(n.removeEventListener("on-rendering-surface-resized",this.#h),n.release(),this.#i.splice(e,1)),this.#h()}_computeRemoteCanvasSize({codec:t}){if(t==="h265"){let e=[64,64];this.#n=e,this.#d()}return this.#e}#s(){return this.#i.every(t=>t.isValid())}#a({viewport:t}){t.rendering_surface.addViewport({viewport:t}),!this.#i.includes(t.rendering_surface)&&this.#c({surface:t.rendering_surface})}#c({surface:t}){t.addEventListener("on-rendering-surface-resized",this.#h),this.#i.push(t)}#h=()=>{this.#d(),this.#t.isConfigured()&&this.#s()&&(this.#r&&(this.#e,this.#t._resize({size:this.#e}),this.#r=!1),this.#o,this.#t._setViewports({viewport_configs:this.#o}))};#l=(t,e)=>Math.floor(t)+(Math.floor(t)%e===0?0:e-Math.floor(t)%e);#d(){let{offset:t,width:e,height:n}=this.#m(),r=[this.#l(e,this.#n[0]),this.#l(n,this.#n[1])];this.#r||=r[0]!=this.#e[0]||r[1]!=this.dimensions[1],this.#e=r,this.#u({offset:t,width:this.#e[0],height:this.#e[1]})}#m(){let t=[Number.MAX_VALUE,Number.MAX_VALUE],e=[0,0];for(let s of this.#i){let o=s.getBoundingRect();t[0]=Math.min(t[0],o.left),t[1]=Math.min(t[1],o.top),e[0]=Math.max(e[0],o.right),e[1]=Math.max(e[1],o.bottom)}let n=e[0]-t[0],r=e[1]-t[1];return{offset:t,width:n,height:r}}#u({offset:t,width:e,height:n}){for(let r of this.#i){let s=r.getBoundingRect();r.relative_rect=new ct({left:(s.left-t[0])/e,top:(s.top-t[1])/n,width:(s.right-s.left)/e,height:(s.bottom-s.top)/n})}}};var Vt={};ie(Vt,{ARRAY_TYPE:()=>q,EPSILON:()=>k,RANDOM:()=>Lt,equals:()=>Ws,setMatrixArrayType:()=>qs,toRadian:()=>Xs});var k=1e-6,q=typeof Float32Array<"u"?Float32Array:Array,Lt=Math.random;function qs(i){q=i}var js=Math.PI/180;function Xs(i){return i*js}function Ws(i,t){return Math.abs(i-t)<=k*Math.max(1,Math.abs(i),Math.abs(t))}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var fe={};ie(fe,{add:()=>vo,adjoint:()=>no,clone:()=>Ks,copy:()=>Qs,create:()=>dn,determinant:()=>ro,equals:()=>wo,exactEquals:()=>Eo,frob:()=>yo,fromMat2d:()=>mo,fromMat4:()=>Zs,fromQuat:()=>uo,fromRotation:()=>co,fromScaling:()=>lo,fromTranslation:()=>ho,fromValues:()=>$s,identity:()=>to,invert:()=>io,mul:()=>Co,multiply:()=>ar,multiplyScalar:()=>go,multiplyScalarAndAdd:()=>xo,normalFromMat4:()=>po,projection:()=>_o,rotate:()=>oo,scale:()=>ao,set:()=>Js,str:()=>fo,sub:()=>Mo,subtract:()=>hr,translate:()=>so,transpose:()=>eo});function dn(){var i=new q(9);return q!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Zs(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[4],i[4]=t[5],i[5]=t[6],i[6]=t[8],i[7]=t[9],i[8]=t[10],i}function Ks(i){var t=new q(9);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t}function Qs(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i}function $s(i,t,e,n,r,s,o,a,h){var c=new q(9);return c[0]=i,c[1]=t,c[2]=e,c[3]=n,c[4]=r,c[5]=s,c[6]=o,c[7]=a,c[8]=h,c}function Js(i,t,e,n,r,s,o,a,h,c){return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i[4]=s,i[5]=o,i[6]=a,i[7]=h,i[8]=c,i}function to(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i}function eo(i,t){if(i===t){var e=t[1],n=t[2],r=t[5];i[1]=t[3],i[2]=t[6],i[3]=e,i[5]=t[7],i[6]=n,i[7]=r}else i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8];return i}function io(i,t){var e=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],h=t[6],c=t[7],l=t[8],d=l*o-a*c,m=-l*s+a*h,u=c*s-o*h,p=e*d+n*m+r*u;return p?(p=1/p,i[0]=d*p,i[1]=(-l*n+r*c)*p,i[2]=(a*n-r*o)*p,i[3]=m*p,i[4]=(l*e-r*h)*p,i[5]=(-a*e+r*s)*p,i[6]=u*p,i[7]=(-c*e+n*h)*p,i[8]=(o*e-n*s)*p,i):null}function no(i,t){var e=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],h=t[6],c=t[7],l=t[8];return i[0]=o*l-a*c,i[1]=r*c-n*l,i[2]=n*a-r*o,i[3]=a*h-s*l,i[4]=e*l-r*h,i[5]=r*s-e*a,i[6]=s*c-o*h,i[7]=n*h-e*c,i[8]=e*o-n*s,i}function ro(i){var t=i[0],e=i[1],n=i[2],r=i[3],s=i[4],o=i[5],a=i[6],h=i[7],c=i[8];return t*(c*s-o*h)+e*(-c*r+o*a)+n*(h*r-s*a)}function ar(i,t,e){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],d=t[8],m=e[0],u=e[1],p=e[2],f=e[3],_=e[4],y=e[5],M=e[6],v=e[7],x=e[8];return i[0]=m*n+u*o+p*c,i[1]=m*r+u*a+p*l,i[2]=m*s+u*h+p*d,i[3]=f*n+_*o+y*c,i[4]=f*r+_*a+y*l,i[5]=f*s+_*h+y*d,i[6]=M*n+v*o+x*c,i[7]=M*r+v*a+x*l,i[8]=M*s+v*h+x*d,i}function so(i,t,e){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],d=t[8],m=e[0],u=e[1];return i[0]=n,i[1]=r,i[2]=s,i[3]=o,i[4]=a,i[5]=h,i[6]=m*n+u*o+c,i[7]=m*r+u*a+l,i[8]=m*s+u*h+d,i}function oo(i,t,e){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],d=t[8],m=Math.sin(e),u=Math.cos(e);return i[0]=u*n+m*o,i[1]=u*r+m*a,i[2]=u*s+m*h,i[3]=u*o-m*n,i[4]=u*a-m*r,i[5]=u*h-m*s,i[6]=c,i[7]=l,i[8]=d,i}function ao(i,t,e){var n=e[0],r=e[1];return i[0]=n*t[0],i[1]=n*t[1],i[2]=n*t[2],i[3]=r*t[3],i[4]=r*t[4],i[5]=r*t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i}function ho(i,t){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=t[0],i[7]=t[1],i[8]=1,i}function co(i,t){var e=Math.sin(t),n=Math.cos(t);return i[0]=n,i[1]=e,i[2]=0,i[3]=-e,i[4]=n,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i}function lo(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=t[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1,i}function mo(i,t){return i[0]=t[0],i[1]=t[1],i[2]=0,i[3]=t[2],i[4]=t[3],i[5]=0,i[6]=t[4],i[7]=t[5],i[8]=1,i}function uo(i,t){var e=t[0],n=t[1],r=t[2],s=t[3],o=e+e,a=n+n,h=r+r,c=e*o,l=n*o,d=n*a,m=r*o,u=r*a,p=r*h,f=s*o,_=s*a,y=s*h;return i[0]=1-d-p,i[3]=l-y,i[6]=m+_,i[1]=l+y,i[4]=1-c-p,i[7]=u-f,i[2]=m-_,i[5]=u+f,i[8]=1-c-d,i}function po(i,t){var e=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],h=t[6],c=t[7],l=t[8],d=t[9],m=t[10],u=t[11],p=t[12],f=t[13],_=t[14],y=t[15],M=e*a-n*o,v=e*h-r*o,x=e*c-s*o,E=n*h-r*a,w=n*c-s*a,C=r*c-s*h,S=l*f-d*p,P=l*_-m*p,R=l*y-u*p,F=d*_-m*f,O=d*y-u*f,V=m*y-u*_,A=M*V-v*O+x*F+E*R-w*P+C*S;return A?(A=1/A,i[0]=(a*V-h*O+c*F)*A,i[1]=(h*R-o*V-c*P)*A,i[2]=(o*O-a*R+c*S)*A,i[3]=(r*O-n*V-s*F)*A,i[4]=(e*V-r*R+s*P)*A,i[5]=(n*R-e*O-s*S)*A,i[6]=(f*C-_*w+y*E)*A,i[7]=(_*x-p*C-y*v)*A,i[8]=(p*w-f*x+y*M)*A,i):null}function _o(i,t,e){return i[0]=2/t,i[1]=0,i[2]=0,i[3]=0,i[4]=-2/e,i[5]=0,i[6]=-1,i[7]=1,i[8]=1,i}function fo(i){return"mat3("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+")"}function yo(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])}function vo(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i[4]=t[4]+e[4],i[5]=t[5]+e[5],i[6]=t[6]+e[6],i[7]=t[7]+e[7],i[8]=t[8]+e[8],i}function hr(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i[3]=t[3]-e[3],i[4]=t[4]-e[4],i[5]=t[5]-e[5],i[6]=t[6]-e[6],i[7]=t[7]-e[7],i[8]=t[8]-e[8],i}function go(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i[4]=t[4]*e,i[5]=t[5]*e,i[6]=t[6]*e,i[7]=t[7]*e,i[8]=t[8]*e,i}function xo(i,t,e,n){return i[0]=t[0]+e[0]*n,i[1]=t[1]+e[1]*n,i[2]=t[2]+e[2]*n,i[3]=t[3]+e[3]*n,i[4]=t[4]+e[4]*n,i[5]=t[5]+e[5]*n,i[6]=t[6]+e[6]*n,i[7]=t[7]+e[7]*n,i[8]=t[8]+e[8]*n,i}function Eo(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]}function wo(i,t){var e=i[0],n=i[1],r=i[2],s=i[3],o=i[4],a=i[5],h=i[6],c=i[7],l=i[8],d=t[0],m=t[1],u=t[2],p=t[3],f=t[4],_=t[5],y=t[6],M=t[7],v=t[8];return Math.abs(e-d)<=k*Math.max(1,Math.abs(e),Math.abs(d))&&Math.abs(n-m)<=k*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(r-u)<=k*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-p)<=k*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(o-f)<=k*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-_)<=k*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(h-y)<=k*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(c-M)<=k*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(l-v)<=k*Math.max(1,Math.abs(l),Math.abs(v))}var Co=ar,Mo=hr;var J={};ie(J,{add:()=>ha,adjoint:()=>Do,clone:()=>bo,copy:()=>Ro,create:()=>To,determinant:()=>zo,equals:()=>ma,exactEquals:()=>da,frob:()=>aa,fromQuat:()=>Qo,fromQuat2:()=>jo,fromRotation:()=>Ho,fromRotationTranslation:()=>dr,fromRotationTranslationScale:()=>Zo,fromRotationTranslationScaleOrigin:()=>Ko,fromScaling:()=>Bo,fromTranslation:()=>No,fromValues:()=>Ao,fromXRotation:()=>Yo,fromYRotation:()=>Go,fromZRotation:()=>qo,frustum:()=>$o,getRotation:()=>Wo,getScaling:()=>mr,getTranslation:()=>Xo,identity:()=>cr,invert:()=>Oo,lookAt:()=>ra,mul:()=>ua,multiply:()=>lr,multiplyScalar:()=>ca,multiplyScalarAndAdd:()=>la,ortho:()=>ia,orthoNO:()=>pr,orthoZO:()=>na,perspective:()=>Jo,perspectiveFromFieldOfView:()=>ea,perspectiveNO:()=>ur,perspectiveZO:()=>ta,rotate:()=>Vo,rotateX:()=>Uo,rotateY:()=>ko,rotateZ:()=>Io,scale:()=>Lo,set:()=>So,str:()=>oa,sub:()=>pa,subtract:()=>_r,targetTo:()=>sa,translate:()=>Fo,transpose:()=>Po});function To(){var i=new q(16);return q!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function bo(i){var t=new q(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t}function Ro(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function Ao(i,t,e,n,r,s,o,a,h,c,l,d,m,u,p,f){var _=new q(16);return _[0]=i,_[1]=t,_[2]=e,_[3]=n,_[4]=r,_[5]=s,_[6]=o,_[7]=a,_[8]=h,_[9]=c,_[10]=l,_[11]=d,_[12]=m,_[13]=u,_[14]=p,_[15]=f,_}function So(i,t,e,n,r,s,o,a,h,c,l,d,m,u,p,f,_){return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i[4]=s,i[5]=o,i[6]=a,i[7]=h,i[8]=c,i[9]=l,i[10]=d,i[11]=m,i[12]=u,i[13]=p,i[14]=f,i[15]=_,i}function cr(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Po(i,t){if(i===t){var e=t[1],n=t[2],r=t[3],s=t[6],o=t[7],a=t[11];i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=e,i[6]=t[9],i[7]=t[13],i[8]=n,i[9]=s,i[11]=t[14],i[12]=r,i[13]=o,i[14]=a}else i[0]=t[0],i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=t[1],i[5]=t[5],i[6]=t[9],i[7]=t[13],i[8]=t[2],i[9]=t[6],i[10]=t[10],i[11]=t[14],i[12]=t[3],i[13]=t[7],i[14]=t[11],i[15]=t[15];return i}function Oo(i,t){var e=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],h=t[6],c=t[7],l=t[8],d=t[9],m=t[10],u=t[11],p=t[12],f=t[13],_=t[14],y=t[15],M=e*a-n*o,v=e*h-r*o,x=e*c-s*o,E=n*h-r*a,w=n*c-s*a,C=r*c-s*h,S=l*f-d*p,P=l*_-m*p,R=l*y-u*p,F=d*_-m*f,O=d*y-u*f,V=m*y-u*_,A=M*V-v*O+x*F+E*R-w*P+C*S;return A?(A=1/A,i[0]=(a*V-h*O+c*F)*A,i[1]=(r*O-n*V-s*F)*A,i[2]=(f*C-_*w+y*E)*A,i[3]=(m*w-d*C-u*E)*A,i[4]=(h*R-o*V-c*P)*A,i[5]=(e*V-r*R+s*P)*A,i[6]=(_*x-p*C-y*v)*A,i[7]=(l*C-m*x+u*v)*A,i[8]=(o*O-a*R+c*S)*A,i[9]=(n*R-e*O-s*S)*A,i[10]=(p*w-f*x+y*M)*A,i[11]=(d*x-l*w-u*M)*A,i[12]=(a*P-o*F-h*S)*A,i[13]=(e*F-n*P+r*S)*A,i[14]=(f*v-p*E-_*M)*A,i[15]=(l*E-d*v+m*M)*A,i):null}function Do(i,t){var e=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],h=t[6],c=t[7],l=t[8],d=t[9],m=t[10],u=t[11],p=t[12],f=t[13],_=t[14],y=t[15];return i[0]=a*(m*y-u*_)-d*(h*y-c*_)+f*(h*u-c*m),i[1]=-(n*(m*y-u*_)-d*(r*y-s*_)+f*(r*u-s*m)),i[2]=n*(h*y-c*_)-a*(r*y-s*_)+f*(r*c-s*h),i[3]=-(n*(h*u-c*m)-a*(r*u-s*m)+d*(r*c-s*h)),i[4]=-(o*(m*y-u*_)-l*(h*y-c*_)+p*(h*u-c*m)),i[5]=e*(m*y-u*_)-l*(r*y-s*_)+p*(r*u-s*m),i[6]=-(e*(h*y-c*_)-o*(r*y-s*_)+p*(r*c-s*h)),i[7]=e*(h*u-c*m)-o*(r*u-s*m)+l*(r*c-s*h),i[8]=o*(d*y-u*f)-l*(a*y-c*f)+p*(a*u-c*d),i[9]=-(e*(d*y-u*f)-l*(n*y-s*f)+p*(n*u-s*d)),i[10]=e*(a*y-c*f)-o*(n*y-s*f)+p*(n*c-s*a),i[11]=-(e*(a*u-c*d)-o*(n*u-s*d)+l*(n*c-s*a)),i[12]=-(o*(d*_-m*f)-l*(a*_-h*f)+p*(a*m-h*d)),i[13]=e*(d*_-m*f)-l*(n*_-r*f)+p*(n*m-r*d),i[14]=-(e*(a*_-h*f)-o*(n*_-r*f)+p*(n*h-r*a)),i[15]=e*(a*m-h*d)-o*(n*m-r*d)+l*(n*h-r*a),i}function zo(i){var t=i[0],e=i[1],n=i[2],r=i[3],s=i[4],o=i[5],a=i[6],h=i[7],c=i[8],l=i[9],d=i[10],m=i[11],u=i[12],p=i[13],f=i[14],_=i[15],y=t*o-e*s,M=t*a-n*s,v=t*h-r*s,x=e*a-n*o,E=e*h-r*o,w=n*h-r*a,C=c*p-l*u,S=c*f-d*u,P=c*_-m*u,R=l*f-d*p,F=l*_-m*p,O=d*_-m*f;return y*O-M*F+v*R+x*P-E*S+w*C}function lr(i,t,e){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],d=t[8],m=t[9],u=t[10],p=t[11],f=t[12],_=t[13],y=t[14],M=t[15],v=e[0],x=e[1],E=e[2],w=e[3];return i[0]=v*n+x*a+E*d+w*f,i[1]=v*r+x*h+E*m+w*_,i[2]=v*s+x*c+E*u+w*y,i[3]=v*o+x*l+E*p+w*M,v=e[4],x=e[5],E=e[6],w=e[7],i[4]=v*n+x*a+E*d+w*f,i[5]=v*r+x*h+E*m+w*_,i[6]=v*s+x*c+E*u+w*y,i[7]=v*o+x*l+E*p+w*M,v=e[8],x=e[9],E=e[10],w=e[11],i[8]=v*n+x*a+E*d+w*f,i[9]=v*r+x*h+E*m+w*_,i[10]=v*s+x*c+E*u+w*y,i[11]=v*o+x*l+E*p+w*M,v=e[12],x=e[13],E=e[14],w=e[15],i[12]=v*n+x*a+E*d+w*f,i[13]=v*r+x*h+E*m+w*_,i[14]=v*s+x*c+E*u+w*y,i[15]=v*o+x*l+E*p+w*M,i}function Fo(i,t,e){var n=e[0],r=e[1],s=e[2],o,a,h,c,l,d,m,u,p,f,_,y;return t===i?(i[12]=t[0]*n+t[4]*r+t[8]*s+t[12],i[13]=t[1]*n+t[5]*r+t[9]*s+t[13],i[14]=t[2]*n+t[6]*r+t[10]*s+t[14],i[15]=t[3]*n+t[7]*r+t[11]*s+t[15]):(o=t[0],a=t[1],h=t[2],c=t[3],l=t[4],d=t[5],m=t[6],u=t[7],p=t[8],f=t[9],_=t[10],y=t[11],i[0]=o,i[1]=a,i[2]=h,i[3]=c,i[4]=l,i[5]=d,i[6]=m,i[7]=u,i[8]=p,i[9]=f,i[10]=_,i[11]=y,i[12]=o*n+l*r+p*s+t[12],i[13]=a*n+d*r+f*s+t[13],i[14]=h*n+m*r+_*s+t[14],i[15]=c*n+u*r+y*s+t[15]),i}function Lo(i,t,e){var n=e[0],r=e[1],s=e[2];return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i[4]=t[4]*r,i[5]=t[5]*r,i[6]=t[6]*r,i[7]=t[7]*r,i[8]=t[8]*s,i[9]=t[9]*s,i[10]=t[10]*s,i[11]=t[11]*s,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function Vo(i,t,e,n){var r=n[0],s=n[1],o=n[2],a=Math.hypot(r,s,o),h,c,l,d,m,u,p,f,_,y,M,v,x,E,w,C,S,P,R,F,O,V,A,z;return a<k?null:(a=1/a,r*=a,s*=a,o*=a,h=Math.sin(e),c=Math.cos(e),l=1-c,d=t[0],m=t[1],u=t[2],p=t[3],f=t[4],_=t[5],y=t[6],M=t[7],v=t[8],x=t[9],E=t[10],w=t[11],C=r*r*l+c,S=s*r*l+o*h,P=o*r*l-s*h,R=r*s*l-o*h,F=s*s*l+c,O=o*s*l+r*h,V=r*o*l+s*h,A=s*o*l-r*h,z=o*o*l+c,i[0]=d*C+f*S+v*P,i[1]=m*C+_*S+x*P,i[2]=u*C+y*S+E*P,i[3]=p*C+M*S+w*P,i[4]=d*R+f*F+v*O,i[5]=m*R+_*F+x*O,i[6]=u*R+y*F+E*O,i[7]=p*R+M*F+w*O,i[8]=d*V+f*A+v*z,i[9]=m*V+_*A+x*z,i[10]=u*V+y*A+E*z,i[11]=p*V+M*A+w*z,t!==i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i)}function Uo(i,t,e){var n=Math.sin(e),r=Math.cos(e),s=t[4],o=t[5],a=t[6],h=t[7],c=t[8],l=t[9],d=t[10],m=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=s*r+c*n,i[5]=o*r+l*n,i[6]=a*r+d*n,i[7]=h*r+m*n,i[8]=c*r-s*n,i[9]=l*r-o*n,i[10]=d*r-a*n,i[11]=m*r-h*n,i}function ko(i,t,e){var n=Math.sin(e),r=Math.cos(e),s=t[0],o=t[1],a=t[2],h=t[3],c=t[8],l=t[9],d=t[10],m=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=s*r-c*n,i[1]=o*r-l*n,i[2]=a*r-d*n,i[3]=h*r-m*n,i[8]=s*n+c*r,i[9]=o*n+l*r,i[10]=a*n+d*r,i[11]=h*n+m*r,i}function Io(i,t,e){var n=Math.sin(e),r=Math.cos(e),s=t[0],o=t[1],a=t[2],h=t[3],c=t[4],l=t[5],d=t[6],m=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=s*r+c*n,i[1]=o*r+l*n,i[2]=a*r+d*n,i[3]=h*r+m*n,i[4]=c*r-s*n,i[5]=l*r-o*n,i[6]=d*r-a*n,i[7]=m*r-h*n,i}function No(i,t){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i}function Bo(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Ho(i,t,e){var n=e[0],r=e[1],s=e[2],o=Math.hypot(n,r,s),a,h,c;return o<k?null:(o=1/o,n*=o,r*=o,s*=o,a=Math.sin(t),h=Math.cos(t),c=1-h,i[0]=n*n*c+h,i[1]=r*n*c+s*a,i[2]=s*n*c-r*a,i[3]=0,i[4]=n*r*c-s*a,i[5]=r*r*c+h,i[6]=s*r*c+n*a,i[7]=0,i[8]=n*s*c+r*a,i[9]=r*s*c-n*a,i[10]=s*s*c+h,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}function Yo(i,t){var e=Math.sin(t),n=Math.cos(t);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n,i[6]=e,i[7]=0,i[8]=0,i[9]=-e,i[10]=n,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Go(i,t){var e=Math.sin(t),n=Math.cos(t);return i[0]=n,i[1]=0,i[2]=-e,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=e,i[9]=0,i[10]=n,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function qo(i,t){var e=Math.sin(t),n=Math.cos(t);return i[0]=n,i[1]=e,i[2]=0,i[3]=0,i[4]=-e,i[5]=n,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function dr(i,t,e){var n=t[0],r=t[1],s=t[2],o=t[3],a=n+n,h=r+r,c=s+s,l=n*a,d=n*h,m=n*c,u=r*h,p=r*c,f=s*c,_=o*a,y=o*h,M=o*c;return i[0]=1-(u+f),i[1]=d+M,i[2]=m-y,i[3]=0,i[4]=d-M,i[5]=1-(l+f),i[6]=p+_,i[7]=0,i[8]=m+y,i[9]=p-_,i[10]=1-(l+u),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}function jo(i,t){var e=new q(3),n=-t[0],r=-t[1],s=-t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],d=n*n+r*r+s*s+o*o;return d>0?(e[0]=(a*o+l*n+h*s-c*r)*2/d,e[1]=(h*o+l*r+c*n-a*s)*2/d,e[2]=(c*o+l*s+a*r-h*n)*2/d):(e[0]=(a*o+l*n+h*s-c*r)*2,e[1]=(h*o+l*r+c*n-a*s)*2,e[2]=(c*o+l*s+a*r-h*n)*2),dr(i,t,e),i}function Xo(i,t){return i[0]=t[12],i[1]=t[13],i[2]=t[14],i}function mr(i,t){var e=t[0],n=t[1],r=t[2],s=t[4],o=t[5],a=t[6],h=t[8],c=t[9],l=t[10];return i[0]=Math.hypot(e,n,r),i[1]=Math.hypot(s,o,a),i[2]=Math.hypot(h,c,l),i}function Wo(i,t){var e=new q(3);mr(e,t);var n=1/e[0],r=1/e[1],s=1/e[2],o=t[0]*n,a=t[1]*r,h=t[2]*s,c=t[4]*n,l=t[5]*r,d=t[6]*s,m=t[8]*n,u=t[9]*r,p=t[10]*s,f=o+l+p,_=0;return f>0?(_=Math.sqrt(f+1)*2,i[3]=.25*_,i[0]=(d-u)/_,i[1]=(m-h)/_,i[2]=(a-c)/_):o>l&&o>p?(_=Math.sqrt(1+o-l-p)*2,i[3]=(d-u)/_,i[0]=.25*_,i[1]=(a+c)/_,i[2]=(m+h)/_):l>p?(_=Math.sqrt(1+l-o-p)*2,i[3]=(m-h)/_,i[0]=(a+c)/_,i[1]=.25*_,i[2]=(d+u)/_):(_=Math.sqrt(1+p-o-l)*2,i[3]=(a-c)/_,i[0]=(m+h)/_,i[1]=(d+u)/_,i[2]=.25*_),i}function Zo(i,t,e,n){var r=t[0],s=t[1],o=t[2],a=t[3],h=r+r,c=s+s,l=o+o,d=r*h,m=r*c,u=r*l,p=s*c,f=s*l,_=o*l,y=a*h,M=a*c,v=a*l,x=n[0],E=n[1],w=n[2];return i[0]=(1-(p+_))*x,i[1]=(m+v)*x,i[2]=(u-M)*x,i[3]=0,i[4]=(m-v)*E,i[5]=(1-(d+_))*E,i[6]=(f+y)*E,i[7]=0,i[8]=(u+M)*w,i[9]=(f-y)*w,i[10]=(1-(d+p))*w,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}function Ko(i,t,e,n,r){var s=t[0],o=t[1],a=t[2],h=t[3],c=s+s,l=o+o,d=a+a,m=s*c,u=s*l,p=s*d,f=o*l,_=o*d,y=a*d,M=h*c,v=h*l,x=h*d,E=n[0],w=n[1],C=n[2],S=r[0],P=r[1],R=r[2],F=(1-(f+y))*E,O=(u+x)*E,V=(p-v)*E,A=(u-x)*w,z=(1-(m+y))*w,N=(_+M)*w,Q=(p+v)*C,rt=(_-M)*C,ht=(1-(m+f))*C;return i[0]=F,i[1]=O,i[2]=V,i[3]=0,i[4]=A,i[5]=z,i[6]=N,i[7]=0,i[8]=Q,i[9]=rt,i[10]=ht,i[11]=0,i[12]=e[0]+S-(F*S+A*P+Q*R),i[13]=e[1]+P-(O*S+z*P+rt*R),i[14]=e[2]+R-(V*S+N*P+ht*R),i[15]=1,i}function Qo(i,t){var e=t[0],n=t[1],r=t[2],s=t[3],o=e+e,a=n+n,h=r+r,c=e*o,l=n*o,d=n*a,m=r*o,u=r*a,p=r*h,f=s*o,_=s*a,y=s*h;return i[0]=1-d-p,i[1]=l+y,i[2]=m-_,i[3]=0,i[4]=l-y,i[5]=1-c-p,i[6]=u+f,i[7]=0,i[8]=m+_,i[9]=u-f,i[10]=1-c-d,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function $o(i,t,e,n,r,s,o){var a=1/(e-t),h=1/(r-n),c=1/(s-o);return i[0]=s*2*a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s*2*h,i[6]=0,i[7]=0,i[8]=(e+t)*a,i[9]=(r+n)*h,i[10]=(o+s)*c,i[11]=-1,i[12]=0,i[13]=0,i[14]=o*s*2*c,i[15]=0,i}function ur(i,t,e,n,r){var s=1/Math.tan(t/2),o;return i[0]=s/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,r!=null&&r!==1/0?(o=1/(n-r),i[10]=(r+n)*o,i[14]=2*r*n*o):(i[10]=-1,i[14]=-2*n),i}var Jo=ur;function ta(i,t,e,n,r){var s=1/Math.tan(t/2),o;return i[0]=s/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,r!=null&&r!==1/0?(o=1/(n-r),i[10]=r*o,i[14]=r*n*o):(i[10]=-1,i[14]=-n),i}function ea(i,t,e,n){var r=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),h=2/(o+a),c=2/(r+s);return i[0]=h,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=c,i[6]=0,i[7]=0,i[8]=-((o-a)*h*.5),i[9]=(r-s)*c*.5,i[10]=n/(e-n),i[11]=-1,i[12]=0,i[13]=0,i[14]=n*e/(e-n),i[15]=0,i}function pr(i,t,e,n,r,s,o){var a=1/(t-e),h=1/(n-r),c=1/(s-o);return i[0]=-2*a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*h,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*c,i[11]=0,i[12]=(t+e)*a,i[13]=(r+n)*h,i[14]=(o+s)*c,i[15]=1,i}var ia=pr;function na(i,t,e,n,r,s,o){var a=1/(t-e),h=1/(n-r),c=1/(s-o);return i[0]=-2*a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*h,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=c,i[11]=0,i[12]=(t+e)*a,i[13]=(r+n)*h,i[14]=s*c,i[15]=1,i}function ra(i,t,e,n){var r,s,o,a,h,c,l,d,m,u,p=t[0],f=t[1],_=t[2],y=n[0],M=n[1],v=n[2],x=e[0],E=e[1],w=e[2];return Math.abs(p-x)<k&&Math.abs(f-E)<k&&Math.abs(_-w)<k?cr(i):(l=p-x,d=f-E,m=_-w,u=1/Math.hypot(l,d,m),l*=u,d*=u,m*=u,r=M*m-v*d,s=v*l-y*m,o=y*d-M*l,u=Math.hypot(r,s,o),u?(u=1/u,r*=u,s*=u,o*=u):(r=0,s=0,o=0),a=d*o-m*s,h=m*r-l*o,c=l*s-d*r,u=Math.hypot(a,h,c),u?(u=1/u,a*=u,h*=u,c*=u):(a=0,h=0,c=0),i[0]=r,i[1]=a,i[2]=l,i[3]=0,i[4]=s,i[5]=h,i[6]=d,i[7]=0,i[8]=o,i[9]=c,i[10]=m,i[11]=0,i[12]=-(r*p+s*f+o*_),i[13]=-(a*p+h*f+c*_),i[14]=-(l*p+d*f+m*_),i[15]=1,i)}function sa(i,t,e,n){var r=t[0],s=t[1],o=t[2],a=n[0],h=n[1],c=n[2],l=r-e[0],d=s-e[1],m=o-e[2],u=l*l+d*d+m*m;u>0&&(u=1/Math.sqrt(u),l*=u,d*=u,m*=u);var p=h*m-c*d,f=c*l-a*m,_=a*d-h*l;return u=p*p+f*f+_*_,u>0&&(u=1/Math.sqrt(u),p*=u,f*=u,_*=u),i[0]=p,i[1]=f,i[2]=_,i[3]=0,i[4]=d*_-m*f,i[5]=m*p-l*_,i[6]=l*f-d*p,i[7]=0,i[8]=l,i[9]=d,i[10]=m,i[11]=0,i[12]=r,i[13]=s,i[14]=o,i[15]=1,i}function oa(i){return"mat4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+", "+i[9]+", "+i[10]+", "+i[11]+", "+i[12]+", "+i[13]+", "+i[14]+", "+i[15]+")"}function aa(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])}function ha(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i[4]=t[4]+e[4],i[5]=t[5]+e[5],i[6]=t[6]+e[6],i[7]=t[7]+e[7],i[8]=t[8]+e[8],i[9]=t[9]+e[9],i[10]=t[10]+e[10],i[11]=t[11]+e[11],i[12]=t[12]+e[12],i[13]=t[13]+e[13],i[14]=t[14]+e[14],i[15]=t[15]+e[15],i}function _r(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i[3]=t[3]-e[3],i[4]=t[4]-e[4],i[5]=t[5]-e[5],i[6]=t[6]-e[6],i[7]=t[7]-e[7],i[8]=t[8]-e[8],i[9]=t[9]-e[9],i[10]=t[10]-e[10],i[11]=t[11]-e[11],i[12]=t[12]-e[12],i[13]=t[13]-e[13],i[14]=t[14]-e[14],i[15]=t[15]-e[15],i}function ca(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i[4]=t[4]*e,i[5]=t[5]*e,i[6]=t[6]*e,i[7]=t[7]*e,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12]*e,i[13]=t[13]*e,i[14]=t[14]*e,i[15]=t[15]*e,i}function la(i,t,e,n){return i[0]=t[0]+e[0]*n,i[1]=t[1]+e[1]*n,i[2]=t[2]+e[2]*n,i[3]=t[3]+e[3]*n,i[4]=t[4]+e[4]*n,i[5]=t[5]+e[5]*n,i[6]=t[6]+e[6]*n,i[7]=t[7]+e[7]*n,i[8]=t[8]+e[8]*n,i[9]=t[9]+e[9]*n,i[10]=t[10]+e[10]*n,i[11]=t[11]+e[11]*n,i[12]=t[12]+e[12]*n,i[13]=t[13]+e[13]*n,i[14]=t[14]+e[14]*n,i[15]=t[15]+e[15]*n,i}function da(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]}function ma(i,t){var e=i[0],n=i[1],r=i[2],s=i[3],o=i[4],a=i[5],h=i[6],c=i[7],l=i[8],d=i[9],m=i[10],u=i[11],p=i[12],f=i[13],_=i[14],y=i[15],M=t[0],v=t[1],x=t[2],E=t[3],w=t[4],C=t[5],S=t[6],P=t[7],R=t[8],F=t[9],O=t[10],V=t[11],A=t[12],z=t[13],N=t[14],Q=t[15];return Math.abs(e-M)<=k*Math.max(1,Math.abs(e),Math.abs(M))&&Math.abs(n-v)<=k*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-x)<=k*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-E)<=k*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(o-w)<=k*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(a-C)<=k*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(h-S)<=k*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(c-P)<=k*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(l-R)<=k*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(d-F)<=k*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(m-O)<=k*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(u-V)<=k*Math.max(1,Math.abs(u),Math.abs(V))&&Math.abs(p-A)<=k*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(f-z)<=k*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(_-N)<=k*Math.max(1,Math.abs(_),Math.abs(N))&&Math.abs(y-Q)<=k*Math.max(1,Math.abs(y),Math.abs(Q))}var ua=lr,pa=_r;var Ct={};ie(Ct,{add:()=>_h,calculateW:()=>rh,clone:()=>dh,conjugate:()=>hh,copy:()=>uh,create:()=>pn,dot:()=>Hr,equals:()=>Eh,exactEquals:()=>xh,exp:()=>kr,fromEuler:()=>ch,fromMat3:()=>Nr,fromValues:()=>mh,getAngle:()=>th,getAxisAngle:()=>Ja,identity:()=>$a,invert:()=>ah,len:()=>vh,length:()=>Yr,lerp:()=>yh,ln:()=>Ir,mul:()=>fh,multiply:()=>Ur,normalize:()=>_n,pow:()=>sh,random:()=>oh,rotateX:()=>eh,rotateY:()=>ih,rotateZ:()=>nh,rotationTo:()=>wh,scale:()=>Br,set:()=>ph,setAxes:()=>Mh,setAxisAngle:()=>Vr,slerp:()=>yi,sqlerp:()=>Ch,sqrLen:()=>gh,squaredLength:()=>Gr,str:()=>lh});var L={};ie(L,{add:()=>va,angle:()=>ka,bezier:()=>Pa,ceil:()=>ga,clone:()=>_a,copy:()=>fa,create:()=>pi,cross:()=>De,dist:()=>ja,distance:()=>xr,div:()=>qa,divide:()=>gr,dot:()=>fi,equals:()=>Ha,exactEquals:()=>Ba,floor:()=>xa,forEach:()=>Za,fromValues:()=>_i,hermite:()=>Sa,inverse:()=>Ra,len:()=>un,length:()=>fr,lerp:()=>Aa,max:()=>wa,min:()=>Ea,mul:()=>Ga,multiply:()=>vr,negate:()=>ba,normalize:()=>mn,random:()=>Oa,rotateX:()=>La,rotateY:()=>Va,rotateZ:()=>Ua,round:()=>Ca,scale:()=>Ma,scaleAndAdd:()=>Ta,set:()=>ya,sqrDist:()=>Xa,sqrLen:()=>Wa,squaredDistance:()=>Er,squaredLength:()=>wr,str:()=>Na,sub:()=>Ya,subtract:()=>yr,transformMat3:()=>za,transformMat4:()=>Da,transformQuat:()=>Fa,zero:()=>Ia});function pi(){var i=new q(3);return q!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function _a(i){var t=new q(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}function fr(i){var t=i[0],e=i[1],n=i[2];return Math.hypot(t,e,n)}function _i(i,t,e){var n=new q(3);return n[0]=i,n[1]=t,n[2]=e,n}function fa(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i}function ya(i,t,e,n){return i[0]=t,i[1]=e,i[2]=n,i}function va(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i}function yr(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function vr(i,t,e){return i[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i}function gr(i,t,e){return i[0]=t[0]/e[0],i[1]=t[1]/e[1],i[2]=t[2]/e[2],i}function ga(i,t){return i[0]=Math.ceil(t[0]),i[1]=Math.ceil(t[1]),i[2]=Math.ceil(t[2]),i}function xa(i,t){return i[0]=Math.floor(t[0]),i[1]=Math.floor(t[1]),i[2]=Math.floor(t[2]),i}function Ea(i,t,e){return i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.min(t[2],e[2]),i}function wa(i,t,e){return i[0]=Math.max(t[0],e[0]),i[1]=Math.max(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i}function Ca(i,t){return i[0]=Math.round(t[0]),i[1]=Math.round(t[1]),i[2]=Math.round(t[2]),i}function Ma(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i}function Ta(i,t,e,n){return i[0]=t[0]+e[0]*n,i[1]=t[1]+e[1]*n,i[2]=t[2]+e[2]*n,i}function xr(i,t){var e=t[0]-i[0],n=t[1]-i[1],r=t[2]-i[2];return Math.hypot(e,n,r)}function Er(i,t){var e=t[0]-i[0],n=t[1]-i[1],r=t[2]-i[2];return e*e+n*n+r*r}function wr(i){var t=i[0],e=i[1],n=i[2];return t*t+e*e+n*n}function ba(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i}function Ra(i,t){return i[0]=1/t[0],i[1]=1/t[1],i[2]=1/t[2],i}function mn(i,t){var e=t[0],n=t[1],r=t[2],s=e*e+n*n+r*r;return s>0&&(s=1/Math.sqrt(s)),i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i}function fi(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function De(i,t,e){var n=t[0],r=t[1],s=t[2],o=e[0],a=e[1],h=e[2];return i[0]=r*h-s*a,i[1]=s*o-n*h,i[2]=n*a-r*o,i}function Aa(i,t,e,n){var r=t[0],s=t[1],o=t[2];return i[0]=r+n*(e[0]-r),i[1]=s+n*(e[1]-s),i[2]=o+n*(e[2]-o),i}function Sa(i,t,e,n,r,s){var o=s*s,a=o*(2*s-3)+1,h=o*(s-2)+s,c=o*(s-1),l=o*(3-2*s);return i[0]=t[0]*a+e[0]*h+n[0]*c+r[0]*l,i[1]=t[1]*a+e[1]*h+n[1]*c+r[1]*l,i[2]=t[2]*a+e[2]*h+n[2]*c+r[2]*l,i}function Pa(i,t,e,n,r,s){var o=1-s,a=o*o,h=s*s,c=a*o,l=3*s*a,d=3*h*o,m=h*s;return i[0]=t[0]*c+e[0]*l+n[0]*d+r[0]*m,i[1]=t[1]*c+e[1]*l+n[1]*d+r[1]*m,i[2]=t[2]*c+e[2]*l+n[2]*d+r[2]*m,i}function Oa(i,t){t=t||1;var e=Lt()*2*Math.PI,n=Lt()*2-1,r=Math.sqrt(1-n*n)*t;return i[0]=Math.cos(e)*r,i[1]=Math.sin(e)*r,i[2]=n*t,i}function Da(i,t,e){var n=t[0],r=t[1],s=t[2],o=e[3]*n+e[7]*r+e[11]*s+e[15];return o=o||1,i[0]=(e[0]*n+e[4]*r+e[8]*s+e[12])/o,i[1]=(e[1]*n+e[5]*r+e[9]*s+e[13])/o,i[2]=(e[2]*n+e[6]*r+e[10]*s+e[14])/o,i}function za(i,t,e){var n=t[0],r=t[1],s=t[2];return i[0]=n*e[0]+r*e[3]+s*e[6],i[1]=n*e[1]+r*e[4]+s*e[7],i[2]=n*e[2]+r*e[5]+s*e[8],i}function Fa(i,t,e){var n=e[0],r=e[1],s=e[2],o=e[3],a=t[0],h=t[1],c=t[2],l=r*c-s*h,d=s*a-n*c,m=n*h-r*a,u=r*m-s*d,p=s*l-n*m,f=n*d-r*l,_=o*2;return l*=_,d*=_,m*=_,u*=2,p*=2,f*=2,i[0]=a+l+u,i[1]=h+d+p,i[2]=c+m+f,i}function La(i,t,e,n){var r=[],s=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],s[0]=r[0],s[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),s[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),i[0]=s[0]+e[0],i[1]=s[1]+e[1],i[2]=s[2]+e[2],i}function Va(i,t,e,n){var r=[],s=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],s[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),s[1]=r[1],s[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),i[0]=s[0]+e[0],i[1]=s[1]+e[1],i[2]=s[2]+e[2],i}function Ua(i,t,e,n){var r=[],s=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],s[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),s[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),s[2]=r[2],i[0]=s[0]+e[0],i[1]=s[1]+e[1],i[2]=s[2]+e[2],i}function ka(i,t){var e=i[0],n=i[1],r=i[2],s=t[0],o=t[1],a=t[2],h=Math.sqrt(e*e+n*n+r*r),c=Math.sqrt(s*s+o*o+a*a),l=h*c,d=l&&fi(i,t)/l;return Math.acos(Math.min(Math.max(d,-1),1))}function Ia(i){return i[0]=0,i[1]=0,i[2]=0,i}function Na(i){return"vec3("+i[0]+", "+i[1]+", "+i[2]+")"}function Ba(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]}function Ha(i,t){var e=i[0],n=i[1],r=i[2],s=t[0],o=t[1],a=t[2];return Math.abs(e-s)<=k*Math.max(1,Math.abs(e),Math.abs(s))&&Math.abs(n-o)<=k*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=k*Math.max(1,Math.abs(r),Math.abs(a))}var Ya=yr,Ga=vr,qa=gr,ja=xr,Xa=Er,un=fr,Wa=wr,Za=function(){var i=pi();return function(t,e,n,r,s,o){var a,h;for(e||(e=3),n||(n=0),r?h=Math.min(r*e+n,t.length):h=t.length,a=n;a<h;a+=e)i[0]=t[a],i[1]=t[a+1],i[2]=t[a+2],s(i,i,o),t[a]=i[0],t[a+1]=i[1],t[a+2]=i[2];return t}}();function Ka(){var i=new q(4);return q!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function Cr(i){var t=new q(4);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t}function Mr(i,t,e,n){var r=new q(4);return r[0]=i,r[1]=t,r[2]=e,r[3]=n,r}function Tr(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i}function br(i,t,e,n,r){return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function Rr(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i}function Ar(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i}function Sr(i){var t=i[0],e=i[1],n=i[2],r=i[3];return Math.hypot(t,e,n,r)}function Pr(i){var t=i[0],e=i[1],n=i[2],r=i[3];return t*t+e*e+n*n+r*r}function Or(i,t){var e=t[0],n=t[1],r=t[2],s=t[3],o=e*e+n*n+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),i[0]=e*o,i[1]=n*o,i[2]=r*o,i[3]=s*o,i}function Dr(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]}function zr(i,t,e,n){var r=t[0],s=t[1],o=t[2],a=t[3];return i[0]=r+n*(e[0]-r),i[1]=s+n*(e[1]-s),i[2]=o+n*(e[2]-o),i[3]=a+n*(e[3]-a),i}function Fr(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]}function Lr(i,t){var e=i[0],n=i[1],r=i[2],s=i[3],o=t[0],a=t[1],h=t[2],c=t[3];return Math.abs(e-o)<=k*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(n-a)<=k*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-h)<=k*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(s-c)<=k*Math.max(1,Math.abs(s),Math.abs(c))}var Oc=function(){var i=Ka();return function(t,e,n,r,s,o){var a,h;for(e||(e=4),n||(n=0),r?h=Math.min(r*e+n,t.length):h=t.length,a=n;a<h;a+=e)i[0]=t[a],i[1]=t[a+1],i[2]=t[a+2],i[3]=t[a+3],s(i,i,o),t[a]=i[0],t[a+1]=i[1],t[a+2]=i[2],t[a+3]=i[3];return t}}();function pn(){var i=new q(4);return q!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function $a(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Vr(i,t,e){e=e*.5;var n=Math.sin(e);return i[0]=n*t[0],i[1]=n*t[1],i[2]=n*t[2],i[3]=Math.cos(e),i}function Ja(i,t){var e=Math.acos(t[3])*2,n=Math.sin(e/2);return n>k?(i[0]=t[0]/n,i[1]=t[1]/n,i[2]=t[2]/n):(i[0]=1,i[1]=0,i[2]=0),e}function th(i,t){var e=Hr(i,t);return Math.acos(2*e*e-1)}function Ur(i,t,e){var n=t[0],r=t[1],s=t[2],o=t[3],a=e[0],h=e[1],c=e[2],l=e[3];return i[0]=n*l+o*a+r*c-s*h,i[1]=r*l+o*h+s*a-n*c,i[2]=s*l+o*c+n*h-r*a,i[3]=o*l-n*a-r*h-s*c,i}function eh(i,t,e){e*=.5;var n=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(e),h=Math.cos(e);return i[0]=n*h+o*a,i[1]=r*h+s*a,i[2]=s*h-r*a,i[3]=o*h-n*a,i}function ih(i,t,e){e*=.5;var n=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(e),h=Math.cos(e);return i[0]=n*h-s*a,i[1]=r*h+o*a,i[2]=s*h+n*a,i[3]=o*h-r*a,i}function nh(i,t,e){e*=.5;var n=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(e),h=Math.cos(e);return i[0]=n*h+r*a,i[1]=r*h-n*a,i[2]=s*h+o*a,i[3]=o*h-s*a,i}function rh(i,t){var e=t[0],n=t[1],r=t[2];return i[0]=e,i[1]=n,i[2]=r,i[3]=Math.sqrt(Math.abs(1-e*e-n*n-r*r)),i}function kr(i,t){var e=t[0],n=t[1],r=t[2],s=t[3],o=Math.sqrt(e*e+n*n+r*r),a=Math.exp(s),h=o>0?a*Math.sin(o)/o:0;return i[0]=e*h,i[1]=n*h,i[2]=r*h,i[3]=a*Math.cos(o),i}function Ir(i,t){var e=t[0],n=t[1],r=t[2],s=t[3],o=Math.sqrt(e*e+n*n+r*r),a=o>0?Math.atan2(o,s)/o:0;return i[0]=e*a,i[1]=n*a,i[2]=r*a,i[3]=.5*Math.log(e*e+n*n+r*r+s*s),i}function sh(i,t,e){return Ir(i,t),Br(i,i,e),kr(i,i),i}function yi(i,t,e,n){var r=t[0],s=t[1],o=t[2],a=t[3],h=e[0],c=e[1],l=e[2],d=e[3],m,u,p,f,_;return u=r*h+s*c+o*l+a*d,u<0&&(u=-u,h=-h,c=-c,l=-l,d=-d),1-u>k?(m=Math.acos(u),p=Math.sin(m),f=Math.sin((1-n)*m)/p,_=Math.sin(n*m)/p):(f=1-n,_=n),i[0]=f*r+_*h,i[1]=f*s+_*c,i[2]=f*o+_*l,i[3]=f*a+_*d,i}function oh(i){var t=Lt(),e=Lt(),n=Lt(),r=Math.sqrt(1-t),s=Math.sqrt(t);return i[0]=r*Math.sin(2*Math.PI*e),i[1]=r*Math.cos(2*Math.PI*e),i[2]=s*Math.sin(2*Math.PI*n),i[3]=s*Math.cos(2*Math.PI*n),i}function ah(i,t){var e=t[0],n=t[1],r=t[2],s=t[3],o=e*e+n*n+r*r+s*s,a=o?1/o:0;return i[0]=-e*a,i[1]=-n*a,i[2]=-r*a,i[3]=s*a,i}function hh(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=t[3],i}function Nr(i,t){var e=t[0]+t[4]+t[8],n;if(e>0)n=Math.sqrt(e+1),i[3]=.5*n,n=.5/n,i[0]=(t[5]-t[7])*n,i[1]=(t[6]-t[2])*n,i[2]=(t[1]-t[3])*n;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[r*3+r]&&(r=2);var s=(r+1)%3,o=(r+2)%3;n=Math.sqrt(t[r*3+r]-t[s*3+s]-t[o*3+o]+1),i[r]=.5*n,n=.5/n,i[3]=(t[s*3+o]-t[o*3+s])*n,i[s]=(t[s*3+r]+t[r*3+s])*n,i[o]=(t[o*3+r]+t[r*3+o])*n}return i}function ch(i,t,e,n){var r=.5*Math.PI/180;t*=r,e*=r,n*=r;var s=Math.sin(t),o=Math.cos(t),a=Math.sin(e),h=Math.cos(e),c=Math.sin(n),l=Math.cos(n);return i[0]=s*h*l-o*a*c,i[1]=o*a*l+s*h*c,i[2]=o*h*c-s*a*l,i[3]=o*h*l+s*a*c,i}function lh(i){return"quat("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"}var dh=Cr,mh=Mr,uh=Tr,ph=br,_h=Rr,fh=Ur,Br=Ar,Hr=Dr,yh=zr,Yr=Sr,vh=Yr,Gr=Pr,gh=Gr,_n=Or,xh=Fr,Eh=Lr,wh=function(){var i=pi(),t=_i(1,0,0),e=_i(0,1,0);return function(n,r,s){var o=fi(r,s);return o<-.999999?(De(i,t,r),un(i)<1e-6&&De(i,e,r),mn(i,i),Vr(n,i,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(De(i,r,s),n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=1+o,_n(n,n))}}(),Ch=function(){var i=pn(),t=pn();return function(e,n,r,s,o,a){return yi(i,n,o,a),yi(t,r,s,a),yi(e,i,t,2*a*(1-a)),e}}(),Mh=function(){var i=dn();return function(t,e,n,r){return i[0]=n[0],i[3]=n[1],i[6]=n[2],i[1]=r[0],i[4]=r[1],i[7]=r[2],i[2]=-e[0],i[5]=-e[1],i[8]=-e[2],_n(t,Nr(t,i))}}();var mt=class{#t=new EventTarget;addEventListener(t,e,n){this.#t.addEventListener(t,e,n)}removeEventListener(t,e,n){this.#t.removeEventListener(t,e,n)}_dispatchEvent(t){return this.#t.dispatchEvent(t)}};var vi=class extends mt{static component_names=["animation_controller","animation_sequence_controller","bone","box_geometry","camera","capsule_geometry","character_controller","collision_geometry_ref","constraint","constraint_actuator","culling_geometry","cylinder_geometry","debug_name","decal_projector","environment","joint","label","lineage","local_aabb","material","material_ref","measure","mesh_ref","orthographic_lens","overrider","perspective_lens","physics_material","plane_geometry","point_cloud_ref","point_light","reflection_probe","rigid_body","rigid_body_actuator","scene_ref","script_map","shadow_caster","skeleton_ref","sound_ref","sphere_geometry","spline","spot_light","stereoscopic_lens","tags","vehicle_controller","volume_filter","volume_material_ref","volume_ref"];#t;get _core(){return this.#t}get euid(){return this.#t.euid}get animation_controller(){return this.#t.animation_controller}set animation_controller(t){this.#t.animation_controller=this._setComponentValue({ref:this.#t.animation_controller,component_name:"animation_controller",value:t})}get animation_sequence_controller(){return this.#t.animation_sequence_controller}set animation_sequence_controller(t){this.#t.animation_sequence_controller=this._setComponentValue({ref:this.#t.animation_sequence_controller,component_name:"animation_sequence_controller",value:t})}get bone(){return this.#t.bone}set bone(t){this.#t.bone=this._setComponentValue({ref:this.#t.bone,component_name:"bone",value:t})}get box_geometry(){return this.#t.box_geometry}set box_geometry(t){this.#t.box_geometry=this._setComponentValue({ref:this.#t.box_geometry,component_name:"box_geometry",value:t})}get camera(){return this.#t.camera}set camera(t){this.#t.camera=this._setComponentValue({ref:this.#t.camera,component_name:"camera",value:t})}get capsule_geometry(){return this.#t.capsule_geometry}set capsule_geometry(t){this.#t.capsule_geometry=this._setComponentValue({ref:this.#t.capsule_geometry,component_name:"capsule_geometry",value:t})}get character_controller(){return this.#t.character_controller}set character_controller(t){this.#t.character_controller=this._setComponentValue({ref:this.#t.character_controller,component_name:"character_controller",value:t})}get collision_geometry_ref(){return this.#t.collision_geometry_ref}set collision_geometry_ref(t){this.#t.collision_geometry_ref=this._setComponentValue({ref:this.#t.collision_geometry_ref,component_name:"collision_geometry_ref",value:t})}get constraint(){return this.#t.constraint}set constraint(t){this.#t.constraint=this._setComponentValue({ref:this.#t.constraint,component_name:"constraint",value:t})}get constraint_actuator(){return this.#t.constraint_actuator}set constraint_actuator(t){this.#t.constraint_actuator=this._setComponentValue({ref:this.#t.constraint_actuator,component_name:"constraint_actuator",value:t})}get culling_geometry(){return this.#t.culling_geometry}set culling_geometry(t){this.#t.culling_geometry=this._setComponentValue({ref:this.#t.culling_geometry,component_name:"culling_geometry",value:t})}get cylinder_geometry(){return this.#t.cylinder_geometry}set cylinder_geometry(t){this.#t.cylinder_geometry=this._setComponentValue({ref:this.#t.cylinder_geometry,component_name:"cylinder_geometry",value:t})}get debug_name(){return this.#t.debug_name}set debug_name(t){this.#t.debug_name=this._setComponentValue({ref:this.#t.debug_name,component_name:"debug_name",value:t})}get decal_projector(){return this.#t.decal_projector}set decal_projector(t){this.#t.decal_projector=this._setComponentValue({ref:this.#t.decal_projector,component_name:"decal_projector",value:t})}get environment(){return this.#t.environment}set environment(t){this.#t.environment=this._setComponentValue({ref:this.#t.environment,component_name:"environment",value:t})}get joint(){return this.#t.joint}set joint(t){this.#t.joint=this._setComponentValue({ref:this.#t.joint,component_name:"joint",value:t})}get label(){return this.#t.label}set label(t){this.#t.label=this._setComponentValue({ref:this.#t.label,component_name:"label",value:t})}get lineage(){return this.#t.lineage}set lineage(t){this.#t.lineage=this._setComponentValue({ref:this.#t.lineage,component_name:"lineage",value:t})}get local_aabb(){return this.#t.local_aabb}set local_aabb(t){this.#t.local_aabb=this._setComponentValue({ref:this.#t.local_aabb,component_name:"local_aabb",value:t})}get material(){return this.#t.material}set material(t){this.#t.material=this._setComponentValue({ref:this.#t.material,component_name:"material",value:t})}get material_ref(){return this.#t.material_ref}set material_ref(t){this.#t.material_ref=this._setComponentValue({ref:this.#t.material_ref,component_name:"material_ref",value:t})}get measure(){return this.#t.measure}set measure(t){this.#t.measure=this._setComponentValue({ref:this.#t.measure,component_name:"measure",value:t})}get mesh_ref(){return this.#t.mesh_ref}set mesh_ref(t){this.#t.mesh_ref=this._setComponentValue({ref:this.#t.mesh_ref,component_name:"mesh_ref",value:t})}get orthographic_lens(){return this.#t.orthographic_lens}set orthographic_lens(t){this.#t.orthographic_lens=this._setComponentValue({ref:this.#t.orthographic_lens,component_name:"orthographic_lens",value:t})}get overrider(){return this.#t.overrider}set overrider(t){this.#t.overrider=this._setComponentValue({ref:this.#t.overrider,component_name:"overrider",value:t})}get perspective_lens(){return this.#t.perspective_lens}set perspective_lens(t){this.#t.perspective_lens=this._setComponentValue({ref:this.#t.perspective_lens,component_name:"perspective_lens",value:t})}get physics_material(){return this.#t.physics_material}set physics_material(t){this.#t.physics_material=this._setComponentValue({ref:this.#t.physics_material,component_name:"physics_material",value:t})}get plane_geometry(){return this.#t.plane_geometry}set plane_geometry(t){this.#t.plane_geometry=this._setComponentValue({ref:this.#t.plane_geometry,component_name:"plane_geometry",value:t})}get point_cloud_ref(){return this.#t.point_cloud_ref}set point_cloud_ref(t){this.#t.point_cloud_ref=this._setComponentValue({ref:this.#t.point_cloud_ref,component_name:"point_cloud_ref",value:t})}get point_light(){return this.#t.point_light}set point_light(t){this.#t.point_light=this._setComponentValue({ref:this.#t.point_light,component_name:"point_light",value:t})}get reflection_probe(){return this.#t.reflection_probe}set reflection_probe(t){this.#t.reflection_probe=this._setComponentValue({ref:this.#t.reflection_probe,component_name:"reflection_probe",value:t})}get rigid_body(){return this.#t.rigid_body}set rigid_body(t){this.#t.rigid_body=this._setComponentValue({ref:this.#t.rigid_body,component_name:"rigid_body",value:t})}get rigid_body_actuator(){return this.#t.rigid_body_actuator}set rigid_body_actuator(t){this.#t.rigid_body_actuator=this._setComponentValue({ref:this.#t.rigid_body_actuator,component_name:"rigid_body_actuator",value:t})}get scene_ref(){return this.#t.scene_ref}set scene_ref(t){this.#t.scene_ref=this._setComponentValue({ref:this.#t.scene_ref,component_name:"scene_ref",value:t})}get script_map(){return this.#t.script_map}set script_map(t){this.#t.script_map=this._setComponentValue({ref:this.#t.script_map,component_name:"script_map",value:t})}get shadow_caster(){return this.#t.shadow_caster}set shadow_caster(t){this.#t.shadow_caster=this._setComponentValue({ref:this.#t.shadow_caster,component_name:"shadow_caster",value:t})}get skeleton_ref(){return this.#t.skeleton_ref}set skeleton_ref(t){this.#t.skeleton_ref=this._setComponentValue({ref:this.#t.skeleton_ref,component_name:"skeleton_ref",value:t})}get sound_ref(){return this.#t.sound_ref}set sound_ref(t){this.#t.sound_ref=this._setComponentValue({ref:this.#t.sound_ref,component_name:"sound_ref",value:t})}get sphere_geometry(){return this.#t.sphere_geometry}set sphere_geometry(t){this.#t.sphere_geometry=this._setComponentValue({ref:this.#t.sphere_geometry,component_name:"sphere_geometry",value:t})}get spline(){return this.#t.spline}set spline(t){this.#t.spline=this._setComponentValue({ref:this.#t.spline,component_name:"spline",value:t})}get spot_light(){return this.#t.spot_light}set spot_light(t){this.#t.spot_light=this._setComponentValue({ref:this.#t.spot_light,component_name:"spot_light",value:t})}get stereoscopic_lens(){return this.#t.stereoscopic_lens}set stereoscopic_lens(t){this.#t.stereoscopic_lens=this._setComponentValue({ref:this.#t.stereoscopic_lens,component_name:"stereoscopic_lens",value:t})}get tags(){return this.#t.tags}set tags(t){this.#t.tags=this._setComponentValue({ref:this.#t.tags,component_name:"tags",value:t})}get vehicle_controller(){return this.#t.vehicle_controller}set vehicle_controller(t){this.#t.vehicle_controller=this._setComponentValue({ref:this.#t.vehicle_controller,component_name:"vehicle_controller",value:t})}get volume_filter(){return this.#t.volume_filter}set volume_filter(t){this.#t.volume_filter=this._setComponentValue({ref:this.#t.volume_filter,component_name:"volume_filter",value:t})}get volume_material_ref(){return this.#t.volume_material_ref}set volume_material_ref(t){this.#t.volume_material_ref=this._setComponentValue({ref:this.#t.volume_material_ref,component_name:"volume_material_ref",value:t})}get volume_ref(){return this.#t.volume_ref}set volume_ref(t){this.#t.volume_ref=this._setComponentValue({ref:this.#t.volume_ref,component_name:"volume_ref",value:t})}constructor({euid:t}){super(),this.#t={euid:t}}toJSON(){let{euid:t,...e}=this.#t;return{euid:{value:t.value},...e}}_unsafeSetComponentValue({component_name:t,value:e}){this.#t[t]=e}};var Ut=class extends Event{change_source;new_components;updated_components;deleted_components;isAnyComponentDirty({components:t}){return this.new_components.some(e=>t.includes(e))||this.updated_components.some(e=>t.includes(e))||this.deleted_components.some(e=>t.includes(e))}constructor({change_source:t,new_components:e,updated_components:n,deleted_components:r}){super("on-entity-updated"),this.change_source=t,this.new_components=e,this.updated_components=n,this.deleted_components=r}},ye=class extends Event{change_source;is_visible;constructor({change_source:t,is_visible:e}){super("on-entity-visibility-changed"),this.change_source=t,this.is_visible=e}};function ne([i,t,e,n]){let r={roll:0,pitch:0,yaw:0},s={x:i,y:t,z:e,w:n},o=2*(s.w*s.x+s.y*s.z),a=1-2*(s.x*s.x+s.y*s.y);r.roll=Math.atan2(o,a);let h=2*(s.w*s.y-s.z*s.x);Math.abs(h)>=1?r.pitch=qr(Math.PI/2,h):r.pitch=Math.asin(h);let c=2*(s.w*s.z+s.x*s.y),l=1-2*(s.y*s.y+s.z*s.z);return r.yaw=Math.atan2(c,l),[r.roll,r.pitch,r.yaw].map(d=>d*180/Math.PI)}function gi(i){let[t,e,n]=i.map(l=>l*Math.PI/180),r=Math.cos(n/2),s=Math.sin(n/2),o=Math.cos(e/2),a=Math.sin(e/2),h=Math.cos(t/2),c=Math.sin(t/2);return[r*o*c-s*a*h,s*o*c+r*a*h,s*o*h-r*a*c,r*o*h+s*a*c]}function qr(i,t){return t<0?-Math.abs(i):Math.abs(i)}var xi=class extends vi{#t;#i;#e;#n;#r=J.create();#o=J.create();#s=null;#a=!0;#c=0;#h=0;constructor({euid:t,local_transform:e,parent:n}){super({euid:t}),this.#s=n,this.#e=e,this.#t={position:[0,0,0],orientation:[0,0,0,1],scale:[1,1,1],eulerOrientation:[0,0,0]},this.#n=new fn(this,this.#e),this.#i=new yn(this,this.#t),this._unsafeSetComponentValue({component_name:"local_transform",value:this.#e})}get _last_update_id(){return this.#c}get global_transform(){return this.#i}set global_transform(t){this._setGlobalTransform({global_transform:t,change_source:"local"}),this._markComponentAsDirty({component_name:"local_transform"})}get local_transform(){return this.#n}set local_transform(t){Object.assign(this.#n,t)}get global_aabb(){let t=-Number.MAX_VALUE,e=this.local_aabb||{min:[-1,-1,-1],max:[1,1,1]},{min:n,max:r}=e,s=[L.fromValues(n[0],n[1],n[2]),L.fromValues(r[0],n[1],n[2]),L.fromValues(n[0],r[1],n[2]),L.fromValues(n[0],n[1],r[2]),L.fromValues(r[0],r[1],r[2]),L.fromValues(n[0],r[1],r[2]),L.fromValues(r[0],n[1],r[2]),L.fromValues(r[0],r[1],n[2])];s.forEach(l=>L.transformMat4(l,l,this.ls_to_ws));let o=L.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=L.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),h=L.create();return s.forEach(l=>{L.min(o,o,l),L.max(a,a,l),L.add(h,h,l)}),L.scale(h,h,1/8),[{vertex:s[0],test_vertices:[s[1],s[2],s[3]]},{vertex:s[6],test_vertices:[s[1],s[3],s[4]]},{vertex:s[5],test_vertices:[s[2],s[3],s[4]]},{vertex:s[7],test_vertices:[s[1],s[2],s[4]]}].forEach(({vertex:l,test_vertices:d})=>{d.forEach(m=>{let u=L.distance(l,m);u>t&&(t=u)})}),{min:Array.from(o),max:Array.from(a),center:Array.from(h),longest_edge_length:t}}get parent(){return this.#s}set parent(t){throw new Error("Not implemented")}get#l(){return this.#s&&(this.#s._last_update_id!==this.#h||this.#s.#l)?!0:this.#a}set#l(t){this.#a=t,this.#c++,this.#h=this.#s?._last_update_id??0}_setGlobalTransform({global_transform:t,change_source:e}){t.position&&(this._setGlobalPosition(t.position),L.copy(this.#t.position,t.position)),t.orientation&&(this._setGlobalOrientation(t.orientation),Ct.copy(this.#t.orientation,t.orientation)),t.eulerOrientation&&(this._setGlobalEulerOrientation(t.eulerOrientation),L.copy(this.#t.eulerOrientation,t.eulerOrientation)),t.scale&&(this._setGlobalScale(t.scale),L.copy(this.#t.scale,t.scale)),this._computeTransformMatrices(),this._dispatchEvent(new Ut({change_source:e,updated_components:["local_transform"],deleted_components:[],new_components:[]}))}_markGlobalTransformAsDirty(){this.#a=!0,this._markLocalTransformAsDirty()}_markLocalTransformAsDirty(){this.#c++,this._markComponentAsDirty({component_name:"local_transform"})}_recalculateGlobalTransformIfNeeded=()=>{this.#l&&(this.#d(),this.#m(),this.#p(),this.#u(),this._computeTransformMatrices(),this.#l=!1)};_computeTransformMatrices(){J.fromRotationTranslationScale(this.#r,this.#t.orientation,this.#t.position,this.#t.scale),J.invert(this.#o,this.#r)}_setLocalTransform({local_transform:t}){t.position&&L.copy(this.#e.position,t.position),t.orientation&&Ct.copy(this.#e.orientation,t.orientation),t.eulerOrientation&&L.copy(this.#e.eulerOrientation,t.eulerOrientation),t.scale&&L.copy(this.#e.scale,t.scale),t.globalEulerOrientation&&L.copy(this.#e.globalEulerOrientation,t.globalEulerOrientation),this.#a=!0}#d(){let t=this.#e.position;return this.#s?L.transformMat4(this.#t.position,t,this.#s.ls_to_ws):L.copy(this.#t.position,t)}_setGlobalPosition(t){if(!this.#s){L.copy(this.#e.position,t);return}L.transformMat4(this.#e.position,t,this.#s.ws_to_ls)}#m(){return this.#s?Ct.multiply(this.#t.orientation,this.#s.global_transform.orientation,this.#e.orientation):Ct.copy(this.#t.orientation,this.#e.orientation)}_setGlobalOrientation(t){if(!this.#s){Ct.copy(this.#e.orientation,t),L.copy(this.#e.eulerOrientation,ne(t));return}let e=Ct.conjugate(Ct.create(),this.#s.global_transform.orientation),n=this.#e.orientation;Ct.multiply(n,e,t),this.#e.eulerOrientation=ne(n)}#u(){let n=gi(this.#e.globalEulerOrientation).every((r,s)=>Math.max(r-this.#t.orientation[s])<1e-6)?this.#e.globalEulerOrientation:ne(this.#t.orientation);return L.copy(this.#t.eulerOrientation,n)}_setGlobalEulerOrientation(t){let e=gi(t);this._setGlobalOrientation(e),L.copy(this.#e.globalEulerOrientation,t)}#p(){let t=this.#e.scale;return this.#s?L.multiply(this.#t.scale,this.#s.global_transform.scale,t):L.copy(this.#t.scale,t)}_setGlobalScale(t){if(!this.#s){L.copy(this.#e.scale,t);return}L.divide(this.#e.scale,t,this.#s.global_transform.scale)}get ls_to_ws(){return this._recalculateGlobalTransformIfNeeded(),this.#r}get ws_to_ls(){return this._recalculateGlobalTransformIfNeeded(),this.#o}},fn=class{#t;#i;#e;#n;constructor(t,e){let n=()=>({get:(r,s)=>Reflect.get(r,s),set:(r,s,o)=>{let a=Reflect.set(r,s,o);return t._markGlobalTransformAsDirty(),a}});this.#t=new Proxy(e.position,n()),this.#n=new Proxy(e.scale,n()),this.#i=new Proxy(e.orientation,{get:(r,s)=>e.orientation[s],set:(r,s,o)=>{let a=Reflect.set(r,s,o);return e.eulerOrientation=ne(e.orientation),t._markGlobalTransformAsDirty(),a}}),this.#e=new Proxy(e.eulerOrientation,{get:(r,s)=>e.eulerOrientation[s],set:(r,s,o)=>{let a=Reflect.set(r,s,o);return e.orientation=gi(e.eulerOrientation),t._markGlobalTransformAsDirty(),a}})}get position(){return this.#t}get orientation(){return this.#i}get eulerOrientation(){return this.#e}get scale(){return this.#n}set position(t){Object.assign(this.#t,t)}set orientation(t){Object.assign(this.#i,t)}set eulerOrientation(t){Object.assign(this.#e,t)}set scale(t){Object.assign(this.#n,t)}},yn=class{#t;#i;#e;#n;constructor(t,e){this.#t=new Proxy(e.position,{get:(n,r)=>(t._recalculateGlobalTransformIfNeeded(),Reflect.get(n,r)),set:(n,r,s)=>(Reflect.set(n,r,s),t._setGlobalPosition(n),t._computeTransformMatrices(),t._markLocalTransformAsDirty(),!0)}),this.#i=new Proxy(e.orientation,{get:(n,r)=>(t._recalculateGlobalTransformIfNeeded(),Reflect.get(n,r)),set:(n,r,s)=>(Reflect.set(n,r,s),t._setGlobalOrientation(n),t._computeTransformMatrices(),t._markLocalTransformAsDirty(),!0)}),this.#e=new Proxy(e.eulerOrientation,{get:(n,r)=>(t._recalculateGlobalTransformIfNeeded(),Reflect.get(n,r)),set:(n,r,s)=>(Reflect.set(n,r,s),t._setGlobalEulerOrientation(n),t._computeTransformMatrices(),t._markLocalTransformAsDirty(),!0)}),this.#n=new Proxy(e.scale,{get:(n,r)=>(t._recalculateGlobalTransformIfNeeded(),Reflect.get(n,r)),set:(n,r,s)=>(Reflect.set(n,r,s),t._setGlobalScale(n),t._computeTransformMatrices(),t._markLocalTransformAsDirty(),!0)})}get position(){return this.#t}get orientation(){return this.#i}get eulerOrientation(){return this.#e}get scale(){return this.#n}set position(t){Object.assign(this.#t,t)}set orientation(t){Object.assign(this.#i,t)}set eulerOrientation(t){Object.assign(this.#e,t)}set scale(t){Object.assign(this.#n,t)}};var Ei=class i{constructor(t,e){this._entity=t;this._component_name=e}get(t,e){return typeof t[e]=="object"||Array.isArray(t[e])?new Proxy(t[e],new i(this._entity,this._component_name)):Reflect.get(t,e)}set(t,e,n){let r=Reflect.set(t,e,n);return this._entity._markComponentAsDirty({component_name:this._component_name}),r}deleteProperty(t,e){let n=Reflect.deleteProperty(t,e);return this._entity._markComponentAsDirty({component_name:this._component_name}),n}};var ze=class extends Event{emitter_entity;data_object;constructor({event_name:t,emitter_entity:e,data_object:n}){super(t),this.emitter_entity=e,this.data_object=n}},Fe=class extends Event{emitter_entity;data_object;#t;#i;#e=null;get target_entities(){return this.#e||(this.#e=Promise.all(this.#i.map(t=>this.#t._findEntity({entity_rtid:t})))),this.#e}constructor({scene:t,event_name:e,emitter_entity:n,target_rtids:r,data_object:s}){super(e),this.#t=t,this.emitter_entity=n,this.#i=r,this.data_object=s}};var kt=class extends xi{#t;#i=new Set;#e=new Set;#n=new mt;#r=new mt;#o=!0;#s=!0;get rtid(){return this.euid.rtid}get id(){return this.euid.value}get name(){return this.debug_name?.value??"<unnamed>"}get auto_broadcast(){return this.#o}set auto_broadcast(t){this.#o=t,t===!1&&this.#t._entity_registry._removeEntityFromBroadcastList({entity:this})}get is_visible(){return this.#s}set is_visible(t){this.#t._setEntityVisibility({entity_rtid:this.rtid,is_visible:t}),this.#s=t,this._dispatchEvent(new ye({is_visible:t,change_source:"local"}))}get parent(){return super.parent}set parent(t){super.parent=t}get local_transform(){return super.local_transform}set local_transform(t){super.local_transform=t}get global_transform(){return super.global_transform}set global_transform(t){super.global_transform=t}get ls_to_ws(){return super.ls_to_ws}get ws_to_ls(){return super.ws_to_ls}get _dirty_components(){return Array.from(this.#i)}get _deleted_components(){return Array.from(this.#e)}constructor({scene:t,parent:e=null,components:n,options:r}){super({euid:n.euid,parent:e,local_transform:t._sanitizeComponentValue({component_name:"local_transform",value:n.local_transform})}),this.#t=t,this._mergeComponents({components:n,dispatch_event:!1}),this.#t._entity_registry.add({entity:this}),r&&r.auto_broadcast!==void 0&&(this.auto_broadcast=r.auto_broadcast)}async getChildren(){return await this.#t._getChildren({entity:this})}addScriptEventListener({event_map_id:t,event_name:e,onReceived:n,onEmitted:r}){n&&this.#n.addEventListener(t+"/"+e,n),r&&this.#r.addEventListener(t+"/"+e,r)}removeScriptEventListener({event_map_id:t,event_name:e,onReceived:n,onEmitted:r}){n&&this.#n.removeEventListener(t+"/"+e,n),r&&this.#r.removeEventListener(t+"/"+e,r)}async assignClientToScripts({client_uuid:t}){if(!this.script_map||!this.script_map.elements)throw new Error("Entity has no scripts");let e=Object.keys(this.script_map.elements);await Promise.all(e.map(n=>this.#t._assignClientToScripts({client_uuid:t,entity_rtid:this.rtid,script_uuid:n})))}_mergeComponents({components:t,dispatch_event:e,change_source:n}){for(let r in t){let s=r;switch(s){case"euid":break;case"local_transform":this._setLocalTransform({local_transform:t[s]});break;default:this.#c({component_name:s,value:t[s]});break}}e&&this._dispatchEvent(new Ut({change_source:n,updated_components:Object.keys(t),deleted_components:[],new_components:[]}))}_markComponentAsDirty({component_name:t}){this.#i.add(t),this.#t._entity_registry._addDirtyEntity({entity:this});let e=this[t]===void 0;this._dispatchEvent(new Ut({change_source:"local",updated_components:e?[]:[t],deleted_components:[],new_components:e?[t]:[]}))}_markComponentAsDeleted({component_name:t}){this.#e.add(t),this.#t._entity_registry._addDirtyEntity({entity:this}),this._dispatchEvent(new Ut({change_source:"local",updated_components:[],deleted_components:[t],new_components:[]}))}_clearDirtyState(){this.#i.clear(),this.#e.clear()}_onVisibilityChanged({is_visible:t}){this.#s=t,this._dispatchEvent(new ye({is_visible:t,change_source:"external"}))}_onScriptEventEmitted({scene:t,event_name:e,target_rtids:n,data_object:r}){this.#r._dispatchEvent(new Fe({scene:t,event_name:e,emitter_entity:this,target_rtids:n,data_object:r}))}_onScriptEventReceived({script_event_received_event:t}){this.#n._dispatchEvent(t)}_setComponentValue({ref:t,component_name:e,value:n}){if(!(n===void 0&&t===void 0)){if(n===void 0){Reflect.deleteProperty(this,`#${e}`),this._markComponentAsDeleted({component_name:e});return}if(n==="default"&&(n=this.#t._sanitizeComponentValue({component_name:e,value:void 0})),t===void 0){let r=this.#h({component_name:e,value:n});return this._markComponentAsDirty({component_name:e}),r}if(t!==void 0)return Object.assign(t,n),t}}#a({component_name:t}){return Reflect.get(this,`#${t}`)}#c({component_name:t,value:e}){let n=this.#a({component_name:t});if(n){Object.assign(n,e);return}let r=this.#h({component_name:t,value:e});this._unsafeSetComponentValue({component_name:t,value:r})}#h({component_name:t,value:e}){let n=this.#t._sanitizeComponentValue({component_name:t,value:e});return Reflect.set(this,`#${t}`,n),new Proxy(n,new Ei(this,t))}};var vn={"!":3,"&":2,"|":1,"^":1};function Th(i){return Object.prototype.hasOwnProperty.call(vn,i)}function bh(i,t){return vn[i]>vn[t]}function jr(i){let t=i.split(" "),e=[],n=[];for(let r of t)switch(r){case"!":case"&":case"|":case"^":{for(;n.length>0;){let s=n[n.length-1];if(!Th(s)||bh(r,s))break;n.pop(),e.push(s)}n.push(r)}break;case"(":n.push(r);break;case")":{for(;n[n.length-1]!=="(";)e.push(n.pop());console.assert(n[n.length-1]==="("),n.pop()}break;default:e.push(r);break}for(;n.length!==0;){let r=n.pop();console.assert(r!=="("),e.push(r)}return JSON.stringify(e)}var wi=class{#t=new Set;#i=new Map;#e=new Map;#n=new Set;#r=new Map;add({entity:t}){let e=this.#i.get(t.rtid);if(e)throw new Error(`Cannot add entity ${t.name} to the registry, because entity ${e.name} has the same RTID.`);this.#t.add(t),this.#i.set(t.rtid,t);let n=this.#e.get(t.id);n?n.push(t):this.#e.set(t.id,[t])}remove({entity:t}){if(!this.#i.delete(t.rtid))throw new Error(`Trying to remove entity ${t.rtid} which has not been registred to the RTID LUT.`);let e=this.#e.get(t.id);if(!e)throw new Error(`Trying to remove entity ${t.id} which has not been registered to the EUID LUT.`);let n=e.indexOf(t);if(n==-1)throw new Error(`Trying to remove entity ${t.id} which has not been registered to the EUID LUT.`);if(e.slice(n,1),e.length===0&&this.#e.delete(t.id),!this.#t.delete(t))throw new Error(`Trying to remove entity ${t.id} which has not been registered to the registry.`)}get({entity_rtid:t}){return this.#i.get(t)??null}find({entity_euid:t}){return this.#e.get(t)??[]}_addDirtyEntity({entity:t}){this.#n.add(t)}_removeEntityFromBroadcastList({entity:t}){this.#r.delete(t)}_getEntitiesToUpdate(){let t=new Array(this.#n.size),e=0;for(let n of this.#n)t[e++]={entity_components:n._core,dirty_components:n._dirty_components,deleted_components:n._deleted_components},n.auto_broadcast&&this.#o({entity:n}),n._clearDirtyState();return this.#n.clear(),t}_getEntitiesToPersist(){let t=new Array(this.#r.size),e=0;for(let[n,r]of this.#r)t[e++]={entity_components:n._core,dirty_components:Array.from(r),deleted_components:[]};return this.#r.clear(),t}#o({entity:t}){let e=this.#r.get(t);if(!e)this.#r.set(t,new Set([...t._dirty_components]));else for(let n of t._dirty_components)e.add(n)}};var Le=class{_entity_registry=new wi;#t;#i=new Map;constructor(t){this.#t=t}async newEntity({name:t,components:e,options:n,parent:r=null}){let s=r?{parentUUID:r.id}:void 0,o=await this.#t.createEntities({components:[{debug_name:{value:t},...e,lineage:s}],delete_on_client_disconnection:n?.delete_on_client_disconnection??!1,is_transient:!0});return new kt({scene:this,parent:r,components:o[0],options:n})}async newEntities({components_array:t,options:e}){return(await this.#t.createEntities({components:t,delete_on_client_disconnection:e?.delete_on_client_disconnection??!1,is_transient:!0})).map(r=>new kt({scene:this,parent:null,components:r,options:e}))}async findEntity({entity_uuid:t,linkage:e=[]}){let n=this._entity_registry.find({entity_euid:t}).find(s=>(s.lineage?.value?.length??0)===e.length&&(s.lineage?.value??[]).every((o,a)=>o===e[a]));if(n)return n;let r=await this.#t.findEntities({query:{euid:t,linkage:e},options:{include_ancestors:!0}});return r.length===0?null:this.#n(r[0])}async findEntities({entity_uuid:t}){let e=this._entity_registry.find({entity_euid:t});if(e.length>0)return e;let n=await this.#t.findEntities({query:{euid:t},options:{include_ancestors:!0}});return this.#e({entity_responses:n})}async deleteEntities({entities:t}){await this.#t.deleteEntities({entity_uuids:t.map(e=>e.id)});for(let e of t)this._entity_registry.remove({entity:e})}async highlightEntities({entities:t,keep_old_selection:e=!1}){this.#t.highlightEntities({highlightEntitiesMessage:{entities:t.map(n=>n.rtid),keep_old_selection:e}})}fireEvent({event_map_id:t,event_name:e,emitter_entity:n,target_entities:r=[],data_object:s={}}){this.#t.fireEvent({event_map_id:t,event_name:e,emitter_entity:n?n.rtid:0n,target_entities:r.map(o=>o.rtid),data_object:s})}setFilter({name:t,value:e}){let n=jr(e);this.#t.setFilter({name:t,rpn:n})}toggleFilter({name:t,enabled:e}){this.#t.toggleFilter({name:t,enabled:e})}removeFilter({name:t}){this.#t.removeFilter({name:t})}async findEntitiesByNames({entity_names:t}){let e=await this.#t.findEntities({query:{names:t},options:{include_ancestors:!0}});return this.#e({entity_responses:e})}async findEntitiesWithComponents({mandatory_components:t,forbidden_components:e}){let n=await this.#t.findEntities({query:{mandatory_components:t,forbidden_components:e},options:{include_ancestors:!0}});return this.#e({entity_responses:n})}async _findEntity({entity_rtid:t}){if(t===0n)return null;let e=this._entity_registry.get({entity_rtid:t});if(e)return e;let n=this.#i.get(t);n||(n=this.#t.findEntities({query:{rtid:t}}),this.#i.set(t,n));let r=await n;return this.#i.delete(t),r.length===0?null:this.#n(r[0])}async _getChildren({entity:t}){return(await this.#t.getChildren({entity_rtid:t.rtid})).map(n=>this._entity_registry.get({entity_rtid:n.euid.rtid})??new kt({scene:this,parent:t,components:n}))}_assignClientToScripts({client_uuid:t,entity_rtid:e,script_uuid:n}){this.#t.assignClientToScript({client_uuid:t,script_uuid:n,entity_rtid:e})}async _setEntityVisibility({entity_rtid:t,is_visible:e}){return this.#t.setEntityVisibility({entity_rtid:t,is_visible:e})}_onEntityVisibilityChanged=({entity_rtid:t,is_visible:e})=>{let n=this._entity_registry.get({entity_rtid:t});n&&n._onVisibilityChanged({is_visible:e})};_updateEntityFromEvent({entity_euid:t,updated_components:e}){let n=this._entity_registry.find({entity_euid:t});if(n.length===0){console.log("Received an update for an undiscovered entity",t);return}for(let r of n)r._mergeComponents({components:e,dispatch_event:!0,change_source:"external"})}_onScriptEventReceived=({emitter_rtid:t,event_name:e,target_rtids:n,data_object:r})=>{let s=this._entity_registry.get({entity_rtid:t});s&&s._onScriptEventEmitted({scene:this,event_name:e,target_rtids:n,data_object:r});let o=new ze({event_name:e,emitter_entity:s,data_object:r});for(let a of n){let h=this._entity_registry.get({entity_rtid:a});h&&h._onScriptEventReceived({script_event_received_event:o})}};_sanitizeComponentValue({component_name:t,value:e}){return this.#t.sanitizeComponentValue({component_name:t,value:e})}#e({entity_responses:t}){return t.map(this.#n)}#n=t=>{let e=this._entity_registry.get({entity_rtid:t.components.euid.rtid});if(e)return e;let n=t.ancestors?this.#r(t.ancestors):null;return new kt({scene:this,parent:n,components:t.components})};#r=t=>{let e=null;for(let n of t){let r=this._entity_registry.get({entity_rtid:n.components.euid.rtid});r?e=r:e=new kt({scene:this,parent:e,components:n.components})}return e}};var ve=class{#t;#i;#e=[];#n=null;get id(){return this.#i.client_id}get user_id(){return this.#i.user_id}get username(){return this.#i.username}get _cursor_data(){return this.#n}constructor({core:t,client_info:e,client_meta_data:n}){this.#t=t,this.#i=e,this._updateFromClientMetaData({client_meta_data:n})}async getCameraEntities(){return(await Promise.all(this.#e.map(e=>this.#t.scene._findEntity({entity_rtid:e})))).filter(e=>e!=null)}async getHoveredEntity(){return this.#n==null?null:await this.#t.scene._findEntity({entity_rtid:this.#n.hovered_entity_rtid})}_updateFromClientMetaData({client_meta_data:t}){this.#e=t.viewports.map(e=>e.camera_rtid),t.hovered_entity_rtid!=0n?this.#n={hovered_entity_rtid:t.hovered_entity_rtid,hovered_ws_position:t.ws_hovered_position,hovered_ws_normal:t.ws_hovered_normal}:this.#n=null}};var Ve=class extends Event{viewports;constructor({viewports:t}){super("TO_REMOVE__viewports-added"),this.viewports=t}},Ue=class extends Event{reason;constructor({reason:t}){super("on-disconnected"),this.reason=t}},ke=class extends Event{seconds_remaining;resetTimer;constructor({seconds_remaining:t,reset_timer:e}){super("on-inactivity-warning"),this.seconds_remaining=t,this.resetTimer=e}},Ie=class extends Event{constructor(){super("on-activity-detected")}},Ne=class extends Event{client;constructor({client:t}){super("on-client-joined"),this.client=t}},Be=class extends Event{client;constructor({client:t}){super("on-client-left"),this.client=t}};var ge=class i extends mt{static async create({scene_id:t,token:e,is_transient:n}){let r=await fetch(`${yt._api_url}/sessions`,{method:"POST",body:JSON.stringify({scene_id:t,is_transient:n}),headers:{"Content-Type":"application/json",user_token:e}});if(!r.ok)throw new Error("Error when creating session");let s=await r.json();return new i({token:e,session_info:{...s,scene_id:t,is_transient_session:n??!1},created:!0})}static async find({scene_id:t,token:e,session_selector:n}){let s=await(await fetch(`${yt._api_url}/sessions?filters[scene_id]=${t}`,{method:"GET",headers:{user_token:e}})).json();if(s.length===0)return null;let o=n({sessions:s});return o?new i({token:e,session_info:o,created:!1}):null}static async findById({session_id:t,token:e}){let n=await fetch(`${yt._api_url}/sessions/${t}`,{method:"GET",headers:{user_token:e}});if(!n.ok)return`${t}`,null;let r=await n.json();return new i({token:e,session_info:r,created:!1})}static async findByGuestToken({guest_token:t}){let e=await fetch(`${yt._api_url}/sessions`,{method:"GET",headers:{guest_token:t}});if(!e.ok)throw new Error("Could not find session as guest, guest token might be expired");let[n]=await e.json();return new i({token:t,session_info:n,created:!1,is_guest:!0})}info;has_been_created;client_id=null;token;is_guest=!1;#t=null;#i=null;#e=new Map;#n=new Set;get scene_id(){return this.info.scene_id}get session_id(){return this.info.session_id}get client_ids(){return Array.from(this.#e.keys())}get clients(){return Array.from(this.#e.values())}get other_clients(){return Array.from(this.#e.values()).filter(t=>t.id!==this.client_id)}get current_client(){return this.client_id?this.#e.get(this.client_id)??null:null}get gateway_url(){return this.#t}get session_key(){return this.#i}get#r(){return this.is_guest?{guest_token:this.token}:{user_token:this.token}}constructor({token:t,session_info:e,created:n,is_guest:r=!1}){super(),this.token=t,this.info=e,this.has_been_created=n,this.is_guest=r}isJoinable(){return this.#t!==null&&this.#i!==null}async registerClient(){let t=await fetch(`${yt._api_url}/sessions/${this.session_id}/clients`,{method:"POST",headers:this.#r}),{session_token:e,endpoint_info:n}=await t.json(),r=n.ssl_port?"wss":"ws",s=n.ssl_port!==0?n.ssl_port:n.port;this.#t=`${r}://${n.ip}:${s}`,this.#i=e}async close(){if(this.info===null)throw new Error("Cannot close session as it has not been opened yet");await fetch(`${yt._api_url}/sessions/${this.session_id}`,{method:"DELETE",headers:this.#r})}getClient({client_id:t}){return this.#e.get(t)??null}async evictClient({client:t}){let e=t instanceof ve?t.id:t;return(await fetch(`${yt._api_url}/sessions/${this.session_id}/clients/${e}`,{method:"DELETE",headers:this.#r})).ok}_onDisconnected=t=>{this._dispatchEvent(new Ue({reason:t.reason}))};_onInactivityWarning=t=>{this._dispatchEvent(new ke({seconds_remaining:t.seconds_remaining,reset_timer:t.resetTimer}))};_onActivityDetected=t=>{this._dispatchEvent(new Ie)};_updateClients({core:t,client_data:e}){for(let n of e){let r=n.client_id;if(this.#n.has(r))continue;let s=this.#e.get(r);s?this.#s({client:s,client_meta_data:n}):this.#o({core:t,client_meta_data:n})}this.#a({client_data:e})}async#o({core:t,client_meta_data:e}){if(e.viewports.length===0)return;let n=e.client_id;this.#n.add(n);let r=null;try{r=await this.#l({client_id:e.client_id})}catch(o){console.error("Could not get info for client",n,o),r={client_id:n,client_type:"unknown",user_id:"",username:"unknown user"}}let s=new ve({core:t,client_info:r,client_meta_data:e});this.#c({client:s}),this.#n.delete(n)}#s({client:t,client_meta_data:e}){t._updateFromClientMetaData({client_meta_data:e})}#a({client_data:t}){let e=t.map(n=>n.client_id);for(let[n]of this.#e)e.includes(n)||this.#h({client_id:n})}#c({client:t}){this.#e.set(t.id,t),t.id!==this.client_id&&this._dispatchEvent(new Ne({client:t}))}#h({client_id:t}){let e=this.getClient({client_id:t});e&&(this.#e.delete(t),this._dispatchEvent(new Be({client:e})))}async#l({client_id:t}){return await(await fetch(`${yt._api_url}/sessions/${this.session_id}/clients/${t}`,{method:"GET",headers:this.#r})).json()}};var He=class{#t;#i=!1;#e={x:0,y:0};#n=new Map;constructor(t){this.#t=t,typeof document<"u"&&document.addEventListener("pointerlockchange",this.#c)}enableOnViewport({viewport:t}){let e=this.#n.get(t);if(e){e.ref_count++;return}let n=t.dom_element,r=new AbortController;n.addEventListener("mousedown",s=>this.#r({viewport:t,event:s}),{signal:r.signal}),n.addEventListener("mouseup",s=>this.#o({viewport:t,event:s}),{signal:r.signal}),n.addEventListener("mousemove",s=>this.#s({viewport:t,event:s}),{signal:r.signal}),this.#n.set(t,{dom_element:n,abort_controller:r,ref_count:1})}disableFromViewport({viewport:t}){let e=this.#n.get(t);if(!e){console.warn("Attempt to release mouse on a viewport that is not set up",t);return}--e.ref_count>0||(e.abort_controller.abort(),this.#n.delete(t))}#r=({viewport:t,event:e})=>{if(e.button>2){console.warn("MouseInput: Unsupported mouse button",e.button);return}e.stopPropagation();let n=this.#a(e),r=this.#h({viewport:t,x:n.x,y:n.y});this.#t._sendInput({input_state:{input_operation:["lbutton_down","mbutton_down","rbutton_down"][e.button],input_data:r}})};#o=({viewport:t,event:e})=>{if(e.button>2){console.warn("MouseInput: Unsupported mouse button",e.button);return}e.stopPropagation();let n=this.#a(e),r=this.#h({viewport:t,x:n.x,y:n.y});this.#t._sendInput({input_state:{input_operation:["lbutton_up","mbutton_up","rbutton_up"][e.button],input_data:r}})};#s=({viewport:t,event:e})=>{e.stopPropagation();let n=this.#a(e),r=this.#h({viewport:t,x:n.x,y:n.y});this.#t._sendInput({input_state:{input_operation:"mouse_move",input_data:r}})};#a(t){let e=t;return this.#i?(this.#e.x+=e.movementX,this.#e.y+=e.movementY):(this.#e.x=e.clientX,this.#e.y=e.clientY),this.#e}#c=()=>{let t=Array.from(this.#n.values());this.#i=t.some(e=>document.pointerLockElement===e.dom_element)};#h({viewport:t,x:e,y:n,bufferSize:r=8}){let s=new ArrayBuffer(r),o=new DataView(s),[a,h]=this.#t._projectViewportPositionOnRemoteFrame({viewport:t,position:[e,n]});return o.setFloat32(0,a,!0),o.setFloat32(4,h,!0),new Uint8Array(s)}};var Ye=class{#t;constructor(t){this.#t=t}enable(){window.addEventListener("keydown",this.#i),window.addEventListener("keyup",this.#e),window.addEventListener("blur",this.#n)}disable(){window.removeEventListener("keydown",this.#i),window.removeEventListener("keyup",this.#e),window.removeEventListener("blur",this.#n),this.#n()}#i=t=>{t.preventDefault();let e=this.#r(t);this.#t._sendInput({input_state:{input_operation:"on_key_down",input_data:e}})};#e=t=>{t.preventDefault();let e=this.#r(t);this.#t._sendInput({input_state:{input_operation:"on_key_up",input_data:e}})};#n=()=>{this.#t._sendInput({input_state:{input_operation:"reset"}})};#r(t){let e=this.#o(t),n=new Uint8Array(4);return n[0]=e&255,n[1]=e>>8&255,n[2]=e>>16&255,n[3]=e>>24&255,n}#o(t){let{code:e,key:n}=t;if(!e?.startsWith("Key"))return t.keyCode;let r=e[e.length-1];return r!==n?r.charCodeAt(0):t.keyCode}};var Ci=class{#t=2;#i=44100;#e=32;#n=1;#r;#o=0;constructor(){this.#r=new AudioContext({sampleRate:this.#i,latencyHint:"interactive"}),this.#o=this.#r.currentTime}release(){this.#r.close()}playAudioPacket({packet:t}){let e=new Float32Array(t.buffer,t.byteOffset),n=t.byteLength/(this.#e/8*this.#t);this.#s({samples:e,sample_count:n})}#s({samples:t,sample_count:e}){let n=this.#r.createBufferSource();n.buffer=this.#a({samples:t,sample_count:e}),n.connect(this.#r.destination),this.#o<=this.#r.currentTime&&(this.#o=.1+this.#r.currentTime+e/this.#i),n.start(this.#o),this.#o+=e/this.#i}#a({samples:t,sample_count:e}){let n=this.#r.createBuffer(this.#t,e,this.#i);for(let r=0;r<this.#t;r++){let s=n.getChannelData(r);for(let o=0;o<e;o++)s[o]=t[r*e+o]*this.#n}return n}};var Rh=[4,8,16,32,1024,2048,0,0,2,1,4096,8192,64,128,256,512],Ah={A:0,B:1,X:2,Y:3,LeftShoulder:4,RightShoulder:5,LeftTrigger:6,RightTrigger:7,View:8,Menu:9,LeftThumbstick:10,RightThumbstick:11,DPadUp:12,DPadDown:13,DPadLeft:14,DPadRight:15},tt={LeftThumbstickX:0,LeftThumbstickY:1,RightThumbstickX:2,RightThumbstickY:3,LeftTrigger:4,RightTrigger:5},Mi={Left:[tt.LeftThumbstickX,tt.LeftThumbstickY],Right:[tt.RightThumbstickX,tt.RightThumbstickY]},Xr=({currentReading:i,button:t,isPressed:e})=>{let n=Rh[t];return i&~n|-Number(e)&n},re=class{#t;#i;#e={buttons:0,axes:{[tt.LeftThumbstickX]:0,[tt.LeftThumbstickY]:0,[tt.RightThumbstickX]:0,[tt.RightThumbstickY]:0,[tt.LeftTrigger]:0,[tt.RightTrigger]:0}};constructor({instance:t,index:e}){this.#t=t,this.#i=e}setAxis=({axis:t,value:e})=>{this.#e.axes[t]!=e&&(this.#e.axes[t]=e,this.#n({axis:t}))};setJoystick=({joystick:t,value:e})=>{this.setAxis({axis:t[0],value:e[0]}),this.setAxis({axis:t[1],value:e[1]})};setButton=({button:t,isPressed:e})=>{let n=Xr({currentReading:this.#e.buttons,button:t,isPressed:e});n!=this.#e.buttons&&(this.#e.buttons=n,this.#r())};setButtons=({buttons:t})=>{let e=this.#e.buttons;for(let n=0;n<t.length;n++){let r=t[n];e=Xr({currentReading:e,button:n,isPressed:r})}this.#e.buttons!=e&&(this.#e.buttons=e,this.#r())};resetInput=()=>{this.setAxis({axis:tt.LeftThumbstickX,value:0}),this.setAxis({axis:tt.LeftThumbstickY,value:0}),this.setAxis({axis:tt.RightThumbstickX,value:0}),this.setAxis({axis:tt.RightThumbstickY,value:0}),this.setAxis({axis:tt.LeftTrigger,value:0}),this.setAxis({axis:tt.RightTrigger,value:0}),this.#e.buttons=0,this.#r()};#n({axis:t}){let e=new ArrayBuffer(6),n=new DataView(e);n.setUint8(0,this.#i),n.setUint8(1,t),n.setFloat32(2,this.#e.axes[t],!0),this.#t._sendInput({input_state:{input_operation:"gamepad_axis",input_data:new Uint8Array(e)}})}#r(){let t=new ArrayBuffer(5),e=new DataView(t);e.setUint8(0,this.#i),e.setUint16(1,this.#e.buttons,!0),this.#t._sendInput({input_state:{input_operation:"gamepad_buttons",input_data:new Uint8Array(t)}})}};var Ge=class{#t=1e3/60;#i=null;#e;#n;constructor({instance:t,index:e,physicalIndex:n}){this.#e=new re({instance:t,index:e}),this.#n=n}enable(){window.addEventListener("focus",this.#r),window.document.hasFocus()&&this.#s()}disable(){this.#a(),this.#e.resetInput(),window.removeEventListener("focus",this.#r)}#r=()=>{this.#s()};#o=()=>{let t=navigator.getGamepads()[this.#n];if(!t||!window.document.hasFocus()){this.#a(),this.#e.resetInput();return}let e=t.buttons.map(n=>n.pressed);this.#e.setButtons({buttons:e}),this.#e.setJoystick({joystick:Mi.Left,value:[-t.axes[0],t.axes[1]]}),this.#e.setJoystick({joystick:Mi.Right,value:[-t.axes[2],t.axes[3]]}),this.#e.setAxis({axis:tt.LeftTrigger,value:t.buttons[6].value}),this.#e.setAxis({axis:tt.RightTrigger,value:t.buttons[7].value}),this.#s()};#s=()=>{this.#a(),this.#i=setTimeout(()=>{this.#o(),this.#i=null},this.#t)};#a=()=>{this.#i&&(clearTimeout(this.#i),this.#i=null)}};var Ti=class{#t;#i=[];constructor({instance:t}){this.#t=t}enable(){let t=navigator.getGamepads();this.#i=Array(t.length).fill(null);for(let e=0;e<t.length;e++){let n=t[e];n&&n.connected&&(this.#i[e]=new Ge({instance:this.#t,index:0,physicalIndex:e}),this.#i[e].enable())}window.addEventListener("gamepadconnected",this.#e),window.addEventListener("gamepaddisconnected",this.#n)}disable(){window.removeEventListener("gamepadconnected",this.#e),window.removeEventListener("gamepaddisconnected",this.#n);for(let t of this.#i)t&&t.disable();this.#i=[]}createVirtualGamepad(){return new re({instance:this.#t,index:0})}#e=t=>{let e=t.gamepad,n=e.index;e&&e.connected&&(this.#i[n]=new Ge({instance:this.#t,index:0,physicalIndex:e.index}),this.#i[n].enable())};#n=t=>{let e=t.gamepad.index;this.#i[e]&&(this.#i[e].disable(),this.#i[e]=null)}};var yt=class i{static _api_url="https://api.3dverse.com/app/v1";static async start({scene_id:t,token:e,is_transient:n}){`${t}`;let r=await ge.create({scene_id:t,token:e,is_transient:n});return await i.join({session:r})}static async join_or_start({scene_id:t,token:e,session_selector:n=({sessions:s})=>s[0],is_transient:r}){`${t}`;let s=await ge.find({scene_id:t,token:e,session_selector:n});if(s===null)return`${t}`,await i.start({scene_id:t,token:e,is_transient:r});try{return await i.join({session:s})}catch{return console.error(`Failed to join session '${s.session_id}', trying again with another session.`),await i.join_or_start({scene_id:t,token:e,session_selector:({sessions:o})=>(o=o.filter(a=>a.session_id!==s.session_id),o.length===0?null:n({sessions:o}))})}}static async join({session:t}){return await cn.load(),new i({session:t}).#l()}session;scene;#t;#i=null;#e=new ui(this);#n=null;#r=new Ci;#o;#s;#a;#c=null;#h=null;get default_decoded_frame_consumer(){return this.#e}get activity_watcher(){return this.#t.activity_watcher}get latency(){return this.#t.latency}get viewports(){return this.#e.viewports}constructor({session:t}){this.session=t,this.#t=new cn.Core,this.scene=new Le(this.#t),this.#o=new He(this),this.#s=new Ye(this),this.#a=new Ti({instance:this})}async disconnect(){this.#m(),this.#c&&clearInterval(this.#c),this.#h&&clearInterval(this.#h),this.#n!==null&&this.#n.release(),this.#e.release(),this.#r.release(),await this.#t.disconnect()}addViewports({viewports:t}){this.#e.addViewports({viewports:t}),this.session._dispatchEvent(new Ve({viewports:t}))}removeViewport({viewport:t}){this.#e.removeViewport({viewport:t})}async configureRemoteServer({codec:t="h264"}){let e={remote_canvas_size:this.#e._computeRemoteCanvasSize({codec:t}),encoder_config:{codec:t,profile:"main",frame_rate:60,lossy:!0},supported_devices:{keyboard:!0,mouse:!0,gamepad:!0,hololens:!1,touchscreen:!1}};this.#e.dimensions;let n=await this.#t.configureClient({client_config:e});return this.#i=n.codec,n}isConfigured(){return this.#i!==null}async setEncodedFrameConsumer({encoded_frame_consumer:t}){if(this.#i===null)throw new Error("Client not configured.");this.#n=await t.configure({codec:this.#i,frame_dimensions:this.#e.dimensions})}startStreaming(){if(!this.isConfigured())throw new Error("The Livelink instance is not configured yet");this.#e.init(),this.#t.resume(),this.#_({})}startSimulation(){this.#t.setSimulationState({state:"start_simulation"})}pauseSimulation(){this.#t.setSimulationState({state:"pause_simulation"})}stopSimulation(){this.#t.setSimulationState({state:"stop_simulation"})}sendSkeletonPose({controller:t,partial_pose:e}){this.#t.sendSkeletonPose({controller_rtid:t.rtid,partial_pose:e})}get devices(){return{mouse:this.#o,keyboard:this.#s,gamepads_registry:this.#a}}async configureHeadlessClient(){let t={remote_canvas_size:[256,256],encoder_config:{codec:"h264",profile:"main",frame_rate:30,lossy:!0},supported_devices:{keyboard:!0,mouse:!1,gamepad:!1,hololens:!1,touchscreen:!1}},e=await this.#t.configureClient({client_config:t});return this.#i=e.codec,e}_sendInput({input_state:t}){this.#t.sendInputState({input_state:t})}async _resize({size:t}){let{size:e}=await this.#t.resize({size:t});this.#n?.resize({frame_dimensions:e})}_setViewports({viewport_configs:t}){this.#t.setViewports({viewport_configs:t})}async _castScreenSpaceRay({screenSpaceRayQuery:t}){return this.#t.castScreenSpaceRay({screenSpaceRayQuery:t})}_refreshViewports(){this.#f||(this.#v!==null&&clearTimeout(this.#v),this.#v=setTimeout(()=>{this.#e.init()},0))}_projectViewportPositionOnRemoteFrame({viewport:t,position:e}){let n=this.#e.width,r=this.#e.height,s=t._getScreenPosition({position:e}),o=[t.rendering_surface.relative_rect.left*n,t.rendering_surface.relative_rect.top*r],a=[o[0]+t.offset[0],o[1]+t.offset[1]];return[(a[0]+s[0]*t.width)/n,(a[1]+s[1]*t.height)/r]}async#l(){return await this.session.registerClient(),await this.#t.connect({session:this.session}),this.#d(),this}#d(){this.#t.addEventListener("on-disconnected",this.session._onDisconnected),this.#t.addEventListener("on-inactivity-warning",this.session._onInactivityWarning),this.#t.addEventListener("on-activity-detected",this.session._onActivityDetected),this.#t.addEventListener("on-frame-received",this.#u),this.#t.addEventListener("on-audio-received",this.#p),this.#t.addEventListener("on-entities-updated",this.#y),this.#t.addEventListener("on-entity-visibility-changed",this.scene._onEntityVisibilityChanged),this.#t.addEventListener("on-script-event-received",this.scene._onScriptEventReceived)}#m(){this.#t.removeEventListener("on-disconnected",this.session._onDisconnected),this.#t.removeEventListener("on-inactivity-warning",this.session._onInactivityWarning),this.#t.removeEventListener("on-activity-detected",this.session._onActivityDetected),this.#t.removeEventListener("on-frame-received",this.#u),this.#t.removeEventListener("on-audio-received",this.#p),this.#t.removeEventListener("on-entities-updated",this.#y),this.#t.removeEventListener("on-entity-visibility-changed",this.scene._onEntityVisibilityChanged),this.#t.removeEventListener("on-script-event-received",this.scene._onScriptEventReceived)}#u=({encoded_frame:t,meta_data:e})=>{this.session._updateClients({core:this,client_data:e.clients});let n=ln({raw_frame_meta_data:e,client_id:this.session.client_id,entity_registry:this.scene._entity_registry,viewports:this.viewports});this.#n.consumeEncodedFrame({encoded_frame:{video_stream:t,meta_data:n}})};#p=({packet:t})=>{this.#r.playAudioPacket({packet:t})};#y=({updated_entities:t})=>{for(let{entity_euid:e,updated_components:n}of t)this.scene._updateEntityFromEvent({entity_euid:e,updated_components:n})};#_({updatesPerSecond:t=30,broadcastsPerSecond:e=1}){this.#c=setInterval(()=>{let n=this.scene._entity_registry._getEntitiesToUpdate();n.length>0&&this.#t.updateEntities({update_commands:n,persist:!1})},1e3/t),this.#h=setInterval(()=>{let n=this.scene._entity_registry._getEntitiesToPersist();n.length>0&&this.#t.updateEntities({update_commands:n,persist:!0})},1e3/e)}#f=null;#v=null;TO_REMOVE__setReadyCallback(t){this.#f=t}TO_REMOVE__startIfReady(){this.isConfigured()&&(this.viewports.some(t=>!t.TO_REMOVE__ready)||this.#f&&(this.#f(),this.#f=null))}};var qe=class extends Event{hovered_entity;ws_position;ws_normal;constructor({hovered_entity:t,ws_position:e,ws_normal:n}){super("on-entity-hovered"),this.hovered_entity=t,this.ws_position=e,this.ws_normal=n}},je=class extends Event{picked_entity;ws_position;ws_normal;constructor({picked_entity:t,ws_position:e,ws_normal:n}){super("on-entity-picked"),this.picked_entity=t,this.ws_position=e,this.ws_normal=n}};var gn=class extends mt{#t(){this.TO_REMOVE__ready=!0,this.#i.TO_REMOVE__startIfReady()}TO_REMOVE__ready=!1;#i;#e;#n=[];#r=null;#o=null;#s=0;#a;#c=-1;#h=!1;#l=!1;is_camera_controlled_by_current_client=!1;get rendering_surface(){return this.#e}get camera_projection(){return this.#o}get width(){return this.#a.width*this.rendering_surface.width}get height(){return this.#a.height*this.rendering_surface.height}get offset(){return[this.#a.left*this.rendering_surface.width,this.#a.top*this.rendering_surface.height]}get aspect_ratio(){return this.height>0?this.width/this.height:1}get z_index(){return this.#s}get render_target_index(){return this.#c}get relative_rect(){return this.#a}get dom_element(){if(!this.#r)throw new Error("No DOM element set on viewport");return this.#r}get overlay_dom_elements(){return this.#n.map(t=>t.container).filter(Boolean)}set z_index(t){this.#s=t,this.#i._refreshViewports()}set relative_rect(t){this.#a=t,this.#i._refreshViewports()}set camera_projection(t){this.#o=t,this.#i._refreshViewports(),this.#t()}set render_target_index(t){this.#c=t,this.#i._refreshViewports()}constructor({core:t,rendering_surface:e,options:n}){super(),this.#i=t,this.#e=e,this.#a=new ct(n?.rect??{left:0,top:0,width:1,height:1}),this.#c=n?.render_target_index??-1,this.#s=n?.z_index??0,this.#r=n?.dom_element??null}isValid(){return this.#o!==null}release(){this.deactivatePicking(),this.deactivateHovering()}activatePicking(){this.#h||(this.dom_element.addEventListener("click",this.#d),this.#i.devices.mouse.enableOnViewport({viewport:this}),this.#h=!0)}deactivatePicking(){this.#h&&(this.dom_element.removeEventListener("click",this.#d),this.#i.devices.mouse.disableFromViewport({viewport:this}),this.#h=!1)}activateHovering(){this.#l||(this.dom_element.addEventListener("pointermove",this.#m),this.#i.devices.mouse.enableOnViewport({viewport:this}),this.#l=!0)}deactivateHovering(){this.#l&&(this.dom_element.removeEventListener("pointermove",this.#m),this.#i.devices.mouse.disableFromViewport({viewport:this}),this.#l=!1)}async castScreenSpaceRay({screen_position:t,mode:e="None"}){if(!this.#o)return null;let n=await this.#i._castScreenSpaceRay({screenSpaceRayQuery:{camera_rtid:this.#o.camera_entity.rtid,pos:t,mode:e}});if(n.entity_rtid===null)return null;let r=await this.#i.scene._findEntity({entity_rtid:n.entity_rtid});return r===null?null:{entity:r,world_position:n.position,world_normal:n.normal}}projectWorldToScreen({world_position:t,out_screen_position:e=L.create()}){if(!this.#o)throw new Error("No camera set on viewport");let n=this.#o.projectWorldToClip({world_position:t,out_clip_position:e}),r=n;return r[0]=(n[0]+1)*this.width*.5,r[1]=(-n[1]+1)*this.height*.5,r}addOverlay({overlay:t}){if(this.#n.includes(t)){console.warn("Attempting to add an overlay that is already present",t);return}this.#n.push(t),this.rendering_surface.redrawLastFrame()}removeOverlay({overlay:t}){t.release();let e=this.#n.indexOf(t);if(e===-1){console.warn("Attempting to remove an overlay that is not present",t);return}this.#n.splice(e,1),this.rendering_surface.redrawLastFrame()}_drawOverlays(){let t=null;for(let e of this.#n){let n=e.draw({output_canvas:t});t||(t=n)}return t}_onResize(){this.camera_projection?.updateProjectionMatrix();for(let t of this.#n)t.resize({width:this.width,height:this.height})}getScreenPositionFromEvent({event:t}){return this._getScreenPosition({position:[t.clientX,t.clientY]})}_getScreenPosition({position:t}){let e=this.dom_element.getBoundingClientRect(),n=(t[0]-e.left)/e.width,r=(t[1]-e.top)/e.height;return[n,r]}#d=async t=>{t.stopPropagation();let e=null,n=this.#i.session.current_client?._cursor_data;if(n){let r=await this.#i.scene._findEntity({entity_rtid:n.hovered_entity_rtid});r&&(e={entity:r,ws_position:n.hovered_ws_position,ws_normal:n.hovered_ws_normal})}this._dispatchEvent(new je({picked_entity:e?.entity??null,ws_position:e?.ws_position??null,ws_normal:e?.ws_normal??null}))};#m=async()=>{let t=null,e=this.#i.session.current_client?._cursor_data;if(e){let n=await this.#i.scene._findEntity({entity_rtid:e.hovered_entity_rtid});n&&(t={entity:n,ws_position:e.hovered_ws_position,ws_normal:e.hovered_ws_normal})}this._dispatchEvent(new qe({hovered_entity:t?.entity??null,ws_position:t?.ws_position??null,ws_normal:t?.ws_normal??null}))}};var Nt="srgb",Tn="srgb-linear";var Kt=class i{constructor(t=0,e=0){i.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}rotateAround(t,e){let n=Math.cos(e),r=Math.sin(e),s=this.x-t.x,o=this.y-t.y;return this.x=s*n-o*r+t.x,this.y=s*r+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}};var jl=Math.PI/180,Xl=180/Math.PI;function lt(i,t,e){return Math.max(t,Math.min(e,i))}function Sh(i,t){return(i%t+t)%t}function xn(i,t,e){return(1-e)*i+e*t}var bt=class{constructor(t=0,e=0,n=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=r}static slerpFlat(t,e,n,r,s,o,a){let h=n[r+0],c=n[r+1],l=n[r+2],d=n[r+3],m=s[o+0],u=s[o+1],p=s[o+2],f=s[o+3];if(a===0){t[e+0]=h,t[e+1]=c,t[e+2]=l,t[e+3]=d;return}if(a===1){t[e+0]=m,t[e+1]=u,t[e+2]=p,t[e+3]=f;return}if(d!==f||h!==m||c!==u||l!==p){let _=1-a,y=h*m+c*u+l*p+d*f,M=y>=0?1:-1,v=1-y*y;if(v>Number.EPSILON){let E=Math.sqrt(v),w=Math.atan2(E,y*M);_=Math.sin(_*w)/E,a=Math.sin(a*w)/E}let x=a*M;if(h=h*_+m*x,c=c*_+u*x,l=l*_+p*x,d=d*_+f*x,_===1-a){let E=1/Math.sqrt(h*h+c*c+l*l+d*d);h*=E,c*=E,l*=E,d*=E}}t[e]=h,t[e+1]=c,t[e+2]=l,t[e+3]=d}static multiplyQuaternionsFlat(t,e,n,r,s,o){let a=n[r],h=n[r+1],c=n[r+2],l=n[r+3],d=s[o],m=s[o+1],u=s[o+2],p=s[o+3];return t[e]=a*p+l*d+h*u-c*m,t[e+1]=h*p+l*m+c*d-a*u,t[e+2]=c*p+l*u+a*m-h*d,t[e+3]=l*p-a*d-h*m-c*u,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){let n=t._x,r=t._y,s=t._z,o=t._order,a=Math.cos,h=Math.sin,c=a(n/2),l=a(r/2),d=a(s/2),m=h(n/2),u=h(r/2),p=h(s/2);switch(o){case"XYZ":this._x=m*l*d+c*u*p,this._y=c*u*d-m*l*p,this._z=c*l*p+m*u*d,this._w=c*l*d-m*u*p;break;case"YXZ":this._x=m*l*d+c*u*p,this._y=c*u*d-m*l*p,this._z=c*l*p-m*u*d,this._w=c*l*d+m*u*p;break;case"ZXY":this._x=m*l*d-c*u*p,this._y=c*u*d+m*l*p,this._z=c*l*p+m*u*d,this._w=c*l*d-m*u*p;break;case"ZYX":this._x=m*l*d-c*u*p,this._y=c*u*d+m*l*p,this._z=c*l*p-m*u*d,this._w=c*l*d+m*u*p;break;case"YZX":this._x=m*l*d+c*u*p,this._y=c*u*d+m*l*p,this._z=c*l*p-m*u*d,this._w=c*l*d-m*u*p;break;case"XZY":this._x=m*l*d-c*u*p,this._y=c*u*d-m*l*p,this._z=c*l*p+m*u*d,this._w=c*l*d+m*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,n=e[0],r=e[4],s=e[8],o=e[1],a=e[5],h=e[9],c=e[2],l=e[6],d=e[10],m=n+a+d;if(m>0){let u=.5/Math.sqrt(m+1);this._w=.25/u,this._x=(l-h)*u,this._y=(s-c)*u,this._z=(o-r)*u}else if(n>a&&n>d){let u=2*Math.sqrt(1+n-a-d);this._w=(l-h)/u,this._x=.25*u,this._y=(r+o)/u,this._z=(s+c)/u}else if(a>d){let u=2*Math.sqrt(1+a-n-d);this._w=(s-c)/u,this._x=(r+o)/u,this._y=.25*u,this._z=(h+l)/u}else{let u=2*Math.sqrt(1+d-n-a);this._w=(o-r)/u,this._x=(s+c)/u,this._y=(h+l)/u,this._z=.25*u}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(lt(this.dot(t),-1,1)))}rotateTowards(t,e){let n=this.angleTo(t);if(n===0)return this;let r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let n=t._x,r=t._y,s=t._z,o=t._w,a=e._x,h=e._y,c=e._z,l=e._w;return this._x=n*l+o*a+r*c-s*h,this._y=r*l+o*h+s*a-n*c,this._z=s*l+o*c+n*h-r*a,this._w=o*l-n*a-r*h-s*c,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);let n=this._x,r=this._y,s=this._z,o=this._w,a=o*t._w+n*t._x+r*t._y+s*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;let h=1-a*a;if(h<=Number.EPSILON){let u=1-e;return this._w=u*o+e*this._w,this._x=u*n+e*this._x,this._y=u*r+e*this._y,this._z=u*s+e*this._z,this.normalize(),this._onChangeCallback(),this}let c=Math.sqrt(h),l=Math.atan2(c,a),d=Math.sin((1-e)*l)/c,m=Math.sin(e*l)/c;return this._w=o*d+this._w*m,this._x=n*d+this._x*m,this._y=r*d+this._y*m,this._z=s*d+this._z*m,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){let t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(e*Math.cos(r),n*Math.sin(s),n*Math.cos(s),e*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},D=class i{constructor(t=0,e=0,n=0){i.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Wr.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Wr.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,n=this.y,r=this.z,s=t.elements;return this.x=s[0]*e+s[3]*n+s[6]*r,this.y=s[1]*e+s[4]*n+s[7]*r,this.z=s[2]*e+s[5]*n+s[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,n=this.y,r=this.z,s=t.elements,o=1/(s[3]*e+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*e+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*e+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*e+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(t){let e=this.x,n=this.y,r=this.z,s=t.x,o=t.y,a=t.z,h=t.w,c=h*e+o*r-a*n,l=h*n+a*e-s*r,d=h*r+s*n-o*e,m=-s*e-o*n-a*r;return this.x=c*h+m*-s+l*-a-d*-o,this.y=l*h+m*-o+d*-s-c*-a,this.z=d*h+m*-a+c*-o-l*-s,this}transformDirection(t){let e=this.x,n=this.y,r=this.z,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r,this.y=s[1]*e+s[5]*n+s[9]*r,this.z=s[2]*e+s[6]*n+s[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){let n=t.x,r=t.y,s=t.z,o=e.x,a=e.y,h=e.z;return this.x=r*h-s*a,this.y=s*o-n*h,this.z=n*a-r*o,this}projectOnVector(t){let e=t.lengthSq();if(e===0)return this.set(0,0,0);let n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return En.copy(this).projectOnVector(t),this.sub(En)}reflect(t){return this.sub(En.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;let n=this.dot(t)/e;return Math.acos(lt(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){let r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},En=new D,Wr=new bt;var Ze=class{constructor(t=new D(1/0,1/0,1/0),e=new D(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;for(let h=0,c=t.length;h<c;h+=3){let l=t[h],d=t[h+1],m=t[h+2];l<e&&(e=l),d<n&&(n=d),m<r&&(r=m),l>s&&(s=l),d>o&&(o=d),m>a&&(a=m)}return this.min.set(e,n,r),this.max.set(s,o,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let n=Xe.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t=new D){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t=new D){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Xe),Xe.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(We),bi.subVectors(this.max,We),xe.subVectors(t.a,We),Ee.subVectors(t.b,We),we.subVectors(t.c,We),Xt.subVectors(Ee,xe),Wt.subVectors(we,Ee),se.subVectors(xe,we);let e=[0,-Xt.z,Xt.y,0,-Wt.z,Wt.y,0,-se.z,se.y,Xt.z,0,-Xt.x,Wt.z,0,-Wt.x,se.z,0,-se.x,-Xt.y,Xt.x,0,-Wt.y,Wt.x,0,-se.y,se.x,0];return!wn(e,xe,Ee,we,bi)||(e=[1,0,0,0,1,0,0,0,1],!wn(e,xe,Ee,we,bi))?!1:(Ri.crossVectors(Xt,Wt),e=[Ri.x,Ri.y,Ri.z],wn(e,xe,Ee,we,bi))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Xe.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(Xe).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(It[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),It[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),It[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),It[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),It[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),It[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),It[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),It[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(It),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},It=[new D,new D,new D,new D,new D,new D,new D,new D],Xe=new D;var xe=new D,Ee=new D,we=new D,Xt=new D,Wt=new D,se=new D,We=new D,bi=new D,Ri=new D,oe=new D;function wn(i,t,e,n,r){for(let s=0,o=i.length-3;s<=o;s+=3){oe.fromArray(i,s);let a=r.x*Math.abs(oe.x)+r.y*Math.abs(oe.y)+r.z*Math.abs(oe.z),h=t.dot(oe),c=e.dot(oe),l=n.dot(oe);if(Math.max(-Math.max(h,c,l),Math.min(h,c,l))>a)return!1}return!0}function Oi(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function Di(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}var Cn={[Nt]:{[Tn]:Oi},[Tn]:{[Nt]:Di}},at={legacyMode:!0,get workingColorSpace(){return Tn},set workingColorSpace(i){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(i,t,e){if(this.legacyMode||t===e||!t||!e)return i;if(Cn[t]&&Cn[t][e]!==void 0){let n=Cn[t][e];return i.r=n(i.r),i.g=n(i.g),i.b=n(i.b),i}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(i,t){return this.convert(i,this.workingColorSpace,t)},toWorkingColorSpace:function(i,t){return this.convert(i,t,this.workingColorSpace)}},Qr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},it={r:0,g:0,b:0},Mt={h:0,s:0,l:0},Ai={h:0,s:0,l:0};function Mn(i,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?i+(t-i)*6*e:e<1/2?t:e<2/3?i+(t-i)*6*(2/3-e):i}function Si(i,t){return t.r=i.r,t.g=i.g,t.b=i.b,t}var bn=class{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,e===void 0&&n===void 0?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Nt){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,at.toWorkingColorSpace(this,e),this}setRGB(t,e,n,r=at.workingColorSpace){return this.r=t,this.g=e,this.b=n,at.toWorkingColorSpace(this,r),this}setHSL(t,e,n,r=at.workingColorSpace){if(t=Sh(t,1),e=lt(e,0,1),n=lt(n,0,1),e===0)this.r=this.g=this.b=n;else{let s=n<=.5?n*(1+e):n+e-n*e,o=2*n-s;this.r=Mn(o,s,t+1/3),this.g=Mn(o,s,t),this.b=Mn(o,s,t-1/3)}return at.toWorkingColorSpace(this,r),this}setStyle(t,e=Nt){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let s,o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,at.toWorkingColorSpace(this,e),n(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,at.toWorkingColorSpace(this,e),n(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let h=parseFloat(s[1])/360,c=parseFloat(s[2])/100,l=parseFloat(s[3])/100;return n(s[4]),this.setHSL(h,c,l,e)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){let s=r[1],o=s.length;if(o===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,at.toWorkingColorSpace(this,e),this;if(o===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,at.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e=Nt){let n=Qr[t.toLowerCase()];return n!==void 0?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Oi(t.r),this.g=Oi(t.g),this.b=Oi(t.b),this}copyLinearToSRGB(t){return this.r=Di(t.r),this.g=Di(t.g),this.b=Di(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Nt){return at.fromWorkingColorSpace(Si(this,it),t),lt(it.r*255,0,255)<<16^lt(it.g*255,0,255)<<8^lt(it.b*255,0,255)<<0}getHexString(t=Nt){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=at.workingColorSpace){at.fromWorkingColorSpace(Si(this,it),e);let n=it.r,r=it.g,s=it.b,o=Math.max(n,r,s),a=Math.min(n,r,s),h,c,l=(a+o)/2;if(a===o)h=0,c=0;else{let d=o-a;switch(c=l<=.5?d/(o+a):d/(2-o-a),o){case n:h=(r-s)/d+(r<s?6:0);break;case r:h=(s-n)/d+2;break;case s:h=(n-r)/d+4;break}h/=6}return t.h=h,t.s=c,t.l=l,t}getRGB(t,e=at.workingColorSpace){return at.fromWorkingColorSpace(Si(this,it),e),t.r=it.r,t.g=it.g,t.b=it.b,t}getStyle(t=Nt){return at.fromWorkingColorSpace(Si(this,it),t),t!==Nt?`color(${t} ${it.r} ${it.g} ${it.b})`:`rgb(${it.r*255|0},${it.g*255|0},${it.b*255|0})`}offsetHSL(t,e,n){return this.getHSL(Mt),Mt.h+=t,Mt.s+=e,Mt.l+=n,this.setHSL(Mt.h,Mt.s,Mt.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Mt),t.getHSL(Ai);let n=xn(Mt.h,Ai.h,e),r=xn(Mt.s,Ai.s,e),s=xn(Mt.l,Ai.l,e);return this.setHSL(n,r,s),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};bn.NAMES=Qr;var Rt=class i{constructor(){i.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,n,r,s,o,a,h,c,l,d,m,u,p,f,_){let y=this.elements;return y[0]=t,y[4]=e,y[8]=n,y[12]=r,y[1]=s,y[5]=o,y[9]=a,y[13]=h,y[2]=c,y[6]=l,y[10]=d,y[14]=m,y[3]=u,y[7]=p,y[11]=f,y[15]=_,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new i().fromArray(this.elements)}copy(t){let e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){let e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){let e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){let e=this.elements,n=t.elements,r=1/Ce.setFromMatrixColumn(t,0).length(),s=1/Ce.setFromMatrixColumn(t,1).length(),o=1/Ce.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*s,e[5]=n[5]*s,e[6]=n[6]*s,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){let e=this.elements,n=t.x,r=t.y,s=t.z,o=Math.cos(n),a=Math.sin(n),h=Math.cos(r),c=Math.sin(r),l=Math.cos(s),d=Math.sin(s);if(t.order==="XYZ"){let m=o*l,u=o*d,p=a*l,f=a*d;e[0]=h*l,e[4]=-h*d,e[8]=c,e[1]=u+p*c,e[5]=m-f*c,e[9]=-a*h,e[2]=f-m*c,e[6]=p+u*c,e[10]=o*h}else if(t.order==="YXZ"){let m=h*l,u=h*d,p=c*l,f=c*d;e[0]=m+f*a,e[4]=p*a-u,e[8]=o*c,e[1]=o*d,e[5]=o*l,e[9]=-a,e[2]=u*a-p,e[6]=f+m*a,e[10]=o*h}else if(t.order==="ZXY"){let m=h*l,u=h*d,p=c*l,f=c*d;e[0]=m-f*a,e[4]=-o*d,e[8]=p+u*a,e[1]=u+p*a,e[5]=o*l,e[9]=f-m*a,e[2]=-o*c,e[6]=a,e[10]=o*h}else if(t.order==="ZYX"){let m=o*l,u=o*d,p=a*l,f=a*d;e[0]=h*l,e[4]=p*c-u,e[8]=m*c+f,e[1]=h*d,e[5]=f*c+m,e[9]=u*c-p,e[2]=-c,e[6]=a*h,e[10]=o*h}else if(t.order==="YZX"){let m=o*h,u=o*c,p=a*h,f=a*c;e[0]=h*l,e[4]=f-m*d,e[8]=p*d+u,e[1]=d,e[5]=o*l,e[9]=-a*l,e[2]=-c*l,e[6]=u*d+p,e[10]=m-f*d}else if(t.order==="XZY"){let m=o*h,u=o*c,p=a*h,f=a*c;e[0]=h*l,e[4]=-d,e[8]=c*l,e[1]=m*d+f,e[5]=o*l,e[9]=u*d-p,e[2]=p*d-u,e[6]=a*l,e[10]=f*d+m}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ph,t,Oh)}lookAt(t,e,n){let r=this.elements;return ut.subVectors(t,e),ut.lengthSq()===0&&(ut.z=1),ut.normalize(),Zt.crossVectors(n,ut),Zt.lengthSq()===0&&(Math.abs(n.z)===1?ut.x+=1e-4:ut.z+=1e-4,ut.normalize(),Zt.crossVectors(n,ut)),Zt.normalize(),Pi.crossVectors(ut,Zt),r[0]=Zt.x,r[4]=Pi.x,r[8]=ut.x,r[1]=Zt.y,r[5]=Pi.y,r[9]=ut.y,r[2]=Zt.z,r[6]=Pi.z,r[10]=ut.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let n=t.elements,r=e.elements,s=this.elements,o=n[0],a=n[4],h=n[8],c=n[12],l=n[1],d=n[5],m=n[9],u=n[13],p=n[2],f=n[6],_=n[10],y=n[14],M=n[3],v=n[7],x=n[11],E=n[15],w=r[0],C=r[4],S=r[8],P=r[12],R=r[1],F=r[5],O=r[9],V=r[13],A=r[2],z=r[6],N=r[10],Q=r[14],rt=r[3],ht=r[7],_t=r[11],Z=r[15];return s[0]=o*w+a*R+h*A+c*rt,s[4]=o*C+a*F+h*z+c*ht,s[8]=o*S+a*O+h*N+c*_t,s[12]=o*P+a*V+h*Q+c*Z,s[1]=l*w+d*R+m*A+u*rt,s[5]=l*C+d*F+m*z+u*ht,s[9]=l*S+d*O+m*N+u*_t,s[13]=l*P+d*V+m*Q+u*Z,s[2]=p*w+f*R+_*A+y*rt,s[6]=p*C+f*F+_*z+y*ht,s[10]=p*S+f*O+_*N+y*_t,s[14]=p*P+f*V+_*Q+y*Z,s[3]=M*w+v*R+x*A+E*rt,s[7]=M*C+v*F+x*z+E*ht,s[11]=M*S+v*O+x*N+E*_t,s[15]=M*P+v*V+x*Q+E*Z,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){let t=this.elements,e=t[0],n=t[4],r=t[8],s=t[12],o=t[1],a=t[5],h=t[9],c=t[13],l=t[2],d=t[6],m=t[10],u=t[14],p=t[3],f=t[7],_=t[11],y=t[15];return p*(+s*h*d-r*c*d-s*a*m+n*c*m+r*a*u-n*h*u)+f*(+e*h*u-e*c*m+s*o*m-r*o*u+r*c*l-s*h*l)+_*(+e*c*d-e*a*u-s*o*d+n*o*u+s*a*l-n*c*l)+y*(-r*a*l-e*h*d+e*a*m+r*o*d-n*o*m+n*h*l)}transpose(){let t=this.elements,e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){let r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){let t=this.elements,e=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],h=t[6],c=t[7],l=t[8],d=t[9],m=t[10],u=t[11],p=t[12],f=t[13],_=t[14],y=t[15],M=d*_*c-f*m*c+f*h*u-a*_*u-d*h*y+a*m*y,v=p*m*c-l*_*c-p*h*u+o*_*u+l*h*y-o*m*y,x=l*f*c-p*d*c+p*a*u-o*f*u-l*a*y+o*d*y,E=p*d*h-l*f*h-p*a*m+o*f*m+l*a*_-o*d*_,w=e*M+n*v+r*x+s*E;if(w===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let C=1/w;return t[0]=M*C,t[1]=(f*m*s-d*_*s-f*r*u+n*_*u+d*r*y-n*m*y)*C,t[2]=(a*_*s-f*h*s+f*r*c-n*_*c-a*r*y+n*h*y)*C,t[3]=(d*h*s-a*m*s-d*r*c+n*m*c+a*r*u-n*h*u)*C,t[4]=v*C,t[5]=(l*_*s-p*m*s+p*r*u-e*_*u-l*r*y+e*m*y)*C,t[6]=(p*h*s-o*_*s-p*r*c+e*_*c+o*r*y-e*h*y)*C,t[7]=(o*m*s-l*h*s+l*r*c-e*m*c-o*r*u+e*h*u)*C,t[8]=x*C,t[9]=(p*d*s-l*f*s-p*n*u+e*f*u+l*n*y-e*d*y)*C,t[10]=(o*f*s-p*a*s+p*n*c-e*f*c-o*n*y+e*a*y)*C,t[11]=(l*a*s-o*d*s-l*n*c+e*d*c+o*n*u-e*a*u)*C,t[12]=E*C,t[13]=(l*f*r-p*d*r+p*n*m-e*f*m-l*n*_+e*d*_)*C,t[14]=(p*a*r-o*f*r-p*n*h+e*f*h+o*n*_-e*a*_)*C,t[15]=(o*d*r-l*a*r+l*n*h-e*d*h-o*n*m+e*a*m)*C,this}scale(t){let e=this.elements,n=t.x,r=t.y,s=t.z;return e[0]*=n,e[4]*=r,e[8]*=s,e[1]*=n,e[5]*=r,e[9]*=s,e[2]*=n,e[6]*=r,e[10]*=s,e[3]*=n,e[7]*=r,e[11]*=s,this}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){let e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){let n=Math.cos(e),r=Math.sin(e),s=1-n,o=t.x,a=t.y,h=t.z,c=s*o,l=s*a;return this.set(c*o+n,c*a-r*h,c*h+r*a,0,c*a+r*h,l*a+n,l*h-r*o,0,c*h-r*a,l*h+r*o,s*h*h+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,s,o){return this.set(1,n,s,0,t,1,o,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){let r=this.elements,s=e._x,o=e._y,a=e._z,h=e._w,c=s+s,l=o+o,d=a+a,m=s*c,u=s*l,p=s*d,f=o*l,_=o*d,y=a*d,M=h*c,v=h*l,x=h*d,E=n.x,w=n.y,C=n.z;return r[0]=(1-(f+y))*E,r[1]=(u+x)*E,r[2]=(p-v)*E,r[3]=0,r[4]=(u-x)*w,r[5]=(1-(m+y))*w,r[6]=(_+M)*w,r[7]=0,r[8]=(p+v)*C,r[9]=(_-M)*C,r[10]=(1-(m+f))*C,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){let r=this.elements,s=Ce.set(r[0],r[1],r[2]).length(),o=Ce.set(r[4],r[5],r[6]).length(),a=Ce.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),t.x=r[12],t.y=r[13],t.z=r[14],Tt.copy(this);let c=1/s,l=1/o,d=1/a;return Tt.elements[0]*=c,Tt.elements[1]*=c,Tt.elements[2]*=c,Tt.elements[4]*=l,Tt.elements[5]*=l,Tt.elements[6]*=l,Tt.elements[8]*=d,Tt.elements[9]*=d,Tt.elements[10]*=d,e.setFromRotationMatrix(Tt),n.x=s,n.y=o,n.z=a,this}makePerspective(t,e,n,r,s,o){let a=this.elements,h=2*s/(e-t),c=2*s/(n-r),l=(e+t)/(e-t),d=(n+r)/(n-r),m=-(o+s)/(o-s),u=-2*o*s/(o-s);return a[0]=h,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=c,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=m,a[14]=u,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,n,r,s,o){let a=this.elements,h=1/(e-t),c=1/(n-r),l=1/(o-s),d=(e+t)*h,m=(n+r)*c,u=(o+s)*l;return a[0]=2*h,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-m,a[2]=0,a[6]=0,a[10]=-2*l,a[14]=-u,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){let e=this.elements,n=t.elements;for(let r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){let n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}},Ce=new D,Tt=new Rt,Ph=new D(0,0,0),Oh=new D(1,1,1),Zt=new D,Pi=new D,ut=new D,Zr=new Rt,Kr=new bt,zi=class i{constructor(t=0,e=0,n=0,r=i.DefaultOrder){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r=this._order){return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){let r=t.elements,s=r[0],o=r[4],a=r[8],h=r[1],c=r[5],l=r[9],d=r[2],m=r[6],u=r[10];switch(e){case"XYZ":this._y=Math.asin(lt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,u),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(m,c),this._z=0);break;case"YXZ":this._x=Math.asin(-lt(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(a,u),this._z=Math.atan2(h,c)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(lt(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-d,u),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(h,s));break;case"ZYX":this._y=Math.asin(-lt(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(m,u),this._z=Math.atan2(h,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(lt(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(a,u));break;case"XZY":this._z=Math.asin(-lt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(m,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-l,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,n===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Zr.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Zr,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Kr.setFromEuler(this),this.setFromQuaternion(Kr,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}};zi.DefaultOrder="XYZ";zi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var ae=class{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(lt(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}};var Fi=class i{constructor(t=0,e=0,n=0,r=1){i.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let e=this.x,n=this.y,r=this.z,s=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,s,h=t.elements,c=h[0],l=h[4],d=h[8],m=h[1],u=h[5],p=h[9],f=h[2],_=h[6],y=h[10];if(Math.abs(l-m)<.01&&Math.abs(d-f)<.01&&Math.abs(p-_)<.01){if(Math.abs(l+m)<.1&&Math.abs(d+f)<.1&&Math.abs(p+_)<.1&&Math.abs(c+u+y-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;let v=(c+1)/2,x=(u+1)/2,E=(y+1)/2,w=(l+m)/4,C=(d+f)/4,S=(p+_)/4;return v>x&&v>E?v<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(v),r=w/n,s=C/n):x>E?x<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(x),n=w/r,s=S/r):E<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(E),n=C/s,r=S/s),this.set(n,r,s,e),this}let M=Math.sqrt((_-p)*(_-p)+(d-f)*(d-f)+(m-l)*(m-l));return Math.abs(M)<.001&&(M=1),this.x=(_-p)/M,this.y=(d-f)/M,this.z=(m-l)/M,this.w=Math.acos((c+u+y-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};var X={LEFT:1,RIGHT:2,MIDDLE:4},g=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),Me={NONE:0,IN:1,OUT:-1},Te=Math.PI*2,$r=Math.PI/2,as=1e-5,Re=Math.PI/180;function St(i,t,e){return Math.max(t,Math.min(e,i))}function j(i,t=as){return Math.abs(i)<t}function G(i,t,e=as){return j(i-t,e)}function Jr(i,t){return Math.round(i/t)*t}function Ke(i){return isFinite(i)?i:i<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Qe(i){return Math.abs(i)<Number.MAX_VALUE?i:i*(1/0)}function zh(i,t){return i.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}function Li(i,t,e,n,r=1/0,s){n=Math.max(1e-4,n);let o=2/n,a=o*s,h=1/(1+a+.48*a*a+.235*a*a*a),c=i-t,l=t,d=r*n;c=St(c,-d,d),t=i-c;let m=(e.value+o*c)*s;e.value=(e.value-o*m)*h;let u=t+(c+m)*h;return l-i>0==u>l&&(u=l,e.value=(u-l)/s),u}function ts(i,t,e,n,r=1/0,s,o){n=Math.max(1e-4,n);let a=2/n,h=a*s,c=1/(1+h+.48*h*h+.235*h*h*h),l=t.x,d=t.y,m=t.z,u=i.x-l,p=i.y-d,f=i.z-m,_=l,y=d,M=m,v=r*n,x=v*v,E=u*u+p*p+f*f;if(E>x){let z=Math.sqrt(E);u=u/z*v,p=p/z*v,f=f/z*v}l=i.x-u,d=i.y-p,m=i.z-f;let w=(e.x+a*u)*s,C=(e.y+a*p)*s,S=(e.z+a*f)*s;e.x=(e.x-a*w)*c,e.y=(e.y-a*C)*c,e.z=(e.z-a*S)*c,o.x=l+(u+w)*c,o.y=d+(p+C)*c,o.z=m+(f+S)*c;let P=_-i.x,R=y-i.y,F=M-i.z,O=o.x-_,V=o.y-y,A=o.z-M;return P*O+R*V+F*A>0&&(o.x=_,o.y=y,o.z=M,e.x=(o.x-_)/s,e.y=(o.y-y)/s,e.z=(o.z-M)/s),o}function Rn(i,t){t.set(0,0),i.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=i.length,t.y/=i.length}var es=new Rt,is=new D,Ii=class{position;quaternion;up;scale=new D(1,1,1);matrix=new Rt;matrixWorld=new Rt;matrixWorldInverse=new Rt;projectionMatrix=new Rt;projectionMatrixInverse=new Rt;zoom=1;matrixWorldNeedsUpdate=!0;matrixAutoUpdate=!0;matrixWorldAutoUpdate=!0;constructor(t){this.position=new D().fromArray(t.position),this.quaternion=new bt().fromArray(t.orientation),this.up=new D(0,1,0)}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t=!1){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1),this.matrixWorldInverse.copy(this.matrixWorld).invert()}lookAt(t){this.updateMatrixWorld(),is.setFromMatrixPosition(this.matrixWorld),es.lookAt(is,t,this.up),this.quaternion.setFromRotationMatrix(es)}},Ni=class extends Ii{lens;constructor(t,e,n){super(t),this.lens=e,this.updateProjectionMatrix(n)}updateProjectionMatrix(t){let e=this.lens.nearPlane,n=e*Math.tan(Re*.5*this.lens.fovy)/this.zoom,r=2*n,s=t*r,o=-.5*s;this.projectionMatrix.makePerspective(o,o+s,n,n-r,e,this.lens.farPlane),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},Bi=class extends Ii{lens;left=0;right=0;top=0;bottom=0;constructor(t,e,n){super(t),this.lens=e,this.updateProjectionMatrix(n)}updateProjectionMatrix(t){this.left=-t*this.lens.zoomFactor[0],this.right=t*this.lens.zoomFactor[0],this.top=this.lens.zoomFactor[1],this.bottom=-this.lens.zoomFactor[1];let e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,s=(this.top+this.bottom)/2,o=r-e,a=r+e,h=s+n,c=s-n;this.projectionMatrix.makeOrthographic(o,a,h,c,this.lens.zNear,this.lens.zFar),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}};function he(i){return i instanceof Ni}function Yt(i){return i instanceof Bi}function ns(i,t){return Yt(i)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}var Fh=class{_listeners={};addEventListener(t,e){let n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){let n=this._listeners;return n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){let r=this._listeners[t];if(r!==void 0){let s=r.indexOf(e);s!==-1&&r.splice(s,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){let n=this._listeners[t.type];if(n!==void 0){t.target=this;let r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,t)}}},Lh="0.4.10",Vi=1/8,Vh=/Mac/.test(globalThis?.navigator?.platform),An=Object.freeze(new D(0,1,0)),rs=Object.freeze(new D(0,0,1)),pt=new Kt,B=new D,Y=new D,Ui=new D,Sn=new D,Bt=new D,Ht=new D,be=new D,Uh=new D,kh=new D,At=new ae,ki=new ae,Ih=new Ze,Nh=new bt,ss=new bt,Hi=class i extends Fh{static get ACTION(){return g}minPolarAngle=0;maxPolarAngle=Math.PI;minAzimuthAngle=-1/0;maxAzimuthAngle=1/0;minDistance=Number.EPSILON;maxDistance=1/0;infinityDolly=!1;minZoom=.01;maxZoom=1/0;smoothTime=.25;draggingSmoothTime=.125;maxSpeed=1/0;azimuthRotateSpeed=1;polarRotateSpeed=1;dollySpeed=1;dollyDragInverted=!1;truckSpeed=2;scaleTruckSpeed=!0;dollyToCursor=!1;dragToOffset=!1;boundaryFriction=0;restThreshold=.01;mouseButtons;touches;cancel=()=>{};lockPointer;unlockPointer;_enabled=!0;_camera;_yAxisUpSpace;_yAxisUpSpaceInverse;_state=g.NONE;_aspectRatio;_domElement;_viewport=null;_target;_targetEnd;_focalOffset;_focalOffsetEnd;_spherical;_sphericalEnd;_lastDistance;_zoom;_zoomEnd;_lastZoom;_cameraUp0;_target0;_position0;_zoom0;_focalOffset0;_dollyControlCoord;_changedDolly=0;_changedZoom=0;_nearPlaneCorners;_hasRested=!0;_boundary;_boundaryEnclosesCamera=!1;_needsUpdate=!0;_updatedLastTime=!1;_elementRect=new DOMRect;_isDragging=!1;_dragNeedsUpdate=!0;_activePointers=[];_lockedPointer=null;_interactiveArea=new DOMRect(0,0,1,1);_isUserControllingRotate=!1;_isUserControllingDolly=!1;_isUserControllingTruck=!1;_isUserControllingOffset=!1;_isUserControllingZoom=!1;_lastDollyDirection=Me.NONE;_thetaVelocity={value:0};_phiVelocity={value:0};_radiusVelocity={value:0};_targetVelocity=new D;_focalOffsetVelocity=new D;_zoomVelocity={value:0};_livelink_viewport;constructor(t,e,n){super();let r="fovy"in e;this._aspectRatio=n.aspect_ratio,this._livelink_viewport=n,this._camera=r?new Ni(t,e,this._aspectRatio):new Bi(t,e,this._aspectRatio),this._yAxisUpSpace=new bt().setFromUnitVectors(this._camera.up,An),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=g.NONE,this._target=new D,this._targetEnd=this._target.clone(),this._focalOffset=new D,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new ae().setFromVector3(B.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new D,new D,new D,new D],this._updateNearPlaneCorners(),this._boundary=new Ze(new D(-1/0,-1/0,-1/0),new D(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Kt,this.mouseButtons={left:g.ROTATE,middle:g.DOLLY,right:g.TRUCK,wheel:he(this._camera)?g.DOLLY:Yt(this._camera)?g.ZOOM:g.NONE},this.touches={one:g.TOUCH_ROTATE,two:he(this._camera)?g.TOUCH_DOLLY_TRUCK:Yt(this._camera)?g.TOUCH_ZOOM_TRUCK:g.NONE,three:g.TOUCH_TRUCK};let s=new Kt,o=new Kt,a=new Kt,h=v=>{if(!this._enabled||!this._domElement||v.target!==this._domElement&&this._livelink_viewport.overlay_dom_elements.every(w=>!w.contains(v.target)))return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){let w=this._domElement.getBoundingClientRect(),C=v.clientX/w.width,S=v.clientY/w.height;if(C<this._interactiveArea.left||C>this._interactiveArea.right||S<this._interactiveArea.top||S>this._interactiveArea.bottom)return}let x=v.pointerType!=="mouse"?null:(v.buttons&X.LEFT)===X.LEFT?X.LEFT:(v.buttons&X.MIDDLE)===X.MIDDLE?X.MIDDLE:(v.buttons&X.RIGHT)===X.RIGHT?X.RIGHT:null;if(x!==null){let w=this._findPointerByMouseButton(x);w&&this._disposePointer(w)}if((v.buttons&X.LEFT)===X.LEFT&&this._lockedPointer)return;let E={pointerId:v.pointerId,clientX:v.clientX,clientY:v.clientY,deltaX:0,deltaY:0,mouseButton:x};this._activePointers.push(E),v.stopPropagation(),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,p(v)},c=v=>{v.cancelable&&v.preventDefault();let x=v.pointerId,E=this._lockedPointer||this._findPointerById(x);if(E){if(E.clientX=v.clientX,E.clientY=v.clientY,E.deltaX=v.movementX,E.deltaY=v.movementY,this._state=0,v.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(v.buttons&X.LEFT)===X.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(v.buttons&X.MIDDLE)===X.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(v.buttons&X.RIGHT)===X.RIGHT&&(this._state=this._state|this.mouseButtons.right);f()}},l=v=>{let x=this._findPointerById(v.pointerId);if(!(x&&x===this._lockedPointer)){if(x&&this._disposePointer(x),v.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=g.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=g.NONE;_()}},d=-1,m=v=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===g.NONE||v.target!==this._domElement&&this._livelink_viewport.overlay_dom_elements.every(S=>!S.contains(v.target)))return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){let S=this._domElement.getBoundingClientRect(),P=v.clientX/S.width,R=v.clientY/S.height;if(P<this._interactiveArea.left||P>this._interactiveArea.right||R<this._interactiveArea.top||R>this._interactiveArea.bottom)return}if(v.preventDefault(),v.stopPropagation(),this.dollyToCursor||this.mouseButtons.wheel===g.ROTATE||this.mouseButtons.wheel===g.TRUCK){let S=performance.now();d-S<1e3&&this._getClientRect(this._elementRect),d=S}let x=Vh?-1:-3,E=v.deltaMode===1?v.deltaY/x:v.deltaY/(x*10),w=this.dollyToCursor?(v.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,C=this.dollyToCursor?(v.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case g.ROTATE:{this._rotateInternal(v.deltaX,v.deltaY),this._isUserControllingRotate=!0;break}case g.TRUCK:{this._truckInternal(v.deltaX,-v.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case g.SCREEN_PAN:{this._truckInternal(v.deltaX,-v.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case g.OFFSET:{this._truckInternal(v.deltaX,v.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case g.DOLLY:{this._dollyInternal(-E,w,C),this._isUserControllingDolly=!0;break}case g.ZOOM:{this._zoomInternal(-E,w,C),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},u=v=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===i.ACTION.NONE){let x=v instanceof PointerEvent?v.pointerId:0,E=this._findPointerById(x);E&&this._disposePointer(E),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}v.preventDefault(),v.stopPropagation()}},p=v=>{if(!this._enabled)return;if(Rn(this._activePointers,pt),this._getClientRect(this._elementRect),s.copy(pt),o.copy(pt),this._activePointers.length>=2){let E=pt.x-this._activePointers[1].clientX,w=pt.y-this._activePointers[1].clientY,C=Math.sqrt(E*E+w*w);a.set(0,C);let S=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,P=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;o.set(S,P)}if(this._state=0,!v)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in v&&v.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(v.buttons&X.LEFT)===X.LEFT&&(this._state=this._state|this.mouseButtons.left),(v.buttons&X.MIDDLE)===X.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(v.buttons&X.RIGHT)===X.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&g.ROTATE)===g.ROTATE||(this._state&g.TOUCH_ROTATE)===g.TOUCH_ROTATE||(this._state&g.TOUCH_DOLLY_ROTATE)===g.TOUCH_DOLLY_ROTATE||(this._state&g.TOUCH_ZOOM_ROTATE)===g.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&g.TRUCK)===g.TRUCK||(this._state&g.SCREEN_PAN)===g.SCREEN_PAN||(this._state&g.TOUCH_TRUCK)===g.TOUCH_TRUCK||(this._state&g.TOUCH_SCREEN_PAN)===g.TOUCH_SCREEN_PAN||(this._state&g.TOUCH_DOLLY_TRUCK)===g.TOUCH_DOLLY_TRUCK||(this._state&g.TOUCH_DOLLY_SCREEN_PAN)===g.TOUCH_DOLLY_SCREEN_PAN||(this._state&g.TOUCH_ZOOM_TRUCK)===g.TOUCH_ZOOM_TRUCK||(this._state&g.TOUCH_ZOOM_SCREEN_PAN)===g.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&g.DOLLY)===g.DOLLY||(this._state&g.TOUCH_DOLLY)===g.TOUCH_DOLLY||(this._state&g.TOUCH_DOLLY_TRUCK)===g.TOUCH_DOLLY_TRUCK||(this._state&g.TOUCH_DOLLY_SCREEN_PAN)===g.TOUCH_DOLLY_SCREEN_PAN||(this._state&g.TOUCH_DOLLY_OFFSET)===g.TOUCH_DOLLY_OFFSET||(this._state&g.TOUCH_DOLLY_ROTATE)===g.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&g.ZOOM)===g.ZOOM||(this._state&g.TOUCH_ZOOM)===g.TOUCH_ZOOM||(this._state&g.TOUCH_ZOOM_TRUCK)===g.TOUCH_ZOOM_TRUCK||(this._state&g.TOUCH_ZOOM_SCREEN_PAN)===g.TOUCH_ZOOM_SCREEN_PAN||(this._state&g.TOUCH_ZOOM_OFFSET)===g.TOUCH_ZOOM_OFFSET||(this._state&g.TOUCH_ZOOM_ROTATE)===g.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&g.OFFSET)===g.OFFSET||(this._state&g.TOUCH_OFFSET)===g.TOUCH_OFFSET||(this._state&g.TOUCH_DOLLY_OFFSET)===g.TOUCH_DOLLY_OFFSET||(this._state&g.TOUCH_ZOOM_OFFSET)===g.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},f=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Rn(this._activePointers,pt);let x=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,E=x?-x.deltaX:o.x-pt.x,w=x?-x.deltaY:o.y-pt.y;if(o.copy(pt),((this._state&g.ROTATE)===g.ROTATE||(this._state&g.TOUCH_ROTATE)===g.TOUCH_ROTATE||(this._state&g.TOUCH_DOLLY_ROTATE)===g.TOUCH_DOLLY_ROTATE||(this._state&g.TOUCH_ZOOM_ROTATE)===g.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(E,w),this._isUserControllingRotate=!0),(this._state&g.DOLLY)===g.DOLLY||(this._state&g.ZOOM)===g.ZOOM){let C=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,S=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,P=this.dollyDragInverted?-1:1;(this._state&g.DOLLY)===g.DOLLY?(this._dollyInternal(P*w*Vi,C,S),this._isUserControllingDolly=!0):(this._zoomInternal(P*w*Vi,C,S),this._isUserControllingZoom=!0)}if((this._state&g.TOUCH_DOLLY)===g.TOUCH_DOLLY||(this._state&g.TOUCH_ZOOM)===g.TOUCH_ZOOM||(this._state&g.TOUCH_DOLLY_TRUCK)===g.TOUCH_DOLLY_TRUCK||(this._state&g.TOUCH_ZOOM_TRUCK)===g.TOUCH_ZOOM_TRUCK||(this._state&g.TOUCH_DOLLY_SCREEN_PAN)===g.TOUCH_DOLLY_SCREEN_PAN||(this._state&g.TOUCH_ZOOM_SCREEN_PAN)===g.TOUCH_ZOOM_SCREEN_PAN||(this._state&g.TOUCH_DOLLY_OFFSET)===g.TOUCH_DOLLY_OFFSET||(this._state&g.TOUCH_ZOOM_OFFSET)===g.TOUCH_ZOOM_OFFSET||(this._state&g.TOUCH_DOLLY_ROTATE)===g.TOUCH_DOLLY_ROTATE||(this._state&g.TOUCH_ZOOM_ROTATE)===g.TOUCH_ZOOM_ROTATE){let C=pt.x-this._activePointers[1].clientX,S=pt.y-this._activePointers[1].clientY,P=Math.sqrt(C*C+S*S),R=a.y-P;a.set(0,P);let F=this.dollyToCursor?(o.x-this._elementRect.x)/this._elementRect.width*2-1:0,O=this.dollyToCursor?(o.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&g.TOUCH_DOLLY)===g.TOUCH_DOLLY||(this._state&g.TOUCH_DOLLY_ROTATE)===g.TOUCH_DOLLY_ROTATE||(this._state&g.TOUCH_DOLLY_TRUCK)===g.TOUCH_DOLLY_TRUCK||(this._state&g.TOUCH_DOLLY_SCREEN_PAN)===g.TOUCH_DOLLY_SCREEN_PAN||(this._state&g.TOUCH_DOLLY_OFFSET)===g.TOUCH_DOLLY_OFFSET?(this._dollyInternal(R*Vi,F,O),this._isUserControllingDolly=!0):(this._zoomInternal(R*Vi,F,O),this._isUserControllingZoom=!0)}((this._state&g.TRUCK)===g.TRUCK||(this._state&g.TOUCH_TRUCK)===g.TOUCH_TRUCK||(this._state&g.TOUCH_DOLLY_TRUCK)===g.TOUCH_DOLLY_TRUCK||(this._state&g.TOUCH_ZOOM_TRUCK)===g.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(E,w,!1,!1),this._isUserControllingTruck=!0),((this._state&g.SCREEN_PAN)===g.SCREEN_PAN||(this._state&g.TOUCH_SCREEN_PAN)===g.TOUCH_SCREEN_PAN||(this._state&g.TOUCH_DOLLY_SCREEN_PAN)===g.TOUCH_DOLLY_SCREEN_PAN||(this._state&g.TOUCH_ZOOM_SCREEN_PAN)===g.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(E,w,!1,!0),this._isUserControllingTruck=!0),((this._state&g.OFFSET)===g.OFFSET||(this._state&g.TOUCH_OFFSET)===g.TOUCH_OFFSET||(this._state&g.TOUCH_DOLLY_OFFSET)===g.TOUCH_DOLLY_OFFSET||(this._state&g.TOUCH_ZOOM_OFFSET)===g.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(E,w,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},_=()=>{Rn(this._activePointers,pt),o.copy(pt),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",y),this._domElement.ownerDocument.addEventListener("pointerlockerror",M),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),p())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),this._domElement?.ownerDocument.exitPointerLock(),this._domElement?.ownerDocument.removeEventListener("pointerlockchange",y),this._domElement?.ownerDocument.removeEventListener("pointerlockerror",M),this.cancel()};let y=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},M=()=>{this.unlockPointer()};this._addAllEventListeners=v=>{this._domElement=v,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",h),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",m,{passive:!1}),this._domElement.addEventListener("contextmenu",u)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",h),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",m,{passive:!1}),this._domElement.removeEventListener("contextmenu",u),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",y),this._domElement.ownerDocument.removeEventListener("pointerlockerror",M))},this.cancel=()=>{this._state!==g.NONE&&(this._state=g.NONE,this._activePointers.length=0,_())},this.connect(n.dom_element),this.update(0)}get position(){return this._camera.position}get orientation(){return this._camera.quaternion}get direction(){return this._getCameraDirection(new D).normalize()}updateTransform(t,e){this._camera.position.fromArray(t),this._camera.quaternion.fromArray(e),this.applyCameraUp(),this._needsUpdate=!0}set aspectRatio(t){this._aspectRatio=t,this._camera.updateProjectionMatrix(this._aspectRatio),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=St(t.width,0,1),this._interactiveArea.height=St(t.height,0,1),this._interactiveArea.x=St(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=St(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,n=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,n)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,n=!1){this._isUserControllingRotate=!1;let r=St(t,this.minAzimuthAngle,this.maxAzimuthAngle),s=St(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=s,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);let o=!n||G(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&G(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Me.NONE,this._changedDolly=0,this._dollyToNoClamp(St(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){this._sphericalEnd.radius=t,this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);let n=!e||G(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(n)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(Sn).multiplyScalar(t)),e||this._target.copy(this._targetEnd);let n=!e||G(this._target.x,this._targetEnd.x,this.restThreshold)&&G(this._target.y,this._targetEnd.y,this.restThreshold)&&G(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=St(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);let n=!e||G(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(t,e,n=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,n)}truck(t,e,n=!1){this._camera.updateMatrix(),Bt.setFromMatrixColumn(this._camera.matrix,0),Ht.setFromMatrixColumn(this._camera.matrix,1),Bt.multiplyScalar(t),Ht.multiplyScalar(-e);let r=B.copy(Bt).add(Ht),s=Y.copy(this._targetEnd).add(r);return this.moveTo(s.x,s.y,s.z,n)}forward(t,e=!1){B.setFromMatrixColumn(this._camera.matrix,0),B.crossVectors(this._camera.up,B),B.multiplyScalar(t);let n=Y.copy(this._targetEnd).add(B);return this.moveTo(n.x,n.y,n.z,e)}elevate(t,e=!1){return B.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+B.x,this._targetEnd.y+B.y,this._targetEnd.z+B.z,e)}moveTo(t,e,n,r=!1){this._isUserControllingTruck=!1;let s=B.set(t,e,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,s,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);let o=!r||G(this._target.x,this._targetEnd.x,this.restThreshold)&&G(this._target.y,this._targetEnd.y,this.restThreshold)&&G(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(t,e,n,r=!1){let a=B.set(t,e,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(a.x,a.y,a.z,r)}fitToBox(t,e,{cover:n=!1,paddingLeft:r=0,paddingRight:s=0,paddingBottom:o=0,paddingTop:a=0}={}){let h=[];t.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());let c=Jr(this._sphericalEnd.theta,$r),l=Jr(this._sphericalEnd.phi,$r);h.push(this.rotateTo(c,l,e));let d=B.setFromSpherical(this._sphericalEnd).normalize(),m=Nh.setFromUnitVectors(d,rs),u=G(Math.abs(d.y),1);u&&m.multiply(ss.setFromAxisAngle(An,c)),m.multiply(this._yAxisUpSpaceInverse);let p=Ih.makeEmpty();Y.copy(t.min).applyQuaternion(m),p.expandByPoint(Y),Y.copy(t.min).setX(t.max.x).applyQuaternion(m),p.expandByPoint(Y),Y.copy(t.min).setY(t.max.y).applyQuaternion(m),p.expandByPoint(Y),Y.copy(t.max).setZ(t.min.z).applyQuaternion(m),p.expandByPoint(Y),Y.copy(t.min).setZ(t.max.z).applyQuaternion(m),p.expandByPoint(Y),Y.copy(t.max).setY(t.min.y).applyQuaternion(m),p.expandByPoint(Y),Y.copy(t.max).setX(t.min.x).applyQuaternion(m),p.expandByPoint(Y),Y.copy(t.max).applyQuaternion(m),p.expandByPoint(Y),p.min.x-=r,p.min.y-=o,p.max.x+=s,p.max.y+=a,m.setFromUnitVectors(rs,d),u&&m.premultiply(ss.invert()),m.premultiply(this._yAxisUpSpace);let f=p.getSize(B),_=p.getCenter(Y).applyQuaternion(m);if(he(this._camera)){let y=this.getDistanceToFitBox(f.x,f.y,f.z,n);h.push(this.moveTo(_.x,_.y,_.z,e)),h.push(this.dollyTo(y,e)),h.push(this.setFocalOffset(0,0,0,e))}else if(Yt(this._camera)){let y=this._camera,M=y.right-y.left,v=y.top-y.bottom,x=n?Math.max(M/f.x,v/f.y):Math.min(M/f.x,v/f.y);h.push(this.moveTo(_.x,_.y,_.z,e)),h.push(this.zoomTo(x,e)),h.push(this.setFocalOffset(0,0,0,e))}return Promise.all(h)}fitToSphere(t,e){let n=[];if(n.push(this.moveTo(t.center.x,t.center.y,t.center.z,e)),he(this._camera)){let r=this.getDistanceToFitSphere(t.radius);n.push(this.dollyTo(r,e))}else if(Yt(this._camera)){let r=this._camera.right-this._camera.left,s=this._camera.top-this._camera.bottom,o=2*t.radius,a=Math.min(r/o,s/o);n.push(this.zoomTo(a,e))}return n.push(this.setFocalOffset(0,0,0,e)),Promise.all(n)}setLookAt(t,e,n,r,s,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Me.NONE,this._changedDolly=0;let h=Y.set(r,s,o),c=B.set(t,e,n);this._targetEnd.copy(h),this._sphericalEnd.setFromVector3(c.sub(h).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let l=!a||G(this._target.x,this._targetEnd.x,this.restThreshold)&&G(this._target.y,this._targetEnd.y,this.restThreshold)&&G(this._target.z,this._targetEnd.z,this.restThreshold)&&G(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&G(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&G(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(l)}lerpLookAt(t,e,n,r,s,o,a,h,c,l,d,m,u,p=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Me.NONE,this._changedDolly=0;let f=B.set(r,s,o),_=Y.set(t,e,n);At.setFromVector3(_.sub(f).applyQuaternion(this._yAxisUpSpace));let y=Ui.set(l,d,m),M=Y.set(a,h,c);ki.setFromVector3(M.sub(y).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(f.lerp(y,u));let v=ki.theta-At.theta,x=ki.phi-At.phi,E=ki.radius-At.radius;this._sphericalEnd.set(At.radius+E*u,At.phi+x*u,At.theta+v*u),this.normalizeRotations(),this._needsUpdate=!0,p||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let w=!p||G(this._target.x,this._targetEnd.x,this.restThreshold)&&G(this._target.y,this._targetEnd.y,this.restThreshold)&&G(this._target.z,this._targetEnd.z,this.restThreshold)&&G(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&G(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&G(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(w)}setPosition(t,e,n,r=!1){return this.setLookAt(t,e,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(t,e,n,r=!1){let s=this.getPosition(B),o=this.setLookAt(s.x,s.y,s.z,t,e,n,r);return this._sphericalEnd.phi=St(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(t,e,n,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,n),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);let s=!r||G(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&G(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&G(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}setOrbitPoint(t,e,n){this._camera.updateMatrixWorld(),Bt.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Ht.setFromMatrixColumn(this._camera.matrixWorldInverse,1),be.setFromMatrixColumn(this._camera.matrixWorldInverse,2);let r=B.set(t,e,n),s=r.distanceTo(this._camera.position),o=r.sub(this._camera.position);Bt.multiplyScalar(o.x),Ht.multiplyScalar(o.y),be.multiplyScalar(o.z),B.copy(Bt).add(Ht).add(be),B.z=B.z+s,this.dollyTo(s,!1),this.setFocalOffset(-B.x,B.y,-B.z,!1),this.moveTo(t,e,n,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,n,r){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new Fi,typeof t=="number"?this._viewport.set(t,e,n,r):this._viewport.copy(t)}getDistanceToFitBox(t,e,n,r=!1){if(ns(this._camera,"getDistanceToFitBox"))return this._spherical.radius;let s=t/e,o=this._camera.lens.fovy*Re,a=this._aspectRatio;return((r?s>a:s<a)?e:t/a)*.5/Math.tan(o*.5)+n*.5}getDistanceToFitSphere(t){if(ns(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;let e=this._camera.lens.fovy*Re,n=Math.atan(Math.tan(e*.5)*this._aspectRatio)*2,r=1<this._aspectRatio?e:n;return t/Math.sin(r*.5)}getTarget(t,e=!0){return(t&&t.isVector3?t:new D).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new D).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t||new ae).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new D).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Te,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Te),this._spherical.theta+=Te*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Te)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(t=!1){if(!G(this._camera.up.x,this._cameraUp0.x)||!G(this._camera.up.y,this._cameraUp0.y)||!G(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);let n=this.getPosition(B);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}let e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,An),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){let t=B.subVectors(this._target,this._camera.position).normalize(),e=Y.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();let n=this.getPosition(B);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(t){let e=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,s=Uh.subVectors(this._targetEnd,this._target),o=kh.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(j(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{let l=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Li(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,l,1/0,t),this._needsUpdate=!0}if(j(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{let l=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Li(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,l,1/0,t),this._needsUpdate=!0}if(j(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{let l=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Li(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,l,this.maxSpeed,t),this._needsUpdate=!0}if(j(s.x)&&j(s.y)&&j(s.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{let l=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;ts(this._target,this._targetEnd,this._targetVelocity,l,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(j(o.x)&&j(o.y)&&j(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{let l=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;ts(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,l,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(j(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{let l=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Li(this._zoom,this._zoomEnd,this._zoomVelocity,l,1/0,t)}if(this.dollyToCursor){if(he(this._camera)&&this._changedDolly!==0){let l=this._spherical.radius-this._lastDistance,d=this._camera,m=this._getCameraDirection(Sn),u=B.copy(m).cross(d.up).normalize();u.lengthSq()===0&&(u.x=1);let p=Y.crossVectors(u,m),f=this._sphericalEnd.radius*Math.tan(d.lens.fovy*Re*.5),y=(this._sphericalEnd.radius-l-this._sphericalEnd.radius)/this._sphericalEnd.radius,M=Ui.copy(this._targetEnd).add(u.multiplyScalar(this._dollyControlCoord.x*f*this._aspectRatio)).add(p.multiplyScalar(this._dollyControlCoord.y*f)),v=B.copy(this._targetEnd).lerp(M,y),x=this._lastDollyDirection===Me.IN&&this._spherical.radius<=this.minDistance,E=this._lastDollyDirection===Me.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(x||E)){this._sphericalEnd.radius-=l,this._spherical.radius-=l;let C=Y.copy(m).multiplyScalar(-l);v.add(C)}this._boundary.clampPoint(v,v);let w=Y.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(w),this._changedDolly-=l,j(this._changedDolly)&&(this._changedDolly=0)}else if(Yt(this._camera)&&this._changedZoom!==0){let l=this._zoom-this._lastZoom,d=this._camera,m=zh(B.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(d.lens.zNear+d.lens.zFar)/(d.lens.zNear-d.lens.zFar)),d),u=Y.set(0,0,-1).applyQuaternion(d.quaternion),p=Ui.copy(m).add(u.multiplyScalar(-m.dot(d.up))),_=-(this._zoom-l-this._zoom)/this._zoom,y=this._getCameraDirection(Sn),M=this._targetEnd.dot(y),v=B.copy(this._targetEnd).lerp(p,_),x=v.dot(y),E=y.multiplyScalar(x-M);v.sub(E),this._boundary.clampPoint(v,v);let w=Y.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(w),this._changedZoom-=l,j(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(this._aspectRatio),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0,this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!j(this._focalOffset.x)||!j(this._focalOffset.y)||!j(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Bt.setFromMatrixColumn(this._camera.matrix,0),Ht.setFromMatrixColumn(this._camera.matrix,1),be.setFromMatrixColumn(this._camera.matrix,2),Bt.multiplyScalar(this._focalOffset.x),Ht.multiplyScalar(-this._focalOffset.y),be.multiplyScalar(this._focalOffset.z),B.copy(Bt).add(Ht).add(be),this._camera.position.add(B)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),B.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);let c=this._needsUpdate;return c&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):c?(this.dispatchEvent({type:"update"}),j(e,this.restThreshold)&&j(n,this.restThreshold)&&j(r,this.restThreshold)&&j(s.x,this.restThreshold)&&j(s.y,this.restThreshold)&&j(s.z,this.restThreshold)&&j(o.x,this.restThreshold)&&j(o.y,this.restThreshold)&&j(o.z,this.restThreshold)&&j(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!c&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=c,this._needsUpdate=!1,c}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Ke(this.maxDistance),minZoom:this.minZoom,maxZoom:Ke(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Ke(this.maxPolarAngle),minAzimuthAngle:Ke(this.minAzimuthAngle),maxAzimuthAngle:Ke(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,scaleTruckSpeed:this.scaleTruckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:B.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){let n=JSON.parse(t);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=Qe(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=Qe(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=Qe(n.maxPolarAngle),this.minAzimuthAngle=Qe(n.minAzimuthAngle),this.maxAzimuthAngle=Qe(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.scaleTruckSpeed=n.scaleTruckSpeed,this.dollyToCursor=n.dollyToCursor,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],e),At.setFromVector3(B.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(At.theta,At.phi,e),this.dollyTo(At.radius,e),this.zoomTo(n.zoom,e),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",Lh),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,n){let r=e.lengthSq();if(r===0)return t;let s=Y.copy(e).add(t),a=this._boundary.clampPoint(s,Ui).sub(s),h=a.lengthSq();if(h===0)return t.add(e);if(h===r)return t;if(n===0)return t.add(e).add(a);{let c=1+n*h/e.dot(a);return t.add(Y.copy(e).multiplyScalar(c)).add(a.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(he(this._camera)){let t=this._camera,e=t.lens.nearPlane,n=t.lens.fovy*Re,r=Math.tan(n*.5)*e,s=r*this._aspectRatio;this._nearPlaneCorners[0].set(-s,-r,0),this._nearPlaneCorners[1].set(s,-r,0),this._nearPlaneCorners[2].set(s,r,0),this._nearPlaneCorners[3].set(-s,r,0)}else if(Yt(this._camera)){let t=this._camera,e=1/t.zoom,n=t.left*e,r=t.right*e,s=t.top*e,o=t.bottom*e;this._nearPlaneCorners[0].set(n,s,0),this._nearPlaneCorners[1].set(r,s,0),this._nearPlaneCorners[2].set(r,o,0),this._nearPlaneCorners[3].set(n,o,0)}}getTargetDistance=()=>{if(!this.scaleTruckSpeed||Yt(this._camera))return 1;let t=B.copy(this._camera.position).sub(this._target),e=this._camera.lens.fovy*Re;return t.length()*Math.tan(e*.5)};_truckInternal=(t,e,n,r)=>{let s,o;if(he(this._camera)){let a=this.getTargetDistance();s=this.truckSpeed*t*a/this._elementRect.height,o=this.truckSpeed*e*a/this._elementRect.height}else if(Yt(this._camera)){let a=this._camera;s=t*(a.right-a.left)/a.zoom/this._elementRect.width,o=e*(a.top-a.bottom)/a.zoom/this._elementRect.height}else return;r?(n?this.setFocalOffset(this._focalOffsetEnd.x+s,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(s,0,!0),this.forward(-o,!0)):n?this.setFocalOffset(this._focalOffsetEnd.x+s,this._focalOffsetEnd.y+o,this._focalOffsetEnd.z,!0):this.truck(s,o,!0)};_rotateInternal=(t,e)=>{let n=Te*this.azimuthRotateSpeed*t/this._elementRect.height,r=Te*this.polarRotateSpeed*e/this._elementRect.height;this.rotate(n,r,!0)};_dollyInternal=(t,e,n)=>{let r=Math.pow(.95,-t*this.dollySpeed),s=this._sphericalEnd.radius,o=this._sphericalEnd.radius*r,a=St(o,this.minDistance,this.maxDistance),h=a-o;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(o,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(h,!0),this._dollyToNoClamp(a,!0)):this._dollyToNoClamp(a,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?o:a)-s,this._dollyControlCoord.set(e,n)),this._lastDollyDirection=Math.sign(-t)};_zoomInternal=(t,e,n)=>{let r=Math.pow(.95,t*this.dollySpeed),s=this._zoom,o=this._zoom*r;this.zoomTo(o,!0),this.dollyToCursor&&(this._changedZoom+=o-s,this._dollyControlCoord.set(e,n))};_getClientRect(t){if(!this._domElement)return;let e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{let n=()=>{this.removeEventListener("rest",n),e()};this.addEventListener("rest",n)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}},$e;(function(i){i.HOLD_START="holdStart",i.HOLD_END="holdEnd",i.HOLDING="holding"})($e||($e={}));var Pn=class{_listeners={};addEventListener(t,e){let n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}removeEventListener(t,e){let r=this._listeners[t];if(r!==void 0){let s=r.indexOf(e);s!==-1&&r.splice(s,1)}}dispatchEvent(t){let n=this._listeners[t.type];if(n!==void 0){t.target=this;let r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,t)}}},On=class extends Pn{holdIntervalDelay;_enabled=!0;_holding=!1;_intervalId=-1;_deltaTime=0;_elapsedTime=0;_lastTime=0;constructor(t){super(),this.holdIntervalDelay=t}get enabled(){return this._enabled}set enabled(t){this._enabled!==t&&(this._enabled=t,this._enabled||this._holdEnd())}get holding(){return this._holding}_holdStart=t=>{if(!this._enabled||this._holding)return;this._deltaTime=0,this._elapsedTime=0,this._lastTime=performance.now(),this.dispatchEvent({type:$e.HOLD_START,deltaTime:this._deltaTime,elapsedTime:this._elapsedTime,originalEvent:t}),this._holding=!0;let e=()=>{this._intervalId=this.holdIntervalDelay?window.setTimeout(e,this.holdIntervalDelay):window.requestAnimationFrame(e);let n=performance.now();this._deltaTime=n-this._lastTime,this._elapsedTime+=this._deltaTime,this._lastTime=performance.now(),this.dispatchEvent({type:$e.HOLDING,deltaTime:this._deltaTime,elapsedTime:this._elapsedTime,originalEvent:t})};this._intervalId=this.holdIntervalDelay?window.setTimeout(e,this.holdIntervalDelay):window.requestAnimationFrame(e)};_holdEnd=t=>{if(this._holding){let e=performance.now();this._deltaTime=e-this._lastTime,this._elapsedTime+=this._deltaTime,this._lastTime=performance.now(),this.dispatchEvent({type:$e.HOLD_END,deltaTime:this._deltaTime,elapsedTime:this._elapsedTime,originalEvent:t}),this._holding=!1}window.clearTimeout(this._intervalId),window.cancelAnimationFrame(this._intervalId)}},dt=class extends On{constructor(t,e){if(typeof t!="string"){console.error("KeyboardKeyHold: the first argument has to be a KeyboardEvent.code string.");return}super(e),this._holdStart=this._holdStart.bind(this),this._holdEnd=this._holdEnd.bind(this);let n=s=>{Bh(s)||s.code===t&&this._holdStart(s)},r=s=>{s.code===t&&this._holdEnd(s)};document.addEventListener("keydown",n),document.addEventListener("keyup",r),window.addEventListener("blur",this._holdEnd)}};function Bh(i){let t=i.target;return t.tagName==="INPUT"||t.tagName==="SELECT"||t.tagName==="TEXTAREA"||t.isContentEditable}var vt={W:"KeyW",A:"KeyA",S:"KeyS",D:"KeyD",E:"KeyE",Q:"KeyQ",ARROW_LEFT:"ArrowLeft",ARROW_UP:"ArrowUp",ARROW_RIGHT:"ArrowRight",ARROW_DOWN:"ArrowDown",SHIFT_RIGHT:"ShiftRight",CONTROL_RIGHT:"ControlRight"},gt=16.666,Yi=class i{static _keys={};_cameraControls;_clock;speedMultiplier=2e-5;constructor(t,e){this._cameraControls=t,this._clock=e,Object.keys(i._keys).length===0&&(i._keys={q:new dt(vt.Q,gt),w:new dt(vt.W,gt),s:new dt(vt.S,gt),a:new dt(vt.A,gt),d:new dt(vt.D,gt),e:new dt(vt.E,gt),up:new dt(vt.ARROW_UP,gt),right:new dt(vt.ARROW_RIGHT,gt),down:new dt(vt.ARROW_DOWN,gt),left:new dt(vt.ARROW_LEFT,gt),shift:new dt(vt.SHIFT_RIGHT,gt),ctrl:new dt(vt.CONTROL_RIGHT,gt)});let{w:n,a:r,s,d:o,e:a,q:h,up:c,right:l,down:d,left:m,shift:u,ctrl:p}=i._keys;r.addEventListener("holding",this._truckLeft),o.addEventListener("holding",this._truckRight),n.addEventListener("holding",this._moveFront),s.addEventListener("holding",this._moveBack),h.addEventListener("holding",this._moveDown),a.addEventListener("holding",this._moveUp),m.addEventListener("holding",this._truckLeft),l.addEventListener("holding",this._truckRight),c.addEventListener("holding",this._moveFront),d.addEventListener("holding",this._moveBack),p.addEventListener("holding",this._moveDown),u.addEventListener("holding",this._moveUp)}dispose(){let{w:t,a:e,s:n,d:r,e:s,q:o,up:a,right:h,down:c,left:l,ctrl:d,shift:m}=i._keys;e.removeEventListener("holding",this._truckLeft),r.removeEventListener("holding",this._truckRight),t.removeEventListener("holding",this._moveFront),n.removeEventListener("holding",this._moveBack),o.removeEventListener("holding",this._moveDown),s.removeEventListener("holding",this._moveUp),l.removeEventListener("holding",this._truckLeft),h.removeEventListener("holding",this._truckRight),a.removeEventListener("holding",this._moveFront),c.removeEventListener("holding",this._moveBack),d.removeEventListener("holding",this._moveDown),m.removeEventListener("holding",this._moveUp)}enable(){Object.keys(i._keys).forEach(t=>{i._keys[t].enabled=!0})}disable(){Object.keys(i._keys).forEach(t=>{i._keys[t].enabled=!1})}_truckLeft=t=>{t&&(this._cameraControls.truck(-this.speedMultiplier*-this._cameraControls.truckSpeed*t.deltaTime,0,!1),this._updateClock())};_truckRight=t=>{t&&(this._cameraControls.truck(this.speedMultiplier*-this._cameraControls.truckSpeed*t.deltaTime,0,!1),this._updateClock())};_moveUp=t=>{t&&(this._cameraControls.elevate(this.speedMultiplier*-this._cameraControls.truckSpeed*t.deltaTime,!1),this._updateClock())};_moveDown=t=>{t&&(this._cameraControls.elevate(-this.speedMultiplier*-this._cameraControls.truckSpeed*t.deltaTime,!1),this._updateClock())};_moveFront=t=>{if(!t)return;let e=this.speedMultiplier*-this._cameraControls.truckSpeed*t.deltaTime,n=this._cameraControls.direction.multiplyScalar(e);n.add(this._cameraControls.getPosition(new D)),this._cameraControls.moveTo(...n.toArray(),!1),this._updateClock()};_moveBack=t=>{if(!t)return;let e=this.speedMultiplier*this._cameraControls.truckSpeed*t.deltaTime,n=this._cameraControls.direction.multiplyScalar(e);n.add(this._cameraControls.getPosition(new D)),this._cameraControls.moveTo(...n.toArray(),!1),this._updateClock()};_updateClock(){let t=this._clock.getDelta();return this._cameraControls.update(t)}},Gi=class{autoStart;startTime;oldTime;elapsedTime;running;constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=os(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let e=os();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}};function os(){return performance.now()}typeof window<"u"&&(window.__LIVELINK__||(window.__LIVELINK__={}),Object.prototype.hasOwnProperty.call(window.__LIVELINK__,"@3dverse/livelink-camera-controls")?console.warn("\u26A0\uFE0F WARNING \u26A0\uFE0F Multiple instances of Livelink Camera Controls being imported."):window.__LIVELINK__["@3dverse/livelink-camera-controls"]="0.4.10");var qi={};ie(qi,{fly:()=>Yh,orbital:()=>Dn,pointer_locked_orbital:()=>Hh});var Dn=Object.freeze({init_options:{target:[0,0,0]}}),Hh=Object.freeze({mouseButtons:{left:g.ROTATE,middle:g.DOLLY,wheel:g.DOLLY,right:g.TRUCK},touches:{one:g.TOUCH_ROTATE,two:g.TOUCH_DOLLY_TRUCK,three:g.TOUCH_TRUCK},truckSpeed:-2,dollyToCursor:!0,infinityDolly:!0,minDistance:.5,maxDistance:1/0,invert_middle_button_dolly:!0,orbit_on_cursor:{enabled:!0,cancel_target_offset:!0},lock_pointer:{aim:"on-drag",on_drag_threshold_in_pixels:10}}),Yh=Object.freeze({mouseButtons:{left:g.SCREEN_PAN,middle:g.TRUCK,wheel:g.SCREEN_PAN,right:g.ROTATE},touches:{one:g.TOUCH_ROTATE,two:g.TOUCH_TRUCK,three:g.TOUCH_SCREEN_PAN},truckSpeed:-3/.001,infinityDolly:!0,minDistance:.5,maxDistance:1/0,lock_pointer:{aim:"on-drag",on_drag_threshold_in_pixels:10},init_options:{forward_target_distance:.001,keyboard_fly_controls:{enabled:!0,speed_multiplier:2e-6}}});var zn=class extends Hi{#t;#i;#e=new Gi;#n=null;invert_middle_button_dolly=!1;orbit_on_cursor={enabled:!1,cancel_target_offset:!1};#r={orbit_point:[0,0,0],wheel_timer:0};lock_pointer={aim:"off",on_drag_threshold_in_pixels:0};#o={count:0,down_position:null};init_options={};keyboard_fly_controls=null;get#s(){return this._domElement?.ownerDocument.pointerLockElement===this._domElement}constructor({camera_entity:t,viewport:e,activate:n=!0,preset:r=Dn}){super(t.local_transform,Gh(t),e),this.#t=t,this.#i=e,this.#i.is_camera_controlled_by_current_client=!0,this.#a(this,r),this.#c(),n&&this.activate(),this.#i.rendering_surface.addEventListener("on-rendering-surface-resized",this.onViewportResize)}onViewportResize=()=>{this.aspectRatio=this.#i.aspect_ratio};release(){this.#i.is_camera_controlled_by_current_client=!1,this.#i.rendering_surface.removeEventListener("on-rendering-surface-resized",this.onViewportResize),this.deactivate(),this.dispose(),this.keyboard_fly_controls?.dispose()}activate(){this.#n||(this.#n=setInterval(()=>{this.update(this.#e.getDelta())},1e3/60),this._domElement?.addEventListener("pointerdown",this.#x),this._domElement?.addEventListener("pointerup",this.#E),this._domElement?.addEventListener("mousedown",this.#p),this.keyboard_fly_controls?.enable())}deactivate(){this._domElement?.removeEventListener("pointerdown",this.#x),this._domElement?.removeEventListener("pointerup",this.#E),this._domElement?.removeEventListener("mousedown",this.#p),this._domElement?.removeEventListener("mouseup",this.#y),this._domElement?.removeEventListener("mousemove",this.#_),this.keyboard_fly_controls?.disable(),this.#n&&(clearInterval(this.#n),this.#n=null)}#a(t,...e){let n=r=>typeof r=="object"&&r!==null&&!Array.isArray(r);return e.forEach(r=>{n(r)&&Reflect.ownKeys(r).forEach(s=>{let o=t[s],a=r[s],h;n(o)&&n(a)?h=this.#a(Object.create(Object.getPrototypeOf(o)),o,a):h=window.structuredClone(a),t[s]=h})}),t}#c(){let{target:t}=this.init_options;t&&this.setLookAt(...this.#t.local_transform.position,...t);let{forward_target_distance:e}=this.init_options;if(e!==void 0){let r=new bt(...this.#t.local_transform.orientation),s=new D(0,0,-1).applyQuaternion(r);s.multiplyScalar(e);let o=this.getPosition(new D).add(s);this.setTarget(...o.toArray())}let{keyboard_fly_controls:n}=this.init_options;if(n?.enabled){let{speed_multiplier:r}=n;this.keyboard_fly_controls=new Yi(this,this.#e),r!==void 0&&(this.keyboard_fly_controls.speedMultiplier=r)}this.saveState(),this.addEventListener("update",this.#h)}#h=()=>{this.position.toArray(this.#t.global_transform.position),this.orientation.toArray(this.#t.global_transform.orientation)};#l(){if(!this._domElement)return;let{ownerDocument:t}=this._domElement;this.#s||(this._domElement.requestPointerLock?.(),t.removeEventListener("pointerlockchange",this.#m),t.removeEventListener("pointerlockerror",this.#u),t.addEventListener("pointerlockchange",this.#m),t.addEventListener("pointerlockerror",this.#u))}#d(){if(!this._domElement)return;let{ownerDocument:t}=this._domElement;t.removeEventListener("pointerlockchange",this.#m),t.removeEventListener("pointerlockerror",this.#u),this.#o.count=0,this.#s&&t.exitPointerLock?.()}#m=()=>{this.#s||this.#d()};#u=()=>{setTimeout(()=>{this.#l()},500)};#p=t=>{this._domElement&&(this.lock_pointer.aim!=="always"&&this.#o.count++,!(this.#s||this.lock_pointer.aim==="off")&&(this.#o.down_position=[t.clientX,t.clientY],this._domElement.addEventListener("mousemove",this.#_),this.lock_pointer.aim!=="always"&&this._domElement.addEventListener("mouseup",this.#y)))};#y=t=>{if(this.#o.count>0&&this.#o.count--,!(this.#o.count>0||!this._domElement)){if(!this.#s){this._domElement.removeEventListener("mousemove",this.#_);return}this.#o.count===0&&this.#d()}};#_=t=>{let{on_drag_threshold_in_pixels:e}=this.lock_pointer,{down_position:n}=this.#o;if(!n||!this._domElement||this.#s){this._domElement?.removeEventListener("mousemove",this.#_);return}if(e>0){let{clientX:r,clientY:s}=t;if(Math.sqrt(Math.pow(r-n[0],2)+Math.pow(s-n[1],2))<e)return}this._domElement.removeEventListener("mousemove",this.#_),this.#d(),this.#l()};#f({event:t,touch_actions:e,mouse_actions:n}){if(e&&e.length>0&&t.pointerType==="touch"){let s=e.reduce((o,a)=>o|a,0);switch(this._activePointers.length){case 1:return(this.touches.one|s)>0;case 2:return(this.touches.two|s)>0;case 3:return(this.touches.three|s)>0;default:return!1}}if(!n||n.length===0)return!1;let r=g.NONE;switch(t.button){case 0:r=this.mouseButtons.left;break;case 2:r=this.mouseButtons.right;break;case 1:r=this.mouseButtons.middle;break;default:return!1}return n.includes(r)}#v(t){let{ROTATE:e,TOUCH_ROTATE:n,TOUCH_ZOOM_ROTATE:r,TOUCH_DOLLY_ROTATE:s}=g;return this.#f({event:t,touch_actions:[n,r,s],mouse_actions:[e]})}#x=t=>{this.invert_middle_button_dolly&&t.button===1&&this.mouseButtons.middle===g.DOLLY&&(this.dollySpeed=-Math.abs(this.dollySpeed)),this.orbit_on_cursor.enabled&&this.#v(t)&&this.#C(t)};#E=t=>{this.invert_middle_button_dolly&&t.button===1&&this.mouseButtons.middle===g.DOLLY&&(this.dollySpeed=Math.abs(this.dollySpeed))};#g=t=>{t.stopPropagation()};async#w(t){if(!this._domElement)return;let{clientX:e,clientY:n}=t,{left:r,top:s}=this._domElement.getBoundingClientRect(),o=[(e-r)/this._domElement.clientWidth,(n-s)/this._domElement.clientHeight],h=(await this.#i.castScreenSpaceRay({screen_position:o,mode:"None"}))?.world_position;h?(this.#r.orbit_point=h,this.setOrbitPoint(...h)):this.orbit_on_cursor.cancel_target_offset&&this.setOrbitPoint(...this.#r.orbit_point),this.update(this.#e.getDelta())}async#C(t){this.#r.rotate_speed||(this.#r.rotate_speed={azimuth:this.azimuthRotateSpeed,polar:this.polarRotateSpeed}),this.polarRotateSpeed=0,this.azimuthRotateSpeed=0,document.removeEventListener("pointermove",this.#g,!0),document.addEventListener("pointermove",this.#g,{capture:!0,once:!0});try{await this.#w(t)}finally{if(document.removeEventListener("pointermove",this.#g,!0),this.#r.rotate_speed){let{azimuth:e,polar:n}=this.#r.rotate_speed;this.#r.rotate_speed=void 0,this.azimuthRotateSpeed=e,this.polarRotateSpeed=n}}}};function Gh(i){let t=i.perspective_lens||i.orthographic_lens;if(!t)throw new Error("Camera entity must have a perspective or orthographic lens");return t}var qh=1e5,Fn=class{camera_entity;viewport;#t=[0,0,0];#i=[0,0,0,1];#e=J.create();#n=J.create();#r=J.create();#o=J.create();get clip_from_view_matrix(){return this.#e}get view_from_clip_matrix(){return this.#n}get clip_from_world_matrix(){return this.#r}get world_from_clip_matrix(){return J.invert(J.create(),this.#r)}get world_from_view_matrix(){return this.#o}get world_position(){return this.#t}get world_orientation(){return this.#i}get world_euler_orientation(){return ne(this.#i)}constructor({camera_entity:t,viewport:e}){this.#a({camera_entity:t}),this.camera_entity=t,this.viewport=e,this.updateProjectionMatrix(),t.addEventListener("on-entity-updated",this.#s)}#s=t=>{t.isAnyComponentDirty({components:["perspective_lens","orthographic_lens"]})&&this.updateProjectionMatrix()};#a({camera_entity:t}){if(!t.camera)throw new Error("Camera entity must have a camera component");if(!t.perspective_lens&&!t.orthographic_lens)throw new Error("Camera entity must have a perspective or orthographic lens component")}projectWorldToClip({world_position:t,out_clip_position:e=L.create()}){return L.transformMat4(e,t,this.#r),e}projectClipToWorld({clip_position:t,out_world_position:e=L.create()}){return L.transformMat4(e,t,this.world_from_clip_matrix),e}computeRayFromScreenPosition({screen_position:t}){let e=this.#l({screen_position:t});return this.computeRayFromClipPosition({clip_position:e})}computeRayFromClipPosition({clip_position:t}){if(this.camera_entity.perspective_lens)return this.#c({clip_position:t});if(this.camera_entity.orthographic_lens)return this.#h({lens:this.camera_entity.orthographic_lens,clip_position:t});throw new Error("Camera entity must have a perspective or orthographic lens component")}#c({clip_position:t}){let e={origin:L.fromValues(...this.#t),direction:L.create()};return this.projectClipToWorld({clip_position:t,out_world_position:e.direction}),L.sub(e.direction,e.direction,e.origin),L.normalize(e.direction,e.direction),e}#h({lens:t,clip_position:e}){let{zNear:n,zFar:r}=t,s={origin:L.fromValues(e[0],e[1],(n+r)/(n-r)),direction:L.fromValues(0,0,-1)};this.projectClipToWorld({clip_position:e,out_world_position:s.origin});let o=fe.fromMat4(fe.create(),this.world_from_view_matrix);return L.transformMat3(s.direction,s.direction,o),s}#l({screen_position:t}){return L.fromValues(t[0]*2-1,1-t[1]*2,.5)}updateProjectionMatrix(){this.camera_entity.perspective_lens?this.#d({lens:this.camera_entity.perspective_lens}):this.camera_entity.orthographic_lens&&this.#m({lens:this.camera_entity.orthographic_lens}),J.invert(this.#n,this.#e)}updateFromFrameCameraTransform({frame_camera_transform:t}){this.#t=t.world_position,this.#i=t.world_orientation,this.#o=Array.from(t.world_from_view_matrix);let e=this.#r,n=J.invert(e,t.world_from_view_matrix);n||(console.warn("Failed to invert world_from_view_matrix from frame_camera_transform, using identity matrix instead",t),n=J.identity(e)),this.#r=J.multiply(this.#r,this.#e,n)}#d({lens:t}){J.perspective(this.#e,Vt.toRadian(t.fovy),this.viewport.aspect_ratio,t.nearPlane,t.farPlane||qh)}#m({lens:t}){J.ortho(this.#e,-this.viewport.aspect_ratio*t.zoomFactor[0],this.viewport.aspect_ratio*t.zoomFactor[0],-t.zoomFactor[1],t.zoomFactor[1],t.zNear,t.zFar)}};var $t;function jh(){$t=this,$t||(typeof window<"u"?$t=window:typeof self<"u"&&($t=self))}jh();var Qt="https://cdn.3dverse.com/legacy/sdk/avc.wasm";var Xh=function(i,t){var e=typeof e<"u"?e:{},n={},r;for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);e.arguments=[],e.thisProgram="./this.program",e.quit=function(T,b){throw b},e.preRun=[],e.postRun=[];var s=!1,o=!1,a=!1,h=!1;if(e.ENVIRONMENT)if(e.ENVIRONMENT==="WEB")s=!0;else if(e.ENVIRONMENT==="WORKER")o=!0;else if(e.ENVIRONMENT==="NODE")a=!0;else if(e.ENVIRONMENT==="SHELL")h=!0;else throw new Error("Module['ENVIRONMENT'] value is not valid. must be one of: WEB|WORKER|NODE|SHELL.");else s=typeof window=="object",o=typeof importScripts=="function",a=typeof process=="object"&&!1,h=!s&&!a&&!o;if(h)typeof read<"u"&&(e.read=function(b){return read(b)}),e.readBinary=function(b){var U;return typeof readbuffer=="function"?new Uint8Array(readbuffer(b)):(U=read(b,"binary"),y(typeof U=="object"),U)},typeof scriptArgs<"u"?e.arguments=scriptArgs:typeof arguments<"u"&&(e.arguments=arguments),typeof quit=="function"&&(e.quit=function(T,b){quit(T)});else if(s||o)e.read=function(b){var U=new XMLHttpRequest;return U.open("GET",b,!1),U.send(null),U.responseText},o&&(e.readBinary=function(b){var U=new XMLHttpRequest;return U.open("GET",b,!1),U.responseType="arraybuffer",U.send(null),new Uint8Array(U.response)}),e.readAsync=function(b,U,I){var H=new XMLHttpRequest;H.open("GET",b,!0),H.responseType="arraybuffer",H.onload=function(){if(H.status==200||H.status==0&&H.response){U(H.response);return}I()},H.onerror=I,H.send(null)},e.setWindowTitle=function(T){document.title=T};else throw new Error("not compiled for this environment");e.print=typeof console<"u"?console.log.bind(console):typeof print<"u"?print:null,e.printErr=typeof printErr<"u"?printErr:typeof console<"u"&&console.warn.bind(console)||e.print,e.print=e.print,e.printErr=e.printErr;for(r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);n=void 0;var c=16;function l(T){y(!tn);var b=$;return $=$+T+15&-16,b}function d(T,b){b||(b=c);var U=T=Math.ceil(T/b)*b;return U}var m={"f64-rem":function(T,b){return T%b},debugger:function(){debugger}},u=new Array(0),p=1024,f=0,_=0;function y(T,b){T||Pt("Assertion failed: "+b)}function M(T,b){if(b===0||!T)return"";for(var U=0,I,H=0;I=O[T+H>>0],U|=I,!(I==0&&!b||(H++,b&&H==b)););b||(b=H);var nt="";if(U<128){for(var st=1024,ot;b>0;)ot=String.fromCharCode.apply(String,O.subarray(T,T+Math.min(b,st))),nt=nt?nt+ot:ot,T+=st,b-=st;return nt}return E(T)}var v=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function x(T,b){for(var U=b;T[U];)++U;if(U-b>16&&T.subarray&&v)return v.decode(T.subarray(b,U));for(var I,H,nt,st,ot,xt,Et="";;){if(I=T[b++],!I)return Et;if(!(I&128)){Et+=String.fromCharCode(I);continue}if(H=T[b++]&63,(I&224)==192){Et+=String.fromCharCode((I&31)<<6|H);continue}if(nt=T[b++]&63,(I&240)==224?I=(I&15)<<12|H<<6|nt:(st=T[b++]&63,(I&248)==240?I=(I&7)<<18|H<<12|nt<<6|st:(ot=T[b++]&63,(I&252)==248?I=(I&3)<<24|H<<18|nt<<12|st<<6|ot:(xt=T[b++]&63,I=(I&1)<<30|H<<24|nt<<18|st<<12|ot<<6|xt))),I<65536)Et+=String.fromCharCode(I);else{var wt=I-65536;Et+=String.fromCharCode(55296|wt>>10,56320|wt&1023)}}}function E(T){return x(O,T)}var w=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,C=65536,S=16777216;function P(T,b){return T%b>0&&(T+=b-T%b),T}var R,F,O,V,A,z,N,Q,rt;function ht(T){e.buffer=R=T}function _t(){e.HEAP8=F=new Int8Array(R),e.HEAP16=V=new Int16Array(R),e.HEAP32=z=new Int32Array(R),e.HEAPU8=O=new Uint8Array(R),e.HEAPU16=A=new Uint16Array(R),e.HEAPU32=N=new Uint32Array(R),e.HEAPF32=Q=new Float32Array(R),e.HEAPF64=rt=new Float64Array(R)}var Z,$,tn,en,oi,nn,rn,ai;Z=$=en=oi=nn=rn=ai=0,tn=!1;function Wn(){Pt("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+Jt+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which allows increasing the size at runtime, or (3) if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 ")}function ms(){Wn()}var sn=e.TOTAL_STACK||5242880,Jt=e.TOTAL_MEMORY||52428800;Jt<sn&&e.printErr("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+Jt+"! (TOTAL_STACK="+sn+")"),e.buffer?R=e.buffer:(typeof WebAssembly=="object"&&typeof WebAssembly.Memory=="function"?(e.wasmMemory=new WebAssembly.Memory({initial:Jt/C,maximum:Jt/C}),R=e.wasmMemory.buffer):R=new ArrayBuffer(Jt),e.buffer=R),_t();function us(){return Jt}if(z[0]=1668509029,V[1]=25459,O[2]!==115||O[3]!==99)throw"Runtime error: expected the system to be little-endian!";function Ae(T){for(;T.length>0;){var b=T.shift();if(typeof b=="function"){b();continue}var U=b.func;typeof U=="number"?b.arg===void 0?e.dynCall_v(U):e.dynCall_vi(U,b.arg):U(b.arg===void 0?null:b.arg)}}var Zn=[],Kn=[],ps=[],_s=[],Qn=[],$n=!1,fs=!1;function ys(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)ws(e.preRun.shift());Ae(Zn)}function vs(){$n||($n=!0,Ae(Kn))}function gs(){Ae(ps)}function xs(){Ae(_s),fs=!0}function Es(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Cs(e.postRun.shift());Ae(Qn)}function ws(T){Zn.unshift(T)}function Cs(T){Qn.unshift(T)}var $h=Math.abs,Jh=Math.cos,tc=Math.sin,ec=Math.tan,ic=Math.acos,nc=Math.asin,rc=Math.atan,sc=Math.atan2,oc=Math.exp,ac=Math.log,hc=Math.sqrt,cc=Math.ceil,lc=Math.floor,dc=Math.pow,mc=Math.imul,uc=Math.fround,pc=Math.round,_c=Math.min,fc=Math.max,yc=Math.clz32,vc=Math.trunc,te=0,on=null,Se=null;function Ms(T){te++,e.monitorRunDependencies&&e.monitorRunDependencies(te)}function Ts(T){if(te--,e.monitorRunDependencies&&e.monitorRunDependencies(te),te==0&&(on!==null&&(clearInterval(on),on=null),Se)){var b=Se;Se=null,b()}}e.preloadedImages={},e.preloadedAudios={};var Jn="data:application/octet-stream;base64,";function hi(T){return String.prototype.startsWith?T.startsWith(Jn):T.indexOf(Jn)===0}function bs(){var T="avc.wast",b="avc.temp.asm.js";typeof e.locateFile=="function"&&(hi(T)||(T=e.locateFile(T)),hi(Qt)||(Qt=e.locateFile(Qt)),hi(b)||(b=e.locateFile(b)));var U=64*1024,I={global:null,env:null,asm2wasm:m,parent:e},H=null;function nt(W){var K=e.buffer;W.byteLength<K.byteLength&&e.printErr("the new buffer in mergeMemory is smaller than the previous one. in native wasm, we should grow memory here");var _e=new Int8Array(K),ft=new Int8Array(W);ft.set(_e),ht(W),_t()}function st(W){return W}function ot(){try{if(e.wasmBinary)return new Uint8Array(e.wasmBinary);if(e.readBinary)return e.readBinary(Qt);throw"on the web, we need the wasm binary to be preloaded and set on Module['wasmBinary']. emcc.py will do that for you when generating HTML (but not JS)"}catch(W){Pt(W)}}function xt(){return!e.wasmBinary&&(s||o)&&typeof fetch=="function"?fetch(Qt,{}).then(function(W){if(!W.ok)throw"failed to load wasm binary file at '"+Qt+"'";return W.arrayBuffer()}).catch(function(){return ot()}):new Promise(function(W,K){W(ot())})}function Et(W,K,_e){if(typeof WebAssembly!="object")return e.printErr("no native wasm support detected"),!1;if(!(e.wasmMemory instanceof WebAssembly.Memory))return e.printErr("no native wasm Memory in use"),!1;K.memory=e.wasmMemory,I.global={NaN:NaN,Infinity:1/0},I["global.Math"]=Math,I.env=K;function ft(Ot,Oe){H=Ot.exports,H.memory&&nt(H.memory),e.asm=H,e.usingWasm=!0,Ts("wasm-instantiate")}if(Ms("wasm-instantiate"),e.instantiateWasm)try{return e.instantiateWasm(I,ft)}catch(Ot){return e.printErr("Module.instantiateWasm callback failed with error: "+Ot),!1}function jt(Ot){ft(Ot.instance,Ot.module)}function ee(Ot){xt().then(function(Oe){return WebAssembly.instantiate(Oe,I)}).then(Ot).catch(function(Oe){e.printErr("failed to asynchronously prepare wasm: "+Oe),Pt(Oe)})}return!e.wasmBinary&&typeof WebAssembly.instantiateStreaming=="function"&&!hi(Qt)&&typeof fetch=="function"?WebAssembly.instantiateStreaming(fetch(Qt,{}),I).then(jt).catch(function(Ot){e.printErr("wasm streaming compile failed: "+Ot),e.printErr("falling back to ArrayBuffer instantiation"),ee(jt)}):ee(jt),{}}e.asmPreload=e.asm;var wt=e.reallocBuffer,Pe=function(W){var K=e.usingWasm?C:S;W=P(W,K);var _e=e.buffer,ft=_e.byteLength;if(e.usingWasm)try{var jt=e.wasmMemory.grow((W-ft)/U);return jt!==-1?e.buffer=e.wasmMemory.buffer:null}catch{return null}};e.reallocBuffer=function(W){return pe==="asmjs"?wt(W):Pe(W)};var pe="";e.asm=function(W,K,_e){if(K=K,!K.table){var ft=e.wasmTableSize;ft===void 0&&(ft=1024);var jt=e.wasmMaxTableSize;typeof WebAssembly=="object"&&typeof WebAssembly.Table=="function"?jt!==void 0?K.table=new WebAssembly.Table({initial:ft,maximum:jt,element:"anyfunc"}):K.table=new WebAssembly.Table({initial:ft,element:"anyfunc"}):K.table=new Array(ft),e.wasmTable=K.table}K.memoryBase||(K.memoryBase=e.STATIC_BASE),K.tableBase||(K.tableBase=0);var ee;return ee=Et(W,K,_e),y(ee,"no binaryen method succeeded."),ee}}bs(),Z=p,$=Z+9888,Kn.push();var Rs=9888;e.STATIC_BASE=Z,e.STATIC_BUMP=Rs,$+=16;var et={varargs:0,get:function(T){et.varargs+=4;var b=z[et.varargs-4>>2];return b},getStr:function(){var T=M(et.get());return T},get64:function(){var T=et.get(),b=et.get();return T>=0?y(b===0):y(b===-1),T},getZero:function(){y(et.get()===0)}};function As(T,b){et.varargs=b;try{var U=et.getStreamFromFD(),I=et.get(),H=et.get(),nt=et.get(),st=et.get(),ot=H;return FS.llseek(U,ot,st),z[nt>>2]=U.position,U.getdents&&ot===0&&st===0&&(U.getdents=null),0}catch(xt){return(typeof FS>"u"||!(xt instanceof FS.ErrnoError))&&Pt(xt),-xt.errno}}function ue(T,b){et.varargs=b;try{var U=et.get(),I=et.get(),H=et.get(),nt=0;ue.buffers||(ue.buffers=[null,[],[]],ue.printChar=function(wt,Pe){var pe=ue.buffers[wt];y(pe),Pe===0||Pe===10?((wt===1?e.print:e.printErr)(x(pe,0)),pe.length=0):pe.push(Pe)});for(var st=0;st<H;st++){for(var ot=z[I+st*8>>2],xt=z[I+(st*8+4)>>2],Et=0;Et<xt;Et++)ue.printChar(U,O[ot+Et]);nt+=xt}return nt}catch(wt){return(typeof FS>"u"||!(wt instanceof FS.ErrnoError))&&Pt(wt),-wt.errno}}function Ss(T,b){et.varargs=b;try{return 0}catch(U){return(typeof FS>"u"||!(U instanceof FS.ErrnoError))&&Pt(U),-U.errno}}function Ps(T,b){et.varargs=b;try{var U=et.getStreamFromFD();return FS.close(U),0}catch(I){return(typeof FS>"u"||!(I instanceof FS.ErrnoError))&&Pt(I),-I.errno}}function tr(){i()}e._broadwayOnHeadersDecoded=tr;function er(T,b,U){t(T,b,U)}e._broadwayOnPictureDecoded=er;function Os(T,b,U){return O.set(O.subarray(b,b+U),T),T}function Ds(T){return e.___errno_location&&(z[e.___errno_location()>>2]=T),T}ai=l(4),en=oi=d($),nn=en+sn,rn=d(nn),z[ai>>2]=rn,tn=!0,e.wasmTableSize=10,e.wasmMaxTableSize=10,e.asmGlobalArg={},e.asmLibraryArg={abort:Pt,enlargeMemory:ms,getTotalMemory:us,abortOnCannotGrowMemory:Wn,___setErrNo:Ds,___syscall140:As,___syscall146:ue,___syscall54:Ss,___syscall6:Ps,_broadwayOnHeadersDecoded:tr,_broadwayOnPictureDecoded:er,_emscripten_memcpy_big:Os,DYNAMICTOP_PTR:ai,STACKTOP:oi};var ir=e.asm(e.asmGlobalArg,e.asmLibraryArg,R);e.asm=ir;var gc=e._broadwayCreateStream=function(){return e.asm._broadwayCreateStream.apply(null,arguments)},xc=e._broadwayExit=function(){return e.asm._broadwayExit.apply(null,arguments)},Ec=e._broadwayGetMajorVersion=function(){return e.asm._broadwayGetMajorVersion.apply(null,arguments)},wc=e._broadwayGetMinorVersion=function(){return e.asm._broadwayGetMinorVersion.apply(null,arguments)},Cc=e._broadwayInit=function(){return e.asm._broadwayInit.apply(null,arguments)},Mc=e._broadwayPlayStream=function(){return e.asm._broadwayPlayStream.apply(null,arguments)};e.asm=ir;function ci(T){this.name="ExitStatus",this.message="Program terminated with exit("+T+")",this.status=T}ci.prototype=new Error,ci.prototype.constructor=ci;var zs;Se=function T(){e.calledRun||an(),e.calledRun||(Se=T)};function an(T){if(T=T||e.arguments,te>0||(ys(),te>0)||e.calledRun)return;function b(){e.calledRun||(e.calledRun=!0,!f&&(vs(),gs(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),Es()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),b()},1)):b()}e.run=an;function Fs(T,b){b&&e.noExitRuntime&&T===0||(e.noExitRuntime||(f=!0,_=T,oi=zs,xs(),e.onExit&&e.onExit(T)),a&&process.exit(T),e.quit(T,new ci(T)))}e.exit=Fs;function Pt(T){throw e.onAbort&&e.onAbort(T),T!==void 0?(e.print(T),e.printErr(T),T=JSON.stringify(T)):T="",f=!0,_=1,"abort("+T+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=Pt,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();e.noExitRuntime=!0,an();var qt;typeof $t<"u"&&$t.Module&&(qt=$t.Module),typeof e<"u"&&(qt=e),qt._broadwayOnHeadersDecoded=i,qt._broadwayOnPictureDecoded=t;var nr=!1,hn,Ls=function(){nr=!0,hn&&hn(qt)};return qt.onRuntimeInitialized=function(){Ls(qt)},function(T){nr?T(qt):hn=T}},zt=function(){return new Date().getTime()};typeof performance<"u"&&performance.now&&(zt=function(){return performance.now()});var $i=function(i){this.options=i||{},this.now=zt;var t,e={},n,r,s=function(d,m,u){var p=this.pictureBuffers[d];p||(p=this.pictureBuffers[d]=n(d,m*u*3/2));var f,_=!1;if(this.infoAr.length&&(_=!0,f=this.infoAr),this.infoAr=[],this.options.rgb){t||(t=Wh(m,u)),t.inp.set(p),t.doit();var y=new Uint8Array(t.outSize);y.set(t.out),_&&(f[0].finishDecoding=zt()),this.onPictureDecoded(y,m,u,f);return}_&&(f[0].finishDecoding=zt()),this.onPictureDecoded(p,m,u,f)}.bind(this),o=!1;this.options.sliceMode&&(s=function(d,m,u,p){if(!o){var f=this.pictureBuffers[d];f||(f=this.pictureBuffers[d]=n(d,m*u*3/2));var _=this.pictureBuffers[p];_||(_=this.pictureBuffers[p]=r(p,18));var y,M=!1;this.infoAr.length&&(M=!0,y=this.infoAr),this.infoAr=[],y[0].finishDecoding=zt();for(var v=[],x=0;x<20;++x)v.push(_[x]);y[0].sliceInfoAr=v,this.onPictureDecoded(f,m,u,y)}}.bind(this));var a=Xh.apply(e,[function(){},s]),h=1024*1024,c=this;this.onPictureDecoded=function(d,m,u,p){},this.onDecoderReady=function(){};var l=[];this.decode=function(m,u,p){l.push([m,u,p])},a(function(d){var m=d.HEAP8,u=d.HEAPU8,p=d.HEAP16,f=d.HEAP32;d._broadwayInit(),n=function(M,v){return u.subarray(M,M+v)},r=function(M,v){return new Uint32Array(u.buffer,M,v)},c.streamBuffer=n(d._broadwayCreateStream(h),h),c.pictureBuffers={},c.infoAr=[];var _=0;if(c.options.sliceMode?(_=c.options.sliceNum,c.decode=function(v,x,E){c.infoAr.push(x),x.startDecoding=zt();var w=x.nals,C;if(!w){w=[],x.nals=w;var S=v.length,P=!1,R=0,F=0;for(C=0;C<S;++C)if(v[C]===1&&v[C-1]===0&&v[C-2]===0){var O=C-2;v[C-3]===0&&(O=C-3),P&&w.push({offset:R,end:O,type:v[F]&31}),R=O,F=O+3,v[C-3]===0&&(F=O+4),P=!0}P&&w.push({offset:R,end:C,type:v[F]&31})}var V=0,A,z=0;for(C=0;C<w.length;++C)w[C].type===1||w[C].type===5?(V===_&&(A=v.subarray(w[C].offset,w[C].end),c.streamBuffer[z]=0,z+=1,c.streamBuffer.set(A,z),z+=A.length),V+=1):(A=v.subarray(w[C].offset,w[C].end),c.streamBuffer[z]=0,z+=1,c.streamBuffer.set(A,z),z+=A.length,d._broadwayPlayStream(z),z=0);E(),d._broadwayPlayStream(z)}):c.decode=function(v,x){x&&(c.infoAr.push(x),x.startDecoding=zt()),c.streamBuffer.set(v),d._broadwayPlayStream(v.length)},l.length){var y=0;for(y=0;y<l.length;++y)c.decode(l[y][0],l[y][1],l[y][2]);l=[]}c.onDecoderReady(c)})};$i.prototype={};var Ln={},Wh=function(i,t){var e=""+i+"x"+t;if(Ln[e])return Ln[e];for(var n=i*t,r=(n|0)>>2,s=n+r+r,o=i*t*4,a=Math.pow(2,24)*4,h=s+o+a,c=Math.pow(2,24),l=c;l<h;)l+=c;var d=new ArrayBuffer(l),m=Zh($t,{},d);return m.init(i,t),Ln[e]=m,m.heap=d,m.out=new Uint8Array(d,0,o),m.inp=new Uint8Array(d,o,s),m.outSize=o,m};function Zh(i,t,e){var n=i.Math.imul,r=i.Math.min,s=i.Math.max,o=i.Math.pow,a=new i.Uint8Array(e),h=new i.Uint32Array(e),c=new i.Uint8Array(e),l=new i.Uint8Array(e),d=new i.Uint32Array(e),m=0,u=0,p=0,f=0,_=0,y=0,M=0,v=0,x=0,E=0;function w(P,R){P=P|0,R=R|0;var F=0,O=0;for(m=P,x=n(P,4)|0,u=R,p=n(m|0,u|0)|0,f=(p|0)>>2,y=n(n(m,u)|0,4)|0,_=p+f|0+f|0,v=0,M=v+y|0,E=M+_|0,O=~~+o(2,24),O=n(O,4)|0,F=0;(F|0)<(O|0)|0;F=F+4|0)d[(E+F|0)>>2]=0}function C(){var P=0,R=0,F=0,O=0,V=0,A=0,z=0,N=0,Q=0,rt=0,ht=0,_t=0,Z=0,$=0;for(Z=v|0,P=M|0,R=P+p|0|0,F=R+f|0,Q=0;(Q|0)<(u|0);Q=Q+2|0){for(ht=R,_t=F,rt=0;(rt|0)<(m|0);rt=rt+2|0)O=c[P>>0]|0,V=c[(P+m|0)>>0]|0,A=c[R>>0]|0,z=c[F>>0]|0,$=((O<<16|0)+(A<<8|0)|0)+z|0,N=d[(E+$|0)>>2]|0,N||(N=S(O,A,z)|0,d[(E+$|0)>>2]=N|0),d[Z>>2]=N,$=((V<<16|0)+(A<<8|0)|0)+z|0,N=d[(E+$|0)>>2]|0,N||(N=S(V,A,z)|0,d[(E+$|0)>>2]=N|0),d[(Z+x|0)>>2]=N,Z=Z+4|0,P=P+1|0,O=c[P>>0]|0,V=c[(P+m|0)>>0]|0,$=((O<<16|0)+(A<<8|0)|0)+z|0,N=d[(E+$|0)>>2]|0,N||(N=S(O,A,z)|0,d[(E+$|0)>>2]=N|0),d[Z>>2]=N,$=((V<<16|0)+(A<<8|0)|0)+z|0,N=d[(E+$|0)>>2]|0,N||(N=S(V,A,z)|0,d[(E+$|0)>>2]=N|0),d[(Z+x|0)>>2]=N,Z=Z+4|0,P=P+1|0,R=R+1|0,F=F+1|0;Z=Z+x|0,P=P+m|0}}function S(P,R,F){P=P|0,R=R|0,F=F|0;var O=0,V=0,A=0,z=0,N=0,Q=0,rt=0,ht=0,_t=0;return N=n(1192,P-16|0)|0,Q=n(1634,F-128|0)|0,rt=n(832,F-128|0)|0,ht=n(400,R-128|0)|0,_t=n(2066,R-128|0)|0,O=(N+Q|0)>>10|0,V=((N-rt|0)-ht|0)>>10|0,A=(N+_t|0)>>10|0,(O&255|0)!=(O|0)|0&&(O=r(255,s(0,O|0)|0)|0),(V&255|0)!=(V|0)|0&&(V=r(255,s(0,V|0)|0)|0),(A&255|0)!=(A|0)|0&&(A=r(255,s(0,A|0)|0)|0),z=255,z=z<<8|0,z=z+A|0,z=z<<8|0,z=z+V|0,z=z<<8|0,z=z+O|0,z|0}return{init:w,doit:C}}typeof self<"u"&&(Vn=!1,ji=!1,Je=!1,ti=0,Xi=0,Wi=0,ei=0,Ki=[],ni=[],Nn=function(i){if(ni.length){for(var t=ni.shift();t&&t.byteLength!==i;)t=ni.shift();if(t)return t}return new ArrayBuffer(i)},Qi=function(i,t,e,n,r){var s=n*r,o=s/4,a=s,h=s+o,c=function(p,f){var _=0;for(_=0;_<16;++_){var y=p+n*_,M=f+n*_;t.set(i.subarray(y,M),y)}},l=function(p,f){var _=0;for(_=0;_<8;++_){var y=p+n/2*_,M=f+n/2*_;t.set(i.subarray(y,M),y)}},d=function(p,f){t.set(i.subarray(p,f),p)},m=e[0],u=e[1];u>0&&(c(m,u),l(e[2],e[3]),l(e[4],e[5])),m=e[6],u=e[7],u>0&&(c(m,u),l(e[8],e[9]),l(e[10],e[11])),m=e[12],u=e[15],u>0&&(d(m,u),d(e[13],e[16]),d(e[14],e[17]))},Kh=function(){},Bn=function(i){Xi=i,Wi=Xi-1},self.addEventListener("message",function(i){if(Vn){if(ji&&i.data.reuse&&ni.push(i.data.reuse),i.data.buf){Je&&ei!==0?Ki.push(i.data):ce.decode(new Uint8Array(i.data.buf,i.data.offset||0,i.data.length),i.data.info,function(){Je&&ti!==Wi&&postMessage(i.data,[i.data.buf])});return}if(i.data.slice){var t=zt();if(Qi(new Uint8Array(i.data.slice),Zi,i.data.infos[0].sliceInfoAr,i.data.width,i.data.height),i.data.theOne&&(Qi(Zi,new Uint8Array(i.data.slice),Un,i.data.width,i.data.height),ii>i.data.infos[0].timeDecoding&&(i.data.infos[0].timeDecoding=ii),i.data.infos[0].timeCopy+=zt()-t),postMessage(i.data,[i.data.slice]),ei-=1,ei===0&&Ki.length){var e=Ki.shift();ce.decode(new Uint8Array(e.buf,e.offset||0,e.length),e.info,function(){Je&&ti!==Wi&&postMessage(e,[e.buf])})}return}if(i.data.setSliceCnt){Bn(i.data.sliceCnt);return}}else i.data&&i.data.type==="Broadway.js - Worker init"&&(Vn=!0,ce=new $i(i.data.options),i.data.options.sliceMode?(ji=!0,Je=!0,ti=i.data.options.sliceNum,Bn(i.data.options.sliceCnt),ce.onPictureDecoded=function(n,r,s,o){var a=new Uint8Array(Nn(n.length));Qi(n,a,o[0].sliceInfoAr,r,s),kn=o[0].startDecoding,In=o[0].finishDecoding,ii=In-kn,o[0].timeDecoding=ii,o[0].timeCopy=0,postMessage({slice:a.buffer,sliceNum:ti,width:r,height:s,infos:o},[a.buffer]),ei=Xi-1,Zi=n,Un=o[0].sliceInfoAr}):i.data.options.reuseMemory?(ji=!0,ce.onPictureDecoded=function(n,r,s,o){var a=new Uint8Array(Nn(n.length));a.set(n,0,n.length),postMessage({buf:a.buffer,length:n.length,width:r,height:s,infos:o},[a.buffer])}):ce.onPictureDecoded=function(n,r,s,o){n&&(n=new Uint8Array(n));var a=new Uint8Array(n.length);a.set(n,0,n.length),postMessage({buf:a.buffer,length:n.length,width:r,height:s,infos:o},[a.buffer])},postMessage({consoleLog:"broadway worker initialized"}))},!1));var Vn,ce,ji,Je,ti,Xi,Wi,Un,Zi,ei,Ki,kn,In,ii,ni,Nn,Qi,Kh,Bn;$i.nowValue=zt;var hs=$i;var ds=Hs(ls());var le=class{#t=null;constructor({decoded_frame_consumer:t}){this.#t=t}_onFrameDecoded({decoded_frame:t}){this.#i({meta_data:t.meta_data}),this.#t?.consumeDecodedFrame({decoded_frame:t})}#i({meta_data:t}){this.#e({meta_data:t});for(let e of t.viewport_layout_camera_entities)e.viewport.camera_projection?.updateFromFrameCameraTransform({frame_camera_transform:e})}#e({meta_data:t}){for(let{camera_entity:e,world_position:n,world_orientation:r}of t.other_clients_camera_entities)e._setGlobalTransform({global_transform:{position:n,orientation:r},change_source:"external"})}};var Yn=class extends le{#t=new hs;#i=null;#e=null;constructor({decoded_frame_consumer:t}){super({decoded_frame_consumer:t})}configure({codec:t,frame_dimensions:e}){if(t!=="h264")throw new Error("Software decoder supports only h264 encoding");return this.#i=new OffscreenCanvas(e[0],e[1]),this.#e=new ds.default({canvas:this.#i,width:e[0],height:e[1]}),this.#t.onPictureDecoded=this.#n,Promise.resolve(this)}resize({frame_dimensions:t}){this.#i&&(this.#i.width=t[0],this.#i.height=t[1]),this.#e&&(this.#e.width=t[0],this.#e.height=t[1])}release(){}consumeEncodedFrame({encoded_frame:t}){let e=new Uint8Array(t.video_stream.buffer,t.video_stream.byteOffset,t.video_stream.byteLength);this.#t.decode(e,t.meta_data)}#n=(t,e,n,r)=>{let s=e,o=n,a=e/2,h=n/2,c=s*o,l=a*h;this.#e.drawNextOutputPicture({yData:t.subarray(0,c),uData:t.subarray(c,c+l),vData:t.subarray(c+l,c+l+l),yDataPerRow:s,yRowCnt:o,uDataPerRow:a,uRowCnt:h});let d=r[0];super._onFrameDecoded({decoded_frame:{pixels:this.#i,dimensions_in_pixels:[e,n],meta_data:d}})}};var Gn=class i extends le{static async findSupportedCodec(){if(typeof VideoDecoder>"u")return null;for(let t of this.#t.keys()){let e=await i.#i({codec:t});if(e)return e.codec,t}return null}static get#t(){return Object.freeze(new Map([["h265",["hvc1.1.6.L123.00"]],["h264",["avc1.42001E","avc1.42002A","avc1.42E01E","avc1.64001f","avc1.42002A"]]]))}static async#i({codec:t,frame_dimensions:e}){if(typeof VideoDecoder>"u"||!i.#t.has(t))return null;let n=i.#t.get(t),r={codec:"",codedWidth:e?.[0],codedHeight:e?.[1],optimizeForLatency:!0},s=["prefer-hardware","prefer-software","no-preference"];for(let o of s)if(!(t==="h264"&&o==="prefer-hardware"))for(let a of n){r.codec=a;let h=await VideoDecoder.isConfigSupported({...r,hardwareAcceleration:o});if(h.supported&&h.config)return h.config}return null}#e=null;#n=null;#r=!0;#o=new Map;#s=null;constructor({decoded_frame_consumer:t}){super({decoded_frame_consumer:t})}async configure({codec:t,frame_dimensions:e}){this.release();let n=await i.#i({codec:t,frame_dimensions:e});if(!n)throw new Error("Codec not supported");return this.#e=new VideoDecoder({output:this.#a,error:r=>console.error(r.message)}),this.#n=n,this.#e.configure(this.#n),this.#n,this}resize({frame_dimensions:t}){this.#e&&this.#n&&(this.#n.codedWidth=t[0],this.#n.codedHeight=t[1],this.#r=!1,this.#e.configure(this.#n))}release(){this.#s?.close(),this.#e?.close()}consumeEncodedFrame({encoded_frame:t}){let e=new EncodedVideoChunk({timestamp:t.meta_data.frame_counter,type:this.#r?"key":"delta",data:new Uint8Array(t.video_stream.buffer,t.video_stream.byteOffset,t.video_stream.byteLength)});this.#r=!1,this.#o.set(t.meta_data.frame_counter,t.meta_data),this.#e.decode(e)}#a=t=>{this.#s&&this.#s.close();let e=this.#o.get(t.timestamp);if(!e){console.error("No meta data for frame",t.timestamp);return}super._onFrameDecoded({decoded_frame:{pixels:t,dimensions_in_pixels:[t.displayWidth,t.displayHeight],meta_data:e}}),this.#o.delete(t.timestamp),this.#s=t}};var de=class{refreshSize(){}};var ri=class extends de{_canvas;_context2D;constructor(t,e){super();let n=t.getContext("2d",e);if(n===null)throw new Error(`Cannot create a 2d context from canvas ${t}`);this._canvas=t,this._context2D=n}drawFrameSection({frame_section:t,viewport:e}){let n=t.section.left*t.dimensions_in_pixels[0],r=t.section.top*t.dimensions_in_pixels[1],s=t.section.width*t.dimensions_in_pixels[0],o=t.section.height*t.dimensions_in_pixels[1],a=e.left*this._canvas.width,h=e.top*this._canvas.height,c=e.width*this._canvas.width,l=e.height*this._canvas.height;this._context2D.drawImage(t.pixels,n,r,s,o,a,h,c,l)}release(){this._context2D.reset()}};var si=class extends de{_canvas;_context;_texture_ref=null;_shader_program=null;_frame_buffer=null;get native(){return this._context}set frame_buffer(t){this._frame_buffer=t}constructor(t,e="webgl",n){super();let r=t.getContext(e,n);if(r===null)throw new Error(`Cannot create a ${e} context from canvas`);this._canvas=t,this._context=r,this._initShaderProgram(),this._initBuffers(),this._initTexture()}drawFrameSection({frame_section:t}){let e=this._context;this._frame_buffer!==null&&e.bindFramebuffer(e.FRAMEBUFFER,this._frame_buffer),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);let n=e.getUniformLocation(this._shader_program,"size"),r=e.getUniformLocation(this._shader_program,"offset");e.uniform2fv(n,[t.section.width,t.section.height]),e.uniform2fv(r,[t.section.left,t.section.top]),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._texture_ref),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.pixels),e.drawArrays(e.TRIANGLE_STRIP,0,4)}refreshSize(){this._context.viewport(0,0,this._canvas.width,this._canvas.height)}release(){let t=this._context;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}_initShaderProgram(){let t=this._context,e=`
            attribute vec2 position;
            varying vec2 texCoord;
            uniform vec2 size;
            uniform vec2 offset;

            void main() {
                texCoord = (position + 1.0) * 0.5;
                texCoord.y = 1.0 - texCoord.y;
                texCoord = size * texCoord + offset;
                gl_Position = vec4(position, 0.0, 1.0);
            }`,n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)||console.error("Vertex shader failed to compile: "+t.getShaderInfoLog(n));let r=`
            precision mediump float;
            varying vec2 texCoord;
            uniform sampler2D texture;

            void main() {
                gl_FragColor = texture2D(texture, texCoord);
            }`,s=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(s,r),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)||console.error("Fragment shader failed to compile: "+t.getShaderInfoLog(s));let o=t.createProgram();t.attachShader(o,n),t.attachShader(o,s),t.linkProgram(o),t.useProgram(o),t.getProgramParameter(o,t.LINK_STATUS)||console.error("Program failed to compile: "+t.getProgramInfoLog(o)),t.useProgram(o),this._shader_program=o}_initBuffers(){let t=this._context,e=t.createBuffer(),n=new Float32Array([1,1,-1,1,1,-1,-1,-1]);t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW);let r=t.getAttribLocation(this._shader_program,"position");t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0)}_initTexture(){let t=this._context;this._texture_ref=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._texture_ref),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null);let e=t.getUniformLocation(this._shader_program,"texture");t.uniform1i(e,0)}};var Gt=class extends mt{viewports=[];#t=null;relative_rect=new ct({left:0,top:0,width:1,height:1});get dimensions(){return[this.width,this.height]}addViewport({viewport:t}){this.viewports.push(t)}removeViewport({viewport:t}){let e=this.viewports.indexOf(t);e!==-1&&this.viewports.splice(e,1)}release(){this.#t=null;for(let t of this.viewports)t.release()}isValid(){return this.viewports.length>0&&this.viewports.every(t=>t.isValid())}drawFrame({decoded_frame:t}){this.#t=t,this._drawFrame({decoded_frame:t})}redrawLastFrame(){this.#t!==null&&this._drawFrame({decoded_frame:this.#t})}_getViewportConfigs({width:t,height:e}){if(!this.isValid())throw new Error("Invalid config");let n=[this.relative_rect.left*t,this.relative_rect.top*e];return this.viewports.map(r=>({camera_rtid:r.camera_projection.camera_entity.rtid,left:(n[0]+r.relative_rect.left*this.width)/t,top:(n[1]+r.relative_rect.top*this.height)/e,width:r.width/t,height:r.height/e,render_target_index:r.render_target_index,z_index:r.z_index}))}};var qn=class extends Gt{#t;get width(){return this.#t.width}get height(){return this.#t.height}constructor({width:t,height:e}){super(),this.#t=new Dt({width:t,height:e})}getBoundingRect(){return this.#t}_drawFrame(){}};var Ji=class{#t;#i;#e=null;#n=500;#r;constructor({canvas:t,onResized:e}){this.#t=t,this.#i=new ResizeObserver(this.#o),this.#r=e,this.#i.observe(this.#t)}release(){this.#i.disconnect()}#o=()=>{this.#e&&clearTimeout(this.#e),this.#e=setTimeout(this.#s,this.#n)};#s=()=>{let t=[this.#t.width,this.#t.height];this.#t.width=this.#t.clientWidth,this.#t.height=this.#t.clientHeight;let e=[this.#t.width,this.#t.height];this.#t.width===0||this.#t.height===0||this.#a(t,e)&&this.#r({old_size:t,new_size:e})};#a(t,e){return t.some((n,r)=>n!==e[r])}};var me=class extends Event{constructor(){super("on-rendering-surface-resized")}};var jn=class extends Gt{#t;#i;#e;get width(){return this.#t.clientWidth}get height(){return this.#t.clientHeight}get canvas(){return this.#t}constructor({canvas_element:t,context_type:e,context_attributes:n}){super();let r=typeof t=="string"?document.getElementById(t):t;if(r===null)throw new Error(`Cannot find canvas ${t}`);if(r.nodeName!=="CANVAS")throw new Error(`HTML element ${t} is a '${r.nodeName}', it MUST be CANVAS`);switch(this.#t=r,e){case"2d":this.#i=new ri(this.#t);break;case"webgl":case"webgl2":this.#i=new si(this.#t,e,n);break}this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.#e=new Ji({canvas:this.canvas,onResized:this.#n}),this.#i.refreshSize()}release(){super.release(),this.#e.release(),this.#i.release()}getContext(){return this.#i}getBoundingRect(){let t=this.canvas.getClientRects()[0];return t&&(t.x=Math.ceil(t.x),t.y=Math.ceil(t.y),t.width=Math.ceil(t.width),t.height=Math.ceil(t.height)),new Dt(t??{width:this.canvas.width,height:this.canvas.height})}_drawFrame({decoded_frame:t}){this.#i.drawFrameSection({frame_section:{pixels:t.pixels,dimensions_in_pixels:t.dimensions_in_pixels,meta_data:t.meta_data,section:this.relative_rect},viewport:ct.default});for(let e of this.viewports){let n=e._drawOverlays();n&&this.#i.drawFrameSection({frame_section:{pixels:n,dimensions_in_pixels:[n.width,n.height],meta_data:t.meta_data,section:ct.default},viewport:e.relative_rect})}}#n=t=>{this.#i.refreshSize(),this._dispatchEvent(new me);for(let e of this.viewports)e._onResize()}};var Xn=class extends Gt{#t;#i;#e;constructor({width:t,height:e,context_constructor:n,context_type:r,context_options:s,resolution_scale:o=1}){super(),this.#t=document.createElement("canvas"),this.#t.width=t,this.#t.height=e,this.#i=new n(this.#t,r,s),this.#e=o}get width(){return Math.floor(this.#t.width*this.#e)}get height(){return Math.floor(this.#t.height*this.#e)}get context(){return this.#i}get cameras(){return this.viewports.map(t=>t.camera_projection?.camera_entity?t.camera_projection.camera_entity:null).filter(t=>t!==null)}release(){super.release(),this.#i.release()}_drawFrame({decoded_frame:t}){this.#i.drawFrameSection({frame_section:{pixels:t.pixels,section:this.relative_rect,dimensions_in_pixels:t.dimensions_in_pixels,meta_data:t.meta_data},viewport:ct.default})}getBoundingRect(){return new Dt({width:this.width,height:this.height})}resize(t,e){this.#t.width=t,this.#t.height=e,this.#i.refreshSize()}get resolution_scale(){return this.#e}set resolution_scale(t){this.#e!==t&&(this.#e=t,this._dispatchEvent(new me))}};typeof window<"u"&&(window.__LIVELINK__||(window.__LIVELINK__={}),Object.prototype.hasOwnProperty.call(window.__LIVELINK__,"@3dverse/livelink")?console.warn("\u26A0\uFE0F WARNING \u26A0\uFE0F Multiple instances of Livelink being imported."):window.__LIVELINK__["@3dverse/livelink"]="0.8.46");
//# sourceMappingURL=index.cjs.map
