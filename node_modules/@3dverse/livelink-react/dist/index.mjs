var Ee=Object.defineProperty;var Ce=(e,t)=>{for(var n in t)Ee(e,n,{get:t[n],enumerable:!0})};import{useContext as Me,useEffect as Q,useReducer as Re,useState as Z}from"react";import z,{createContext as _e,useCallback as ge,useEffect as q,useRef as we,useState as I}from"react";import*as S from"@3dverse/livelink";import{Livelink as N}from"@3dverse/livelink";var P=_e({instance:null,isConnecting:!1,isDisconnected:!1,disconnect:()=>{}});function nn({sceneId:e,sessionId:t,isTransient:n,token:r,LoadingPanel:o,InactivityWarningPanel:i,ConnectionErrorPanel:s,autoJoinExisting:c=!0,clientType:l,children:p}){let[a,d]=I(null),[m,g]=I(!0),[u,C]=I(!1),[x,w]=I(null),[j,T]=I("Unknown error"),f=we(new Map),k=ge(()=>a?.disconnect(),[a]);return q(()=>{let L=async({autoJoinExisting:y,sceneId:M,sessionId:R,clientType:J})=>{if(R){let A=await S.Session.findById({session_id:R,token:r});if(!A)throw new Error(`Session '${R}' not found on scene '${M}'`);return N.join({session:A})}if(M)return y?N.join_or_start({scene_id:M,token:r,is_transient:n}):N.start({scene_id:M,token:r,is_transient:n});if(J==="guest"){let A=await S.Session.findByGuestToken({guest_token:r});if(!A)throw new Error(`No session available for guest token '${r}'`);return N.join({session:A})}throw new Error("What are we doing here?!")},v=y=>{let M=Pe(y),R=f.current.get(M);return R||(R=L(y).then(J=>(f.current.delete(M),J)),f.current.set(M,R)),R},E=new AbortController,h=()=>{w(null)};return v({autoJoinExisting:c,sceneId:e,sessionId:t,token:r,clientType:l}).then(y=>{E.signal.aborted||(Le(y),d(y),y.TO_REMOVE__setReadyCallback(async()=>{y.startStreaming(),g(!1)}),y.session.addEventListener("on-inactivity-warning",w),y.session.addEventListener("on-activity-detected",h))}).catch(y=>{g(!1),C(!0),T(y)}),()=>{E.abort(),a?.session.removeEventListener("on-inactivity-warning",w),a?.session.removeEventListener("on-activity-detected",h),d(null),g(!0),C(!1),w(null)}},[r,c,e,t,n,l]),q(()=>{if(!a)return;let L=v=>{C(!0),w(null),T(v.reason)};return a.session.addEventListener("on-disconnected",L),()=>{a.session.removeEventListener("on-disconnected",L)}},[a]),q(()=>()=>{a?.disconnect()},[a]),z.createElement(P.Provider,{value:{instance:a,isConnecting:m,isDisconnected:u,disconnect:k}},m&&o&&z.createElement(o,{stage:""}),u&&s&&z.createElement(s,{error:j}),x&&i&&z.createElement(i,{warningDuration:x.seconds_remaining,onActivityDetected:()=>{x.resetTimer(),w(null)}}),p)}function Le(e){let t=async()=>{e.session.removeEventListener("TO_REMOVE__viewports-added",t);let n=await S.WebCodecsDecoder.findSupportedCodec();await e.configureRemoteServer({codec:n||void 0}),await e.setEncodedFrameConsumer({encoded_frame_consumer:n!==null?new S.WebCodecsDecoder({decoded_frame_consumer:e.default_decoded_frame_consumer}):new S.SoftwareDecoder({decoded_frame_consumer:e.default_decoded_frame_consumer})}),e.TO_REMOVE__startIfReady()};e.session.addEventListener("TO_REMOVE__viewports-added",t)}function Pe(e){return JSON.stringify(e)}function ee(e,t=[]){let{instance:n}=Me(P),[r,o]=Z(null),[i,s]=Z(!0),[,c]=Re(p=>p+1,0),l=e;return Q(()=>n?((async()=>"components"in e?await n.scene.newEntity(e):"linkage"in l?await n.scene.findEntity({entity_uuid:l.euid,linkage:l.linkage}):"euid"in l?(await n.scene.findEntities({entity_uuid:l.euid}))[0]:"name"in l&&l.name?(await n.scene.findEntitiesByNames({entity_names:[l.name]}))[0]:"mandatory_components"in l?(await n.scene.findEntitiesWithComponents({mandatory_components:l.mandatory_components,forbidden_components:l.forbidden_components}))[0]:null)().then(a=>o(a)).finally(()=>s(!1)),()=>{o(null),s(!0)}):void 0,[n,JSON.stringify(l)]),Q(()=>{let p=t==="any",a=t.length===0;if(!r||a)return;let d=p?c:m=>{m.isAnyComponentDirty({components:t})&&c()};return r.addEventListener("on-entity-updated",d),()=>{r.removeEventListener("on-entity-updated",d)}},[r,t]),{isPending:i,entity:r}}import{useContext as Se,useEffect as ke,useState as De}from"react";function pn(){let{instance:e}=Se(P),[t,n]=De([]);return ke(()=>{if(!e)return;let r=()=>n(e.session.other_clients);return e.session.addEventListener("on-client-joined",r),e.session.addEventListener("on-client-left",r),r(),()=>{e.session.removeEventListener("on-client-joined",r),e.session.removeEventListener("on-client-left",r),n([])}},[e]),{clients:t}}function un(e={},t=[]){let{name:n="Camera",position:r=[0,1,5],orientation:o=[0,0,0,1],eulerOrientation:i=[0,0,0],renderGraphRef:s="398ee642-030a-45e7-95df-7147f6c43392",settings:c={grid:!0,skybox:!1,gradient:!0},renderTargetIndex:l=-1,perspective_lens:p={fovy:60,nearPlane:.1,farPlane:1e4}}=e,a="orientation"in e?o:void 0,d=!a&&"eulerOrientation"in e?i:void 0,m="orthographic_lens"in e?e.orthographic_lens:void 0,g=m?void 0:p,{isPending:u,entity:C}=ee({name:n,components:{local_transform:{position:r,orientation:a,eulerOrientation:d},camera:{renderGraphRef:s,dataJSON:c,renderTargetIndex:l},perspective_lens:g,orthographic_lens:m},options:{auto_broadcast:!1,delete_on_client_disconnection:!0}},t);return{isPending:u,cameraEntity:C}}import G,{createContext as be,useContext as te,useEffect as Oe,useRef as Ae,useState as Ie}from"react";import{RenderingSurface as Ve}from"@3dverse/livelink";var D=be({canvas:null,renderingSurface:null});function gn({children:e,contextType:t="2d",contextAttributes:n,width:r,height:o,...i}){let{instance:s}=te(P),{canvas:c}=te(D),[l,p]=Ie(null),a=Ae(null);return Oe(()=>{if(!s||!a.current)return;let d=a.current.getBoundingClientRect();if(!d.width||!d.height){console.error(`Canvas element has an invalid size : [${d.width} x ${d.height}] it will not be mounted as a rendering surface.`,a.current);return}let m=new Ve({canvas_element:a.current,context_type:t,context_attributes:n});return p(m),()=>{m.release(),p(null)}},[s,t,n]),G.createElement(D.Provider,{value:{canvas:a.current,renderingSurface:l}},G.createElement("div",{"data-role":"canvas-container",style:Te({parentCanvas:c,width:r,height:o}),...i},G.createElement("canvas",{ref:a,style:{position:"absolute",width:"100%",height:"100%",pointerEvents:"none"}}),e))}function Te({parentCanvas:e,width:t,height:n}){return{...{overflow:"clip"},...!!e?{position:"absolute",width:t,height:n}:{position:"relative",width:t??"100%",height:n??"100%"}}}import ne,{createContext as ze,forwardRef as Ne,useCallback as Ue,useContext as B,useEffect as b,useRef as Fe,useState as X,useImperativeHandle as He}from"react";import*as _ from"@3dverse/livelink";var O=ze({viewport:null,viewportDomElement:null,zIndex:0,camera:null}),bn=Ne(function({setHoveredEntity:e,setPickedEntity:t,renderTargetIndex:n=-1,children:r,...o},i){let{cameraEntity:s,client:c,cameraIndex:l,...p}=o,{instance:a}=B(P),{renderingSurface:d,canvas:m}=B(D),{zIndex:g=0}=B(O),[u,C]=X(null),[x,w]=X(null),[j,T]=X(null),f=Fe(null);He(i,()=>u??void 0,[u]);let k=Ue(()=>{!f.current||!m||!u||(f.current,u.relative_rect=_.RelativeRect.from_dom_elements({element:f.current,parent:m}))},[u,m,f.current]);b(()=>{if(!f.current)return;let v=new ResizeObserver(k);return v.observe(f.current),()=>{v.disconnect()}},[f.current,k]),b(()=>{if(d)return d.addEventListener("on-rendering-surface-resized",k),()=>{d.removeEventListener("on-rendering-surface-resized",k)}},[d,k]);let L=g+1;return b(()=>{if(!(!a||!d||!m||!f.current))try{let v=_.RelativeRect.from_dom_elements({element:f.current,parent:m}),E=new _.Viewport({core:a,rendering_surface:d,options:{rect:v,z_index:L,render_target_index:n,dom_element:f.current}});return E.width,E.height,a.addViewports({viewports:[E]}),C(E),()=>{a.removeViewport({viewport:E}),E.release(),C(null)}}catch(v){v instanceof _.OutOfBoundsError?console.error("A viewport MUST be contained into its parent Canvas bounds",f.current,m):v instanceof _.InvalidSizeError?console.error(`Viewport element has an invalid size : [${v.rect.width} x ${v.rect.height}].`,m):console.error("Failed to mount viewport",f.current,v)}},[a,d,m,L]),b(()=>{c?c.getCameraEntities().then(v=>{w(v[l??0])}):w(s??null)},[s,c,l]),b(()=>{!u||!x||(u.camera_projection=new _.CameraProjection({camera_entity:x,viewport:u}),T(u.camera_projection))},[u,x]),b(()=>{if(!u)return;let v=h=>t?.(h.picked_entity&&h.ws_position&&h.ws_normal?{entity:h.picked_entity,ws_position:h.ws_position,ws_normal:h.ws_normal}:null);t&&(u.activatePicking(),u.addEventListener("on-entity-picked",v));let E=h=>e?.(h.hovered_entity&&h.ws_position&&h.ws_normal?{entity:h.hovered_entity,ws_position:h.ws_position,ws_normal:h.ws_normal}:null);return e&&(u.activateHovering(),u.addEventListener("on-entity-hovered",E)),()=>{t&&(u.removeEventListener("on-entity-picked",v),u.deactivatePicking()),e&&(u.removeEventListener("on-entity-hovered",E),u.deactivateHovering())}},[u,t,e]),ne.createElement(O.Provider,{value:{viewport:u,viewportDomElement:f.current,zIndex:L,camera:j}},ne.createElement("div",{ref:f,"data-role":"viewport",...p},r))});import We,{createContext as je,forwardRef as Je,useContext as qe,useEffect as Ge,useImperativeHandle as Be,useState as Xe}from"react";import{CameraController as $e,CameraControllerPresets as Ke}from"@3dverse/livelink";var Ye=je({cameraController:void 0}),Un=Je(function({preset:t=Ke.orbital,children:n},r){let{viewport:o,camera:i}=qe(O),[s,c]=Xe(void 0);return Be(r,()=>s,[s]),Ge(()=>{if(!o||!i)return;let l=new $e({camera_entity:i.camera_entity,viewport:o,preset:t});return c(l),()=>{l.release(),c(void 0)}},[o,i,t]),We.createElement(Ye.Provider,{value:{cameraController:s}},n)});import re,{useContext as Qe,useEffect as oe,useMemo as Ze,useState as ie}from"react";function Jn({fileOptions:e={description:"Video recording",accept:{"video/webm":[".webm"]}},recorderOptions:t={mimeType:'video/webm; codecs="vp8"',videoBitsPerSecond:1e7},streamOptions:n={frameRequestRate:30},children:r}){let{renderingSurface:o}=Qe(D),[i,s]=ie(0),[c,l]=ie(!1),p=Ze(()=>{if(!o)return null;let a=o.canvas.captureStream(n.frameRequestRate);return new MediaRecorder(a,t)},[o]);return oe(()=>{if(p)return window.showSaveFilePicker({types:[e]}).then(async a=>{let d=await a.createWritable();p.ondataavailable=m=>{m.data.size>0&&d.write(m.data)},p.onstop=()=>{d.close()},p.start(),l(!0)}),()=>{p.stop()}},[p]),oe(()=>{if(!c)return;let a=setInterval(()=>{s(d=>d+1)},1e3);return()=>clearInterval(a)},[c]),re.createElement(re.Fragment,null,r?r({recordTime:i}):null)}import{CameraController as Or}from"@3dverse/livelink";import he,{createContext as Wt,useContext as jt,useEffect as Jt,useRef as qt,useState as Gt}from"react";import H from"react";import{createPortal as Ft}from"react-dom";var U=1e-6,V=typeof Float32Array<"u"?Float32Array:Array,$=Math.random;var Gn=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var F={};Ce(F,{add:()=>it,angle:()=>Rt,bezier:()=>Et,ceil:()=>st,clone:()=>tt,copy:()=>rt,create:()=>se,cross:()=>ht,dist:()=>Vt,distance:()=>de,div:()=>It,divide:()=>pe,dot:()=>ve,equals:()=>bt,exactEquals:()=>Dt,floor:()=>at,forEach:()=>Ut,fromValues:()=>nt,hermite:()=>xt,inverse:()=>vt,len:()=>zt,length:()=>ae,lerp:()=>yt,max:()=>lt,min:()=>ct,mul:()=>At,multiply:()=>le,negate:()=>ut,normalize:()=>ft,random:()=>Ct,rotateX:()=>Lt,rotateY:()=>Pt,rotateZ:()=>Mt,round:()=>pt,scale:()=>dt,scaleAndAdd:()=>mt,set:()=>ot,sqrDist:()=>Tt,sqrLen:()=>Nt,squaredDistance:()=>me,squaredLength:()=>ue,str:()=>kt,sub:()=>Ot,subtract:()=>ce,transformMat3:()=>gt,transformMat4:()=>_t,transformQuat:()=>wt,zero:()=>St});function se(){var e=new V(3);return V!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function tt(e){var t=new V(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ae(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function nt(e,t,n){var r=new V(3);return r[0]=e,r[1]=t,r[2]=n,r}function rt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ot(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function it(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function ce(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function le(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function pe(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function st(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function at(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function ct(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function lt(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function pt(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function dt(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function mt(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function de(e,t){var n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return Math.hypot(n,r,o)}function me(e,t){var n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return n*n+r*r+o*o}function ue(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function ut(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function vt(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function ft(e,t){var n=t[0],r=t[1],o=t[2],i=n*n+r*r+o*o;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function ve(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ht(e,t,n){var r=t[0],o=t[1],i=t[2],s=n[0],c=n[1],l=n[2];return e[0]=o*l-i*c,e[1]=i*s-r*l,e[2]=r*c-o*s,e}function yt(e,t,n,r){var o=t[0],i=t[1],s=t[2];return e[0]=o+r*(n[0]-o),e[1]=i+r*(n[1]-i),e[2]=s+r*(n[2]-s),e}function xt(e,t,n,r,o,i){var s=i*i,c=s*(2*i-3)+1,l=s*(i-2)+i,p=s*(i-1),a=s*(3-2*i);return e[0]=t[0]*c+n[0]*l+r[0]*p+o[0]*a,e[1]=t[1]*c+n[1]*l+r[1]*p+o[1]*a,e[2]=t[2]*c+n[2]*l+r[2]*p+o[2]*a,e}function Et(e,t,n,r,o,i){var s=1-i,c=s*s,l=i*i,p=c*s,a=3*i*c,d=3*l*s,m=l*i;return e[0]=t[0]*p+n[0]*a+r[0]*d+o[0]*m,e[1]=t[1]*p+n[1]*a+r[1]*d+o[1]*m,e[2]=t[2]*p+n[2]*a+r[2]*d+o[2]*m,e}function Ct(e,t){t=t||1;var n=$()*2*Math.PI,r=$()*2-1,o=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*o,e[1]=Math.sin(n)*o,e[2]=r*t,e}function _t(e,t,n){var r=t[0],o=t[1],i=t[2],s=n[3]*r+n[7]*o+n[11]*i+n[15];return s=s||1,e[0]=(n[0]*r+n[4]*o+n[8]*i+n[12])/s,e[1]=(n[1]*r+n[5]*o+n[9]*i+n[13])/s,e[2]=(n[2]*r+n[6]*o+n[10]*i+n[14])/s,e}function gt(e,t,n){var r=t[0],o=t[1],i=t[2];return e[0]=r*n[0]+o*n[3]+i*n[6],e[1]=r*n[1]+o*n[4]+i*n[7],e[2]=r*n[2]+o*n[5]+i*n[8],e}function wt(e,t,n){var r=n[0],o=n[1],i=n[2],s=n[3],c=t[0],l=t[1],p=t[2],a=o*p-i*l,d=i*c-r*p,m=r*l-o*c,g=o*m-i*d,u=i*a-r*m,C=r*d-o*a,x=s*2;return a*=x,d*=x,m*=x,g*=2,u*=2,C*=2,e[0]=c+a+g,e[1]=l+d+u,e[2]=p+m+C,e}function Lt(e,t,n,r){var o=[],i=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],i[0]=o[0],i[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),i[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Pt(e,t,n,r){var o=[],i=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],i[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),i[1]=o[1],i[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Mt(e,t,n,r){var o=[],i=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],i[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),i[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),i[2]=o[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Rt(e,t){var n=e[0],r=e[1],o=e[2],i=t[0],s=t[1],c=t[2],l=Math.sqrt(n*n+r*r+o*o),p=Math.sqrt(i*i+s*s+c*c),a=l*p,d=a&&ve(e,t)/a;return Math.acos(Math.min(Math.max(d,-1),1))}function St(e){return e[0]=0,e[1]=0,e[2]=0,e}function kt(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Dt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function bt(e,t){var n=e[0],r=e[1],o=e[2],i=t[0],s=t[1],c=t[2];return Math.abs(n-i)<=U*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-s)<=U*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-c)<=U*Math.max(1,Math.abs(o),Math.abs(c))}var Ot=ce,At=le,It=pe,Vt=de,Tt=me,zt=ae,Nt=ue,Ut=function(){var e=se();return function(t,n,r,o,i,s){var c,l;for(n||(n=3),r||(r=0),o?l=Math.min(o*n+r,t.length):l=t.length,c=r;c<l;c+=n)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],i(e,e,s),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2];return t}}();function fe(e){return t=>H.createElement(K,{overlay:e,...t})}var K=class e extends H.Component{static VerticalAnchorPositions={top:0,center:-50,bottom:-100};static HorizontalAnchorPositions={left:0,center:-50,right:-100};state={screen_position:F.create(),z_index:0,scale:1,is_visible:!1,translation:[0,0]};componentDidMount(){this.#e(),this.props.overlay._registerElement(this)}componentDidUpdate(t){(t.worldPosition.some((n,r)=>n!==this.props.worldPosition[r])||t.anchor!==this.props.anchor||t.scaleFactor!==this.props.scaleFactor)&&(this.#e(),this.props.overlay._updateElement())}componentWillUnmount(){this.props.overlay._unregisterElement(this)}get screen_position(){return this.state.screen_position}get world_position(){return this.props.worldPosition}get scale_factor(){return this.props.scaleFactor}setProjection(t){this.setState(t)}#e(){if(this.props.anchor==="center"){this.setState({translation:[e.HorizontalAnchorPositions.center,e.VerticalAnchorPositions.center]});return}let[t,n]=this.props.anchor.split("-");this.setState({translation:[e.HorizontalAnchorPositions[t],e.VerticalAnchorPositions[n]]})}render(){if(!this.state.is_visible)return null;let t=`
            translate(${this.state.translation[0]}%, ${this.state.translation[1]}%)
            translate(${this.state.screen_position[0]}px, ${this.state.screen_position[1]}px)`;return Ft(H.createElement("div",{style:{position:"absolute",transform:t,zIndex:this.state.z_index,pointerEvents:"auto"}},this.scale_factor?H.createElement("div",{style:{transform:`scale(${this.state.scale})`}},this.props.children):this.props.children),this.props.overlay.container)}};var Ht=1e5,W=class{container;#e=new Set;#t;#n;constructor({container:t,viewport:n}){this.container=t,this.#t=n,this.#n=fe(this)}get DOM3DElement(){return this.#n}_registerElement(t){this.#e.add(t),this.#t.rendering_surface.redrawLastFrame()}_unregisterElement(t){this.#e.delete(t)||console.warn("Element ref not found in dom overlay")}_updateElement(){this.#t.rendering_surface.redrawLastFrame()}resize({width:t,height:n}){this.container.style.width=t+"px",this.container.style.height=n+"px"}draw(){return this.#t.isValid()&&this.updateElements(),null}updateElements(){let t=[];for(let n of this.#e.values()){let r=this.#r({react_element:n});t.push({projection:r,react_element:n})}t.sort((n,r)=>r.projection.screen_position[2]-n.projection.screen_position[2]),t.forEach(({projection:n,react_element:r},o)=>{r.setProjection({...n,z_index:o})})}#r({react_element:t}){let n=this.#t.projectWorldToScreen({world_position:t.world_position,out_screen_position:t.screen_position}),r=t.scale_factor?this.#o({screen_position:n,scale_factor:t.scale_factor}):1,o=n[2]<1&&n[2]>0;return{screen_position:n,scale:r,is_visible:o}}#o({screen_position:t,scale_factor:n}){let r=this.#t.camera_projection?.camera_entity;if(!r)throw new Error("Viewport has no camera");let o=(r.perspective_lens?r.perspective_lens.nearPlane:r.orthographic_lens?.zFar)??0;return(((r.perspective_lens?r.perspective_lens.farPlane||Ht:r.orthographic_lens?.zNear)??1)-o)*(1-t[2])*n}release(){setTimeout(()=>{this.#e.clear()},0)}};var Y=Wt(null);function pr({children:e,...t}){let n=qt(null),[r,o]=Gt(null),{viewport:i}=jt(O);return Jt(()=>{if(!i||!n.current)return;let s=new W({container:n.current,viewport:i});return i.addOverlay({overlay:s}),o(s),()=>{i.removeOverlay({overlay:s})}},[i,n]),he.createElement(Y.Provider,{value:r},he.createElement("div",{ref:n,"data-role":"dom-3d-overlay",style:{position:"absolute",width:"100%",height:"100%",top:"0",pointerEvents:"none",padding:"inherit",overflow:"hidden"},...t},e))}import Bt,{useContext as Xt}from"react";function ye({worldPosition:e,anchor:t="center",scaleFactor:n,children:r}){let o=Xt(Y);return o?Bt.createElement(o.DOM3DElement,{worldPosition:e,anchor:t,scaleFactor:n},r):null}import $t,{useEffect as Kt,useState as xe}from"react";function Cr({entity:e,scaleFactor:t,anchor:n,children:r}){let[o,i]=xe(e?e.global_transform.position:[0,0,0]),[s,c]=xe(e?e.is_visible:!1);return Kt(()=>{if(!e)return;let l=()=>i(e.global_transform.position),p=()=>c(e.is_visible);return l(),p(),e.addEventListener("on-entity-updated",l),e.addEventListener("on-entity-visibility-changed",p),()=>{e.removeEventListener("on-entity-updated",l),e.removeEventListener("on-entity-visibility-changed",p)}},[e]),!e||!s?null:$t.createElement(ye,{worldPosition:o,anchor:n,scaleFactor:t},r)}typeof window<"u"&&(window.__LIVELINK__||(window.__LIVELINK__={}),Object.prototype.hasOwnProperty.call(window.__LIVELINK__,"@3dverse/livelink-react")?console.warn("\u26A0\uFE0F WARNING \u26A0\uFE0F Multiple instances of Livelink React \u269B\uFE0F being imported."):window.__LIVELINK__["@3dverse/livelink-react"]="0.2.47");export{Un as CameraController,Ye as CameraControllerContext,gn as Canvas,D as CanvasContext,ye as DOM3DElement,pr as DOM3DOverlay,Cr as DOMEntity,Or as DefaultCameraController,nn as Livelink,P as LivelinkContext,nn as LivelinkProvider,Y as OverlayContext,K as React3DElement,W as ReactOverlay,Jn as Recorder,bn as Viewport,O as ViewportContext,fe as createReact3DElementFactory,un as useCameraEntity,pn as useClients,ee as useEntity};
//# sourceMappingURL=index.mjs.map
