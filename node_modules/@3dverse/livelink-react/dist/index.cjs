"use strict";var ge=Object.create;var X=Object.defineProperty;var we=Object.getOwnPropertyDescriptor;var Le=Object.getOwnPropertyNames;var Pe=Object.getPrototypeOf,Me=Object.prototype.hasOwnProperty;var ae=(e,t)=>{for(var n in t)X(e,n,{get:t[n],enumerable:!0})},ce=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Le(t))!Me.call(e,o)&&o!==n&&X(e,o,{get:()=>t[o],enumerable:!(r=we(t,o))||r.enumerable});return e};var R=(e,t,n)=>(n=e!=null?ge(Pe(e)):{},ce(t||!e||!e.__esModule?X(n,"default",{value:e,enumerable:!0}):n,e)),Re=e=>ce(X({},"__esModule",{value:!0}),e);var Rt={};ae(Rt,{CameraController:()=>Te,CameraControllerContext:()=>pe,Canvas:()=>Ae,CanvasContext:()=>N,DOM3DElement:()=>se,DOM3DOverlay:()=>Pt,DOMEntity:()=>Mt,DefaultCameraController:()=>_e.CameraController,Livelink:()=>Se,LivelinkContext:()=>D,LivelinkProvider:()=>Se,OverlayContext:()=>Z,React3DElement:()=>Q,ReactOverlay:()=>G,Recorder:()=>ze,Viewport:()=>Ve,ViewportContext:()=>U,createReact3DElementFactory:()=>ie,useCameraEntity:()=>Oe,useClients:()=>De,useEntity:()=>re});module.exports=Re(Rt);var S=require("react");var f=R(require("react")),T=R(require("@3dverse/livelink")),j=require("@3dverse/livelink"),D=(0,f.createContext)({instance:null,isConnecting:!1,isDisconnected:!1,disconnect:()=>{}});function Se({sceneId:e,sessionId:t,isTransient:n,token:r,LoadingPanel:o,InactivityWarningPanel:i,ConnectionErrorPanel:s,autoJoinExisting:a=!0,clientType:l,children:p}){let[c,d]=(0,f.useState)(null),[m,k]=(0,f.useState)(!0),[u,M]=(0,f.useState)(!1),[L,O]=(0,f.useState)(null),[te,B]=(0,f.useState)("Unknown error"),y=(0,f.useRef)(new Map),z=(0,f.useCallback)(()=>c?.disconnect(),[c]);return(0,f.useEffect)(()=>{let A=async({autoJoinExisting:E,sceneId:I,sessionId:V,clientType:ne})=>{if(V){let W=await T.Session.findById({session_id:V,token:r});if(!W)throw new Error(`Session '${V}' not found on scene '${I}'`);return j.Livelink.join({session:W})}if(I)return E?j.Livelink.join_or_start({scene_id:I,token:r,is_transient:n}):j.Livelink.start({scene_id:I,token:r,is_transient:n});if(ne==="guest"){let W=await T.Session.findByGuestToken({guest_token:r});if(!W)throw new Error(`No session available for guest token '${r}'`);return j.Livelink.join({session:W})}throw new Error("What are we doing here?!")},h=E=>{let I=ke(E),V=y.current.get(I);return V||(V=A(E).then(ne=>(y.current.delete(I),ne)),y.current.set(I,V)),V},P=new AbortController,x=()=>{O(null)};return h({autoJoinExisting:a,sceneId:e,sessionId:t,token:r,clientType:l}).then(E=>{P.signal.aborted||(be(E),d(E),E.TO_REMOVE__setReadyCallback(async()=>{E.startStreaming(),k(!1)}),E.session.addEventListener("on-inactivity-warning",O),E.session.addEventListener("on-activity-detected",x))}).catch(E=>{k(!1),M(!0),B(E)}),()=>{P.abort(),c?.session.removeEventListener("on-inactivity-warning",O),c?.session.removeEventListener("on-activity-detected",x),d(null),k(!0),M(!1),O(null)}},[r,a,e,t,n,l]),(0,f.useEffect)(()=>{if(!c)return;let A=h=>{M(!0),O(null),B(h.reason)};return c.session.addEventListener("on-disconnected",A),()=>{c.session.removeEventListener("on-disconnected",A)}},[c]),(0,f.useEffect)(()=>()=>{c?.disconnect()},[c]),f.default.createElement(D.Provider,{value:{instance:c,isConnecting:m,isDisconnected:u,disconnect:z}},m&&o&&f.default.createElement(o,{stage:""}),u&&s&&f.default.createElement(s,{error:te}),L&&i&&f.default.createElement(i,{warningDuration:L.seconds_remaining,onActivityDetected:()=>{L.resetTimer(),O(null)}}),p)}function be(e){let t=async()=>{e.session.removeEventListener("TO_REMOVE__viewports-added",t);let n=await T.WebCodecsDecoder.findSupportedCodec();await e.configureRemoteServer({codec:n||void 0}),await e.setEncodedFrameConsumer({encoded_frame_consumer:n!==null?new T.WebCodecsDecoder({decoded_frame_consumer:e.default_decoded_frame_consumer}):new T.SoftwareDecoder({decoded_frame_consumer:e.default_decoded_frame_consumer})}),e.TO_REMOVE__startIfReady()};e.session.addEventListener("TO_REMOVE__viewports-added",t)}function ke(e){return JSON.stringify(e)}function re(e,t=[]){let{instance:n}=(0,S.useContext)(D),[r,o]=(0,S.useState)(null),[i,s]=(0,S.useState)(!0),[,a]=(0,S.useReducer)(p=>p+1,0),l=e;return(0,S.useEffect)(()=>n?((async()=>"components"in e?await n.scene.newEntity(e):"linkage"in l?await n.scene.findEntity({entity_uuid:l.euid,linkage:l.linkage}):"euid"in l?(await n.scene.findEntities({entity_uuid:l.euid}))[0]:"name"in l&&l.name?(await n.scene.findEntitiesByNames({entity_names:[l.name]}))[0]:"mandatory_components"in l?(await n.scene.findEntitiesWithComponents({mandatory_components:l.mandatory_components,forbidden_components:l.forbidden_components}))[0]:null)().then(c=>o(c)).finally(()=>s(!1)),()=>{o(null),s(!0)}):void 0,[n,JSON.stringify(l)]),(0,S.useEffect)(()=>{let p=t==="any",c=t.length===0;if(!r||c)return;let d=p?a:m=>{m.isAnyComponentDirty({components:t})&&a()};return r.addEventListener("on-entity-updated",d),()=>{r.removeEventListener("on-entity-updated",d)}},[r,t]),(0,S.useEffect)(()=>{if(r)return r.addEventListener("on-entity-visibility-changed",a),()=>{r.removeEventListener("on-entity-visibility-changed",a)}},[r]),{isPending:i,entity:r}}var H=require("react");function De(){let{instance:e}=(0,H.useContext)(D),[t,n]=(0,H.useState)([]);return(0,H.useEffect)(()=>{if(!e)return;let r=()=>n(e.session.other_clients);return e.session.addEventListener("on-client-joined",r),e.session.addEventListener("on-client-left",r),r(),()=>{e.session.removeEventListener("on-client-joined",r),e.session.removeEventListener("on-client-left",r),n([])}},[e]),{clients:t}}function Oe(e={},t=[]){let{name:n="Camera",position:r=[0,1,5],orientation:o=[0,0,0,1],eulerOrientation:i=[0,0,0],renderGraphRef:s="398ee642-030a-45e7-95df-7147f6c43392",settings:a={grid:!0,skybox:!1,gradient:!0},renderTargetIndex:l=-1,perspective_lens:p={fovy:60,nearPlane:.1,farPlane:1e4}}=e,c="orientation"in e?o:void 0,d=!c&&"eulerOrientation"in e?i:void 0,m="orthographic_lens"in e?e.orthographic_lens:void 0,k=m?void 0:p,{isPending:u,entity:M}=re({name:n,components:{local_transform:{position:r,orientation:c,eulerOrientation:d},camera:{renderGraphRef:s,dataJSON:a,renderTargetIndex:l},perspective_lens:k,orthographic_lens:m},options:{auto_broadcast:!1,delete_on_client_disconnection:!0}},t);return{isPending:u,cameraEntity:M}}var C=R(require("react")),le=require("@3dverse/livelink");var N=(0,C.createContext)({canvas:null,renderingSurface:null});function Ae({children:e,contextType:t="2d",contextAttributes:n,width:r,height:o,...i}){let{instance:s}=(0,C.useContext)(D),{canvas:a}=(0,C.useContext)(N),[l,p]=(0,C.useState)(null),c=(0,C.useRef)(null);return(0,C.useEffect)(()=>{if(!s||!c.current)return;let d=c.current.getBoundingClientRect();if(!d.width||!d.height){console.error(`Canvas element has an invalid size : [${d.width} x ${d.height}] it will not be mounted as a rendering surface.`,c.current);return}let m=new le.RenderingSurface({canvas_element:c.current,context_type:t,context_attributes:n});return p(m),()=>{m.release(),p(null)}},[s,t,n]),C.default.createElement(N.Provider,{value:{canvas:c.current,renderingSurface:l}},C.default.createElement("div",{"data-role":"canvas-container",style:Ie({parentCanvas:a,width:r,height:o}),...i},C.default.createElement("canvas",{ref:c,style:{position:"absolute",width:"100%",height:"100%",pointerEvents:"none"}}),e))}function Ie({parentCanvas:e,width:t,height:n}){return{...{overflow:"clip"},...!!e?{position:"absolute",width:t,height:n}:{position:"relative",width:t??"100%",height:n??"100%"}}}var v=R(require("react")),b=R(require("@3dverse/livelink"));var U=(0,v.createContext)({viewport:null,viewportDomElement:null,zIndex:0,camera:null}),Ve=(0,v.forwardRef)(function({setHoveredEntity:e,setPickedEntity:t,renderTargetIndex:n=-1,children:r,...o},i){let{cameraEntity:s,client:a,cameraIndex:l,...p}=o,{instance:c}=(0,v.useContext)(D),{renderingSurface:d,canvas:m}=(0,v.useContext)(N),{zIndex:k=0}=(0,v.useContext)(U),[u,M]=(0,v.useState)(null),[L,O]=(0,v.useState)(null),[te,B]=(0,v.useState)(null),y=(0,v.useRef)(null);(0,v.useImperativeHandle)(i,()=>u??void 0,[u]);let z=(0,v.useCallback)(()=>{!y.current||!m||!u||(y.current,u.relative_rect=b.RelativeRect.from_dom_elements({element:y.current,parent:m}))},[u,m,y.current]);(0,v.useEffect)(()=>{if(!y.current)return;let h=new ResizeObserver(z);return h.observe(y.current),()=>{h.disconnect()}},[y.current,z]),(0,v.useEffect)(()=>{if(d)return d.addEventListener("on-rendering-surface-resized",z),()=>{d.removeEventListener("on-rendering-surface-resized",z)}},[d,z]);let A=k+1;return(0,v.useEffect)(()=>{if(!(!c||!d||!m||!y.current))try{let h=b.RelativeRect.from_dom_elements({element:y.current,parent:m}),P=new b.Viewport({core:c,rendering_surface:d,options:{rect:h,z_index:A,render_target_index:n,dom_element:y.current}});return P.width,P.height,c.addViewports({viewports:[P]}),M(P),()=>{c.removeViewport({viewport:P}),P.release(),M(null)}}catch(h){h instanceof b.OutOfBoundsError?console.error("A viewport MUST be contained into its parent Canvas bounds",y.current,m):h instanceof b.InvalidSizeError?console.error(`Viewport element has an invalid size : [${h.rect.width} x ${h.rect.height}].`,m):console.error("Failed to mount viewport",y.current,h)}},[c,d,m,A]),(0,v.useEffect)(()=>{a?a.getCameraEntities().then(h=>{O(h[l??0])}):O(s??null)},[s,a,l]),(0,v.useEffect)(()=>{!u||!L||(u.camera_projection=new b.CameraProjection({camera_entity:L,viewport:u}),B(u.camera_projection))},[u,L]),(0,v.useEffect)(()=>{if(!u)return;let h=x=>t?.(x.picked_entity&&x.ws_position&&x.ws_normal?{entity:x.picked_entity,ws_position:x.ws_position,ws_normal:x.ws_normal}:null);t&&(u.activatePicking(),u.addEventListener("on-entity-picked",h));let P=x=>e?.(x.hovered_entity&&x.ws_position&&x.ws_normal?{entity:x.hovered_entity,ws_position:x.ws_position,ws_normal:x.ws_normal}:null);return e&&(u.activateHovering(),u.addEventListener("on-entity-hovered",P)),()=>{t&&(u.removeEventListener("on-entity-picked",h),u.deactivatePicking()),e&&(u.removeEventListener("on-entity-hovered",P),u.deactivateHovering())}},[u,t,e]),v.default.createElement(U.Provider,{value:{viewport:u,viewportDomElement:y.current,zIndex:A,camera:te}},v.default.createElement("div",{ref:y,"data-role":"viewport",...p},r))});var _=R(require("react")),$=require("@3dverse/livelink");var pe=(0,_.createContext)({cameraController:void 0}),Te=(0,_.forwardRef)(function({preset:t=$.CameraControllerPresets.orbital,children:n},r){let{viewport:o,camera:i}=(0,_.useContext)(U),[s,a]=(0,_.useState)(void 0);return(0,_.useImperativeHandle)(r,()=>s,[s]),(0,_.useEffect)(()=>{if(!o||!i)return;let l=new $.CameraController({camera_entity:i.camera_entity,viewport:o,preset:t});return a(l),()=>{l.release(),a(void 0)}},[o,i,t]),_.default.createElement(pe.Provider,{value:{cameraController:s}},n)});var g=R(require("react"));function ze({fileOptions:e={description:"Video recording",accept:{"video/webm":[".webm"]}},recorderOptions:t={mimeType:'video/webm; codecs="vp8"',videoBitsPerSecond:1e7},streamOptions:n={frameRequestRate:30},children:r}){let{renderingSurface:o}=(0,g.useContext)(N),[i,s]=(0,g.useState)(0),[a,l]=(0,g.useState)(!1),p=(0,g.useMemo)(()=>{if(!o)return null;let c=o.canvas.captureStream(n.frameRequestRate);return new MediaRecorder(c,t)},[o]);return(0,g.useEffect)(()=>{if(p)return window.showSaveFilePicker({types:[e]}).then(async c=>{let d=await c.createWritable();p.ondataavailable=m=>{m.data.size>0&&d.write(m.data)},p.onstop=()=>{d.close()},p.start(),l(!0)}),()=>{p.stop()}},[p]),(0,g.useEffect)(()=>{if(!a)return;let c=setInterval(()=>{s(d=>d+1)},1e3);return()=>clearInterval(c)},[a]),g.default.createElement(g.default.Fragment,null,r?r({recordTime:i}):null)}var _e=require("@3dverse/livelink");var w=R(require("react"));var q=R(require("react")),Ce=require("react-dom");var K=1e-6,J=typeof Float32Array<"u"?Float32Array:Array,oe=Math.random;var sn=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Y={};ae(Y,{add:()=>je,angle:()=>dt,bezier:()=>rt,ceil:()=>Je,clone:()=>Ue,copy:()=>He,create:()=>de,cross:()=>et,dist:()=>Et,distance:()=>he,div:()=>xt,divide:()=>fe,dot:()=>Ee,equals:()=>ft,exactEquals:()=>vt,floor:()=>qe,forEach:()=>wt,fromValues:()=>Fe,hermite:()=>nt,inverse:()=>Qe,len:()=>_t,length:()=>me,lerp:()=>tt,max:()=>Be,min:()=>Ge,mul:()=>yt,multiply:()=>ve,negate:()=>Ye,normalize:()=>Ze,random:()=>ot,rotateX:()=>ct,rotateY:()=>lt,rotateZ:()=>pt,round:()=>Xe,scale:()=>$e,scaleAndAdd:()=>Ke,set:()=>We,sqrDist:()=>Ct,sqrLen:()=>gt,squaredDistance:()=>ye,squaredLength:()=>xe,str:()=>ut,sub:()=>ht,subtract:()=>ue,transformMat3:()=>st,transformMat4:()=>it,transformQuat:()=>at,zero:()=>mt});function de(){var e=new J(3);return J!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ue(e){var t=new J(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function me(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function Fe(e,t,n){var r=new J(3);return r[0]=e,r[1]=t,r[2]=n,r}function He(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function We(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function je(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function ue(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function ve(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function fe(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function Je(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function qe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Ge(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function Be(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function Xe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function $e(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Ke(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function he(e,t){var n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return Math.hypot(n,r,o)}function ye(e,t){var n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return n*n+r*r+o*o}function xe(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function Ye(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Qe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Ze(e,t){var n=t[0],r=t[1],o=t[2],i=n*n+r*r+o*o;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Ee(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function et(e,t,n){var r=t[0],o=t[1],i=t[2],s=n[0],a=n[1],l=n[2];return e[0]=o*l-i*a,e[1]=i*s-r*l,e[2]=r*a-o*s,e}function tt(e,t,n,r){var o=t[0],i=t[1],s=t[2];return e[0]=o+r*(n[0]-o),e[1]=i+r*(n[1]-i),e[2]=s+r*(n[2]-s),e}function nt(e,t,n,r,o,i){var s=i*i,a=s*(2*i-3)+1,l=s*(i-2)+i,p=s*(i-1),c=s*(3-2*i);return e[0]=t[0]*a+n[0]*l+r[0]*p+o[0]*c,e[1]=t[1]*a+n[1]*l+r[1]*p+o[1]*c,e[2]=t[2]*a+n[2]*l+r[2]*p+o[2]*c,e}function rt(e,t,n,r,o,i){var s=1-i,a=s*s,l=i*i,p=a*s,c=3*i*a,d=3*l*s,m=l*i;return e[0]=t[0]*p+n[0]*c+r[0]*d+o[0]*m,e[1]=t[1]*p+n[1]*c+r[1]*d+o[1]*m,e[2]=t[2]*p+n[2]*c+r[2]*d+o[2]*m,e}function ot(e,t){t=t||1;var n=oe()*2*Math.PI,r=oe()*2-1,o=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*o,e[1]=Math.sin(n)*o,e[2]=r*t,e}function it(e,t,n){var r=t[0],o=t[1],i=t[2],s=n[3]*r+n[7]*o+n[11]*i+n[15];return s=s||1,e[0]=(n[0]*r+n[4]*o+n[8]*i+n[12])/s,e[1]=(n[1]*r+n[5]*o+n[9]*i+n[13])/s,e[2]=(n[2]*r+n[6]*o+n[10]*i+n[14])/s,e}function st(e,t,n){var r=t[0],o=t[1],i=t[2];return e[0]=r*n[0]+o*n[3]+i*n[6],e[1]=r*n[1]+o*n[4]+i*n[7],e[2]=r*n[2]+o*n[5]+i*n[8],e}function at(e,t,n){var r=n[0],o=n[1],i=n[2],s=n[3],a=t[0],l=t[1],p=t[2],c=o*p-i*l,d=i*a-r*p,m=r*l-o*a,k=o*m-i*d,u=i*c-r*m,M=r*d-o*c,L=s*2;return c*=L,d*=L,m*=L,k*=2,u*=2,M*=2,e[0]=a+c+k,e[1]=l+d+u,e[2]=p+m+M,e}function ct(e,t,n,r){var o=[],i=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],i[0]=o[0],i[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),i[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function lt(e,t,n,r){var o=[],i=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],i[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),i[1]=o[1],i[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function pt(e,t,n,r){var o=[],i=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],i[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),i[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),i[2]=o[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function dt(e,t){var n=e[0],r=e[1],o=e[2],i=t[0],s=t[1],a=t[2],l=Math.sqrt(n*n+r*r+o*o),p=Math.sqrt(i*i+s*s+a*a),c=l*p,d=c&&Ee(e,t)/c;return Math.acos(Math.min(Math.max(d,-1),1))}function mt(e){return e[0]=0,e[1]=0,e[2]=0,e}function ut(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function vt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function ft(e,t){var n=e[0],r=e[1],o=e[2],i=t[0],s=t[1],a=t[2];return Math.abs(n-i)<=K*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-s)<=K*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-a)<=K*Math.max(1,Math.abs(o),Math.abs(a))}var ht=ue,yt=ve,xt=fe,Et=he,Ct=ye,_t=me,gt=xe,wt=function(){var e=de();return function(t,n,r,o,i,s){var a,l;for(n||(n=3),r||(r=0),o?l=Math.min(o*n+r,t.length):l=t.length,a=r;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],i(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}();function ie(e){return t=>q.default.createElement(Q,{overlay:e,...t})}var Q=class e extends q.default.Component{static VerticalAnchorPositions={top:0,center:-50,bottom:-100};static HorizontalAnchorPositions={left:0,center:-50,right:-100};state={screen_position:Y.create(),z_index:0,scale:1,is_visible:!1,translation:[0,0]};componentDidMount(){this.#e(),this.props.overlay._registerElement(this)}componentDidUpdate(t){(t.worldPosition.some((n,r)=>n!==this.props.worldPosition[r])||t.anchor!==this.props.anchor||t.scaleFactor!==this.props.scaleFactor)&&(this.#e(),this.props.overlay._updateElement())}componentWillUnmount(){this.props.overlay._unregisterElement(this)}get screen_position(){return this.state.screen_position}get world_position(){return this.props.worldPosition}get scale_factor(){return this.props.scaleFactor}setProjection(t){this.setState(t)}#e(){if(this.props.anchor==="center"){this.setState({translation:[e.HorizontalAnchorPositions.center,e.VerticalAnchorPositions.center]});return}let[t,n]=this.props.anchor.split("-");this.setState({translation:[e.HorizontalAnchorPositions[t],e.VerticalAnchorPositions[n]]})}render(){if(!this.state.is_visible)return null;let t=`
            translate(${this.state.translation[0]}%, ${this.state.translation[1]}%)
            translate(${this.state.screen_position[0]}px, ${this.state.screen_position[1]}px)`;return(0,Ce.createPortal)(q.default.createElement("div",{style:{position:"absolute",transform:t,zIndex:this.state.z_index,pointerEvents:"auto"}},this.scale_factor?q.default.createElement("div",{style:{transform:`scale(${this.state.scale})`}},this.props.children):this.props.children),this.props.overlay.container)}};var Lt=1e5,G=class{container;#e=new Set;#t;#n;constructor({container:t,viewport:n}){this.container=t,this.#t=n,this.#n=ie(this)}get DOM3DElement(){return this.#n}_registerElement(t){this.#e.add(t),this.#t.rendering_surface.redrawLastFrame()}_unregisterElement(t){this.#e.delete(t)||console.warn("Element ref not found in dom overlay")}_updateElement(){this.#t.rendering_surface.redrawLastFrame()}resize({width:t,height:n}){this.container.style.width=t+"px",this.container.style.height=n+"px"}draw(){return this.#t.isValid()&&this.updateElements(),null}updateElements(){let t=[];for(let n of this.#e.values()){let r=this.#r({react_element:n});t.push({projection:r,react_element:n})}t.sort((n,r)=>r.projection.screen_position[2]-n.projection.screen_position[2]),t.forEach(({projection:n,react_element:r},o)=>{r.setProjection({...n,z_index:o})})}#r({react_element:t}){let n=this.#t.projectWorldToScreen({world_position:t.world_position,out_screen_position:t.screen_position}),r=t.scale_factor?this.#o({screen_position:n,scale_factor:t.scale_factor}):1,o=n[2]<1&&n[2]>0;return{screen_position:n,scale:r,is_visible:o}}#o({screen_position:t,scale_factor:n}){let r=this.#t.camera_projection?.camera_entity;if(!r)throw new Error("Viewport has no camera");let o=(r.perspective_lens?r.perspective_lens.nearPlane:r.orthographic_lens?.zFar)??0;return(((r.perspective_lens?r.perspective_lens.farPlane||Lt:r.orthographic_lens?.zNear)??1)-o)*(1-t[2])*n}release(){setTimeout(()=>{this.#e.clear()},0)}};var Z=(0,w.createContext)(null);function Pt({children:e,...t}){let n=(0,w.useRef)(null),[r,o]=(0,w.useState)(null),{viewport:i}=(0,w.useContext)(U);return(0,w.useEffect)(()=>{if(!i||!n.current)return;let s=new G({container:n.current,viewport:i});return i.addOverlay({overlay:s}),o(s),()=>{i.removeOverlay({overlay:s})}},[i,n]),w.default.createElement(Z.Provider,{value:r},w.default.createElement("div",{ref:n,"data-role":"dom-3d-overlay",style:{position:"absolute",width:"100%",height:"100%",top:"0",pointerEvents:"none",padding:"inherit",overflow:"hidden"},...t},e))}var ee=R(require("react"));function se({worldPosition:e,anchor:t="center",scaleFactor:n,children:r}){let o=(0,ee.useContext)(Z);return o?ee.default.createElement(o.DOM3DElement,{worldPosition:e,anchor:t,scaleFactor:n},r):null}var F=R(require("react"));function Mt({entity:e,scaleFactor:t,anchor:n,children:r}){let[o,i]=(0,F.useState)(e?e.global_transform.position:[0,0,0]),[s,a]=(0,F.useState)(e?e.is_visible:!1);return(0,F.useEffect)(()=>{if(!e)return;let l=()=>i(e.global_transform.position),p=()=>a(e.is_visible);return l(),p(),e.addEventListener("on-entity-updated",l),e.addEventListener("on-entity-visibility-changed",p),()=>{e.removeEventListener("on-entity-updated",l),e.removeEventListener("on-entity-visibility-changed",p)}},[e]),!e||!s?null:F.default.createElement(se,{worldPosition:o,anchor:n,scaleFactor:t},r)}typeof window<"u"&&(window.__LIVELINK__||(window.__LIVELINK__={}),Object.prototype.hasOwnProperty.call(window.__LIVELINK__,"@3dverse/livelink-react")?console.warn("\u26A0\uFE0F WARNING \u26A0\uFE0F Multiple instances of Livelink React \u269B\uFE0F being imported."):window.__LIVELINK__["@3dverse/livelink-react"]="0.2.48");
//# sourceMappingURL=index.cjs.map
