import {
  Ct,
  De,
  Ir,
  Pn,
  an,
  as,
  cs,
  dt,
  es,
  on,
  ss,
  ts
} from "./chunk-CAVFLB42.js";
import {
  require_react_dom
} from "./chunk-VJA3Q2RH.js";
import {
  require_react
} from "./chunk-TJE776R7.js";
import {
  __privateAdd,
  __privateGet,
  __privateMethod,
  __privateSet,
  __publicField,
  __toESM
} from "./chunk-WOOG5QLI.js";

// node_modules/@3dverse/livelink-react/dist/index.mjs
var import_react = __toESM(require_react(), 1);
var import_react2 = __toESM(require_react(), 1);
var import_react3 = __toESM(require_react(), 1);
var import_react4 = __toESM(require_react(), 1);
var import_react5 = __toESM(require_react(), 1);
var import_react6 = __toESM(require_react(), 1);
var import_react7 = __toESM(require_react(), 1);
var import_react8 = __toESM(require_react(), 1);
var import_react9 = __toESM(require_react(), 1);
var import_react_dom = __toESM(require_react_dom(), 1);
var import_react10 = __toESM(require_react(), 1);
var import_react11 = __toESM(require_react(), 1);
var Ee = Object.defineProperty;
var Ce = (e, t) => {
  for (var n in t) Ee(e, n, { get: t[n], enumerable: true });
};
var P = (0, import_react2.createContext)({ instance: null, isConnecting: false, isDisconnected: false, disconnect: () => {
} });
function nn({ sceneId: e, sessionId: t, isTransient: n, token: r, LoadingPanel: o, InactivityWarningPanel: i, ConnectionErrorPanel: s, autoJoinExisting: a = true, clientType: l, children: p }) {
  let [c, d] = (0, import_react2.useState)(null), [m, g] = (0, import_react2.useState)(true), [u, C] = (0, import_react2.useState)(false), [x, w] = (0, import_react2.useState)(null), [j, T] = (0, import_react2.useState)("Unknown error"), f = (0, import_react2.useRef)(/* @__PURE__ */ new Map()), b = (0, import_react2.useCallback)(() => c == null ? void 0 : c.disconnect(), [c]);
  return (0, import_react2.useEffect)(() => {
    let L = async ({ autoJoinExisting: y, sceneId: M, sessionId: R, clientType: J }) => {
      if (R) {
        let A = await De.findById({ session_id: R, token: r });
        if (!A) throw new Error(`Session '${R}' not found on scene '${M}'`);
        return Ct.join({ session: A });
      }
      if (M) return y ? Ct.join_or_start({ scene_id: M, token: r, is_transient: n }) : Ct.start({ scene_id: M, token: r, is_transient: n });
      if (J === "guest") {
        let A = await De.findByGuestToken({ guest_token: r });
        if (!A) throw new Error(`No session available for guest token '${r}'`);
        return Ct.join({ session: A });
      }
      throw new Error("What are we doing here?!");
    }, v = (y) => {
      let M = Pe(y), R = f.current.get(M);
      return R || (R = L(y).then((J) => (f.current.delete(M), J)), f.current.set(M, R)), R;
    }, E = new AbortController(), h = () => {
      w(null);
    };
    return v({ autoJoinExisting: a, sceneId: e, sessionId: t, token: r, clientType: l }).then((y) => {
      E.signal.aborted || (Le(y), d(y), y.TO_REMOVE__setReadyCallback(async () => {
        y.startStreaming(), g(false);
      }), y.session.addEventListener("on-inactivity-warning", w), y.session.addEventListener("on-activity-detected", h));
    }).catch((y) => {
      g(false), C(true), T(y);
    }), () => {
      E.abort(), c == null ? void 0 : c.session.removeEventListener("on-inactivity-warning", w), c == null ? void 0 : c.session.removeEventListener("on-activity-detected", h), d(null), g(true), C(false), w(null);
    };
  }, [r, a, e, t, n, l]), (0, import_react2.useEffect)(() => {
    if (!c) return;
    let L = (v) => {
      C(true), w(null), T(v.reason);
    };
    return c.session.addEventListener("on-disconnected", L), () => {
      c.session.removeEventListener("on-disconnected", L);
    };
  }, [c]), (0, import_react2.useEffect)(() => () => {
    c == null ? void 0 : c.disconnect();
  }, [c]), import_react2.default.createElement(P.Provider, { value: { instance: c, isConnecting: m, isDisconnected: u, disconnect: b } }, m && o && import_react2.default.createElement(o, { stage: "" }), u && s && import_react2.default.createElement(s, { error: j }), x && i && import_react2.default.createElement(i, { warningDuration: x.seconds_remaining, onActivityDetected: () => {
    x.resetTimer(), w(null);
  } }), p);
}
function Le(e) {
  let t = async () => {
    e.session.removeEventListener("TO_REMOVE__viewports-added", t);
    let n = await as.findSupportedCodec();
    await e.configureRemoteServer({ codec: n || void 0 }), await e.setEncodedFrameConsumer({ encoded_frame_consumer: n !== null ? new as({ decoded_frame_consumer: e.default_decoded_frame_consumer }) : new ss({ decoded_frame_consumer: e.default_decoded_frame_consumer }) }), e.TO_REMOVE__startIfReady();
  };
  e.session.addEventListener("TO_REMOVE__viewports-added", t);
}
function Pe(e) {
  return JSON.stringify(e);
}
function ee(e, t = []) {
  let { instance: n } = (0, import_react.useContext)(P), [r, o] = (0, import_react.useState)(null), [i, s] = (0, import_react.useState)(true), [, a] = (0, import_react.useReducer)((p) => p + 1, 0), l = e;
  return (0, import_react.useEffect)(() => n ? ((async () => "components" in e ? await n.scene.newEntity(e) : "linkage" in l ? await n.scene.findEntity({ entity_uuid: l.euid, linkage: l.linkage }) : "euid" in l ? (await n.scene.findEntities({ entity_uuid: l.euid }))[0] : "name" in l && l.name ? (await n.scene.findEntitiesByNames({ entity_names: [l.name] }))[0] : "mandatory_components" in l ? (await n.scene.findEntitiesWithComponents({ mandatory_components: l.mandatory_components, forbidden_components: l.forbidden_components }))[0] : null)().then((c) => o(c)).finally(() => s(false)), () => {
    o(null), s(true);
  }) : void 0, [n, JSON.stringify(l)]), (0, import_react.useEffect)(() => {
    let p = t === "any", c = t.length === 0;
    if (!r || c) return;
    let d = p ? a : (m) => {
      m.isAnyComponentDirty({ components: t }) && a();
    };
    return r.addEventListener("on-entity-updated", d), () => {
      r.removeEventListener("on-entity-updated", d);
    };
  }, [r, t]), (0, import_react.useEffect)(() => {
    if (r) return r.addEventListener("on-entity-visibility-changed", a), () => {
      r.removeEventListener("on-entity-visibility-changed", a);
    };
  }, [r]), { isPending: i, entity: r };
}
function pn() {
  let { instance: e } = (0, import_react3.useContext)(P), [t, n] = (0, import_react3.useState)([]);
  return (0, import_react3.useEffect)(() => {
    if (!e) return;
    let r = () => n(e.session.other_clients);
    return e.session.addEventListener("on-client-joined", r), e.session.addEventListener("on-client-left", r), r(), () => {
      e.session.removeEventListener("on-client-joined", r), e.session.removeEventListener("on-client-left", r), n([]);
    };
  }, [e]), { clients: t };
}
function un(e = {}, t = []) {
  let { name: n = "Camera", position: r = [0, 1, 5], orientation: o = [0, 0, 0, 1], eulerOrientation: i = [0, 0, 0], renderGraphRef: s = "398ee642-030a-45e7-95df-7147f6c43392", settings: a = { grid: true, skybox: false, gradient: true }, renderTargetIndex: l = -1, perspective_lens: p = { fovy: 60, nearPlane: 0.1, farPlane: 1e4 } } = e, c = "orientation" in e ? o : void 0, d = !c && "eulerOrientation" in e ? i : void 0, m = "orthographic_lens" in e ? e.orthographic_lens : void 0, g = m ? void 0 : p, { isPending: u, entity: C } = ee({ name: n, components: { local_transform: { position: r, orientation: c, eulerOrientation: d }, camera: { renderGraphRef: s, dataJSON: a, renderTargetIndex: l }, perspective_lens: g, orthographic_lens: m }, options: { auto_broadcast: false, delete_on_client_disconnection: true } }, t);
  return { isPending: u, cameraEntity: C };
}
var k = (0, import_react4.createContext)({ canvas: null, renderingSurface: null });
function gn({ children: e, contextType: t = "2d", contextAttributes: n, width: r, height: o, ...i }) {
  let { instance: s } = (0, import_react4.useContext)(P), { canvas: a } = (0, import_react4.useContext)(k), [l, p] = (0, import_react4.useState)(null), c = (0, import_react4.useRef)(null);
  return (0, import_react4.useEffect)(() => {
    if (!s || !c.current) return;
    let d = c.current.getBoundingClientRect();
    if (!d.width || !d.height) {
      console.error(`Canvas element has an invalid size : [${d.width} x ${d.height}] it will not be mounted as a rendering surface.`, c.current);
      return;
    }
    let m = new cs({ canvas_element: c.current, context_type: t, context_attributes: n });
    return p(m), () => {
      m.release(), p(null);
    };
  }, [s, t, n]), import_react4.default.createElement(k.Provider, { value: { canvas: c.current, renderingSurface: l } }, import_react4.default.createElement("div", { "data-role": "canvas-container", style: Te({ parentCanvas: a, width: r, height: o }), ...i }, import_react4.default.createElement("canvas", { ref: c, style: { position: "absolute", width: "100%", height: "100%", pointerEvents: "none" } }), e));
}
function Te({ parentCanvas: e, width: t, height: n }) {
  return { ...{ overflow: "clip" }, ...!!e ? { position: "absolute", width: t, height: n } : { position: "relative", width: t ?? "100%", height: n ?? "100%" } };
}
var O = (0, import_react5.createContext)({ viewport: null, viewportDomElement: null, zIndex: 0, camera: null });
var Dn = (0, import_react5.forwardRef)(function({ setHoveredEntity: e, setPickedEntity: t, renderTargetIndex: n = -1, children: r, ...o }, i) {
  let { cameraEntity: s, client: a, cameraIndex: l, ...p } = o, { instance: c } = (0, import_react5.useContext)(P), { renderingSurface: d, canvas: m } = (0, import_react5.useContext)(k), { zIndex: g = 0 } = (0, import_react5.useContext)(O), [u, C] = (0, import_react5.useState)(null), [x, w] = (0, import_react5.useState)(null), [j, T] = (0, import_react5.useState)(null), f = (0, import_react5.useRef)(null);
  (0, import_react5.useImperativeHandle)(i, () => u ?? void 0, [u]);
  let b = (0, import_react5.useCallback)(() => {
    !f.current || !m || !u || (f.current, u.relative_rect = dt.from_dom_elements({ element: f.current, parent: m }));
  }, [u, m, f.current]);
  (0, import_react5.useEffect)(() => {
    if (!f.current) return;
    let v = new ResizeObserver(b);
    return v.observe(f.current), () => {
      v.disconnect();
    };
  }, [f.current, b]), (0, import_react5.useEffect)(() => {
    if (d) return d.addEventListener("on-rendering-surface-resized", b), () => {
      d.removeEventListener("on-rendering-surface-resized", b);
    };
  }, [d, b]);
  let L = g + 1;
  return (0, import_react5.useEffect)(() => {
    if (!(!c || !d || !m || !f.current)) try {
      let v = dt.from_dom_elements({ element: f.current, parent: m }), E = new Ir({ core: c, rendering_surface: d, options: { rect: v, z_index: L, render_target_index: n, dom_element: f.current } });
      return E.width, E.height, c.addViewports({ viewports: [E] }), C(E), () => {
        c.removeViewport({ viewport: E }), E.release(), C(null);
      };
    } catch (v) {
      v instanceof an ? console.error("A viewport MUST be contained into its parent Canvas bounds", f.current, m) : v instanceof on ? console.error(`Viewport element has an invalid size : [${v.rect.width} x ${v.rect.height}].`, m) : console.error("Failed to mount viewport", f.current, v);
    }
  }, [c, d, m, L]), (0, import_react5.useEffect)(() => {
    a ? a.getCameraEntities().then((v) => {
      w(v[l ?? 0]);
    }) : w(s ?? null);
  }, [s, a, l]), (0, import_react5.useEffect)(() => {
    !u || !x || (u.camera_projection = new es({ camera_entity: x, viewport: u }), T(u.camera_projection));
  }, [u, x]), (0, import_react5.useEffect)(() => {
    if (!u) return;
    let v = (h) => t == null ? void 0 : t(h.picked_entity && h.ws_position && h.ws_normal ? { entity: h.picked_entity, ws_position: h.ws_position, ws_normal: h.ws_normal } : null);
    t && (u.activatePicking(), u.addEventListener("on-entity-picked", v));
    let E = (h) => e == null ? void 0 : e(h.hovered_entity && h.ws_position && h.ws_normal ? { entity: h.hovered_entity, ws_position: h.ws_position, ws_normal: h.ws_normal } : null);
    return e && (u.activateHovering(), u.addEventListener("on-entity-hovered", E)), () => {
      t && (u.removeEventListener("on-entity-picked", v), u.deactivatePicking()), e && (u.removeEventListener("on-entity-hovered", E), u.deactivateHovering());
    };
  }, [u, t, e]), import_react5.default.createElement(O.Provider, { value: { viewport: u, viewportDomElement: f.current, zIndex: L, camera: j } }, import_react5.default.createElement("div", { ref: f, "data-role": "viewport", ...p }, r));
});
var Ye = (0, import_react6.createContext)({ cameraController: void 0 });
var Un = (0, import_react6.forwardRef)(function({ preset: t = Pn.orbital, children: n }, r) {
  let { viewport: o, camera: i } = (0, import_react6.useContext)(O), [s, a] = (0, import_react6.useState)(void 0);
  return (0, import_react6.useImperativeHandle)(r, () => s, [s]), (0, import_react6.useEffect)(() => {
    if (!o || !i) return;
    let l = new ts({ camera_entity: i.camera_entity, viewport: o, preset: t });
    return a(l), () => {
      l.release(), a(void 0);
    };
  }, [o, i, t]), import_react6.default.createElement(Ye.Provider, { value: { cameraController: s } }, n);
});
function Jn({ fileOptions: e = { description: "Video recording", accept: { "video/webm": [".webm"] } }, recorderOptions: t = { mimeType: 'video/webm; codecs="vp8"', videoBitsPerSecond: 1e7 }, streamOptions: n = { frameRequestRate: 30 }, children: r }) {
  let { renderingSurface: o } = (0, import_react7.useContext)(k), [i, s] = (0, import_react7.useState)(0), [a, l] = (0, import_react7.useState)(false), p = (0, import_react7.useMemo)(() => {
    if (!o) return null;
    let c = o.canvas.captureStream(n.frameRequestRate);
    return new MediaRecorder(c, t);
  }, [o]);
  return (0, import_react7.useEffect)(() => {
    if (p) return window.showSaveFilePicker({ types: [e] }).then(async (c) => {
      let d = await c.createWritable();
      p.ondataavailable = (m) => {
        m.data.size > 0 && d.write(m.data);
      }, p.onstop = () => {
        d.close();
      }, p.start(), l(true);
    }), () => {
      p.stop();
    };
  }, [p]), (0, import_react7.useEffect)(() => {
    if (!a) return;
    let c = setInterval(() => {
      s((d) => d + 1);
    }, 1e3);
    return () => clearInterval(c);
  }, [a]), import_react7.default.createElement(import_react7.default.Fragment, null, r ? r({ recordTime: i }) : null);
}
var U = 1e-6;
var V = typeof Float32Array < "u" ? Float32Array : Array;
var K = Math.random;
var Gn = Math.PI / 180;
Math.hypot || (Math.hypot = function() {
  for (var e = 0, t = arguments.length; t--; ) e += arguments[t] * arguments[t];
  return Math.sqrt(e);
});
var F = {};
Ce(F, { add: () => it, angle: () => Rt, bezier: () => Et, ceil: () => st, clone: () => tt, copy: () => rt, create: () => se, cross: () => ht, dist: () => Vt, distance: () => de, div: () => It, divide: () => pe, dot: () => ve, equals: () => Dt, exactEquals: () => kt, floor: () => at, forEach: () => Ut, fromValues: () => nt, hermite: () => xt, inverse: () => vt, len: () => zt, length: () => ae, lerp: () => yt, max: () => lt, min: () => ct, mul: () => At, multiply: () => le, negate: () => ut, normalize: () => ft, random: () => Ct2, rotateX: () => Lt, rotateY: () => Pt, rotateZ: () => Mt, round: () => pt, scale: () => dt2, scaleAndAdd: () => mt, set: () => ot, sqrDist: () => Tt, sqrLen: () => Nt, squaredDistance: () => me, squaredLength: () => ue, str: () => bt, sub: () => Ot, subtract: () => ce, transformMat3: () => gt, transformMat4: () => _t, transformQuat: () => wt, zero: () => St });
function se() {
  var e = new V(3);
  return V != Float32Array && (e[0] = 0, e[1] = 0, e[2] = 0), e;
}
function tt(e) {
  var t = new V(3);
  return t[0] = e[0], t[1] = e[1], t[2] = e[2], t;
}
function ae(e) {
  var t = e[0], n = e[1], r = e[2];
  return Math.hypot(t, n, r);
}
function nt(e, t, n) {
  var r = new V(3);
  return r[0] = e, r[1] = t, r[2] = n, r;
}
function rt(e, t) {
  return e[0] = t[0], e[1] = t[1], e[2] = t[2], e;
}
function ot(e, t, n, r) {
  return e[0] = t, e[1] = n, e[2] = r, e;
}
function it(e, t, n) {
  return e[0] = t[0] + n[0], e[1] = t[1] + n[1], e[2] = t[2] + n[2], e;
}
function ce(e, t, n) {
  return e[0] = t[0] - n[0], e[1] = t[1] - n[1], e[2] = t[2] - n[2], e;
}
function le(e, t, n) {
  return e[0] = t[0] * n[0], e[1] = t[1] * n[1], e[2] = t[2] * n[2], e;
}
function pe(e, t, n) {
  return e[0] = t[0] / n[0], e[1] = t[1] / n[1], e[2] = t[2] / n[2], e;
}
function st(e, t) {
  return e[0] = Math.ceil(t[0]), e[1] = Math.ceil(t[1]), e[2] = Math.ceil(t[2]), e;
}
function at(e, t) {
  return e[0] = Math.floor(t[0]), e[1] = Math.floor(t[1]), e[2] = Math.floor(t[2]), e;
}
function ct(e, t, n) {
  return e[0] = Math.min(t[0], n[0]), e[1] = Math.min(t[1], n[1]), e[2] = Math.min(t[2], n[2]), e;
}
function lt(e, t, n) {
  return e[0] = Math.max(t[0], n[0]), e[1] = Math.max(t[1], n[1]), e[2] = Math.max(t[2], n[2]), e;
}
function pt(e, t) {
  return e[0] = Math.round(t[0]), e[1] = Math.round(t[1]), e[2] = Math.round(t[2]), e;
}
function dt2(e, t, n) {
  return e[0] = t[0] * n, e[1] = t[1] * n, e[2] = t[2] * n, e;
}
function mt(e, t, n, r) {
  return e[0] = t[0] + n[0] * r, e[1] = t[1] + n[1] * r, e[2] = t[2] + n[2] * r, e;
}
function de(e, t) {
  var n = t[0] - e[0], r = t[1] - e[1], o = t[2] - e[2];
  return Math.hypot(n, r, o);
}
function me(e, t) {
  var n = t[0] - e[0], r = t[1] - e[1], o = t[2] - e[2];
  return n * n + r * r + o * o;
}
function ue(e) {
  var t = e[0], n = e[1], r = e[2];
  return t * t + n * n + r * r;
}
function ut(e, t) {
  return e[0] = -t[0], e[1] = -t[1], e[2] = -t[2], e;
}
function vt(e, t) {
  return e[0] = 1 / t[0], e[1] = 1 / t[1], e[2] = 1 / t[2], e;
}
function ft(e, t) {
  var n = t[0], r = t[1], o = t[2], i = n * n + r * r + o * o;
  return i > 0 && (i = 1 / Math.sqrt(i)), e[0] = t[0] * i, e[1] = t[1] * i, e[2] = t[2] * i, e;
}
function ve(e, t) {
  return e[0] * t[0] + e[1] * t[1] + e[2] * t[2];
}
function ht(e, t, n) {
  var r = t[0], o = t[1], i = t[2], s = n[0], a = n[1], l = n[2];
  return e[0] = o * l - i * a, e[1] = i * s - r * l, e[2] = r * a - o * s, e;
}
function yt(e, t, n, r) {
  var o = t[0], i = t[1], s = t[2];
  return e[0] = o + r * (n[0] - o), e[1] = i + r * (n[1] - i), e[2] = s + r * (n[2] - s), e;
}
function xt(e, t, n, r, o, i) {
  var s = i * i, a = s * (2 * i - 3) + 1, l = s * (i - 2) + i, p = s * (i - 1), c = s * (3 - 2 * i);
  return e[0] = t[0] * a + n[0] * l + r[0] * p + o[0] * c, e[1] = t[1] * a + n[1] * l + r[1] * p + o[1] * c, e[2] = t[2] * a + n[2] * l + r[2] * p + o[2] * c, e;
}
function Et(e, t, n, r, o, i) {
  var s = 1 - i, a = s * s, l = i * i, p = a * s, c = 3 * i * a, d = 3 * l * s, m = l * i;
  return e[0] = t[0] * p + n[0] * c + r[0] * d + o[0] * m, e[1] = t[1] * p + n[1] * c + r[1] * d + o[1] * m, e[2] = t[2] * p + n[2] * c + r[2] * d + o[2] * m, e;
}
function Ct2(e, t) {
  t = t || 1;
  var n = K() * 2 * Math.PI, r = K() * 2 - 1, o = Math.sqrt(1 - r * r) * t;
  return e[0] = Math.cos(n) * o, e[1] = Math.sin(n) * o, e[2] = r * t, e;
}
function _t(e, t, n) {
  var r = t[0], o = t[1], i = t[2], s = n[3] * r + n[7] * o + n[11] * i + n[15];
  return s = s || 1, e[0] = (n[0] * r + n[4] * o + n[8] * i + n[12]) / s, e[1] = (n[1] * r + n[5] * o + n[9] * i + n[13]) / s, e[2] = (n[2] * r + n[6] * o + n[10] * i + n[14]) / s, e;
}
function gt(e, t, n) {
  var r = t[0], o = t[1], i = t[2];
  return e[0] = r * n[0] + o * n[3] + i * n[6], e[1] = r * n[1] + o * n[4] + i * n[7], e[2] = r * n[2] + o * n[5] + i * n[8], e;
}
function wt(e, t, n) {
  var r = n[0], o = n[1], i = n[2], s = n[3], a = t[0], l = t[1], p = t[2], c = o * p - i * l, d = i * a - r * p, m = r * l - o * a, g = o * m - i * d, u = i * c - r * m, C = r * d - o * c, x = s * 2;
  return c *= x, d *= x, m *= x, g *= 2, u *= 2, C *= 2, e[0] = a + c + g, e[1] = l + d + u, e[2] = p + m + C, e;
}
function Lt(e, t, n, r) {
  var o = [], i = [];
  return o[0] = t[0] - n[0], o[1] = t[1] - n[1], o[2] = t[2] - n[2], i[0] = o[0], i[1] = o[1] * Math.cos(r) - o[2] * Math.sin(r), i[2] = o[1] * Math.sin(r) + o[2] * Math.cos(r), e[0] = i[0] + n[0], e[1] = i[1] + n[1], e[2] = i[2] + n[2], e;
}
function Pt(e, t, n, r) {
  var o = [], i = [];
  return o[0] = t[0] - n[0], o[1] = t[1] - n[1], o[2] = t[2] - n[2], i[0] = o[2] * Math.sin(r) + o[0] * Math.cos(r), i[1] = o[1], i[2] = o[2] * Math.cos(r) - o[0] * Math.sin(r), e[0] = i[0] + n[0], e[1] = i[1] + n[1], e[2] = i[2] + n[2], e;
}
function Mt(e, t, n, r) {
  var o = [], i = [];
  return o[0] = t[0] - n[0], o[1] = t[1] - n[1], o[2] = t[2] - n[2], i[0] = o[0] * Math.cos(r) - o[1] * Math.sin(r), i[1] = o[0] * Math.sin(r) + o[1] * Math.cos(r), i[2] = o[2], e[0] = i[0] + n[0], e[1] = i[1] + n[1], e[2] = i[2] + n[2], e;
}
function Rt(e, t) {
  var n = e[0], r = e[1], o = e[2], i = t[0], s = t[1], a = t[2], l = Math.sqrt(n * n + r * r + o * o), p = Math.sqrt(i * i + s * s + a * a), c = l * p, d = c && ve(e, t) / c;
  return Math.acos(Math.min(Math.max(d, -1), 1));
}
function St(e) {
  return e[0] = 0, e[1] = 0, e[2] = 0, e;
}
function bt(e) {
  return "vec3(" + e[0] + ", " + e[1] + ", " + e[2] + ")";
}
function kt(e, t) {
  return e[0] === t[0] && e[1] === t[1] && e[2] === t[2];
}
function Dt(e, t) {
  var n = e[0], r = e[1], o = e[2], i = t[0], s = t[1], a = t[2];
  return Math.abs(n - i) <= U * Math.max(1, Math.abs(n), Math.abs(i)) && Math.abs(r - s) <= U * Math.max(1, Math.abs(r), Math.abs(s)) && Math.abs(o - a) <= U * Math.max(1, Math.abs(o), Math.abs(a));
}
var Ot = ce;
var At = le;
var It = pe;
var Vt = de;
var Tt = me;
var zt = ae;
var Nt = ue;
var Ut = function() {
  var e = se();
  return function(t, n, r, o, i, s) {
    var a, l;
    for (n || (n = 3), r || (r = 0), o ? l = Math.min(o * n + r, t.length) : l = t.length, a = r; a < l; a += n) e[0] = t[a], e[1] = t[a + 1], e[2] = t[a + 2], i(e, e, s), t[a] = e[0], t[a + 1] = e[1], t[a + 2] = e[2];
    return t;
  };
}();
function fe(e) {
  return (t) => import_react9.default.createElement(Y, { overlay: e, ...t });
}
var _a, _e_instances, e_fn;
var Y = (_a = class extends import_react9.default.Component {
  constructor() {
    super(...arguments);
    __privateAdd(this, _e_instances);
    __publicField(this, "state", { screen_position: F.create(), z_index: 0, scale: 1, is_visible: false, translation: [0, 0] });
  }
  componentDidMount() {
    __privateMethod(this, _e_instances, e_fn).call(this), this.props.overlay._registerElement(this);
  }
  componentDidUpdate(t) {
    (t.worldPosition.some((n, r) => n !== this.props.worldPosition[r]) || t.anchor !== this.props.anchor || t.scaleFactor !== this.props.scaleFactor) && (__privateMethod(this, _e_instances, e_fn).call(this), this.props.overlay._updateElement());
  }
  componentWillUnmount() {
    this.props.overlay._unregisterElement(this);
  }
  get screen_position() {
    return this.state.screen_position;
  }
  get world_position() {
    return this.props.worldPosition;
  }
  get scale_factor() {
    return this.props.scaleFactor;
  }
  setProjection(t) {
    this.setState(t);
  }
  render() {
    if (!this.state.is_visible) return null;
    let t = `
            translate(${this.state.translation[0]}%, ${this.state.translation[1]}%)
            translate(${this.state.screen_position[0]}px, ${this.state.screen_position[1]}px)`;
    return (0, import_react_dom.createPortal)(import_react9.default.createElement("div", { style: { position: "absolute", transform: t, zIndex: this.state.z_index, pointerEvents: "auto" } }, this.scale_factor ? import_react9.default.createElement("div", { style: { transform: `scale(${this.state.scale})` } }, this.props.children) : this.props.children), this.props.overlay.container);
  }
}, _e_instances = new WeakSet(), e_fn = function() {
  if (this.props.anchor === "center") {
    this.setState({ translation: [_a.HorizontalAnchorPositions.center, _a.VerticalAnchorPositions.center] });
    return;
  }
  let [t, n] = this.props.anchor.split("-");
  this.setState({ translation: [_a.HorizontalAnchorPositions[t], _a.VerticalAnchorPositions[n]] });
}, __publicField(_a, "VerticalAnchorPositions", { top: 0, center: -50, bottom: -100 }), __publicField(_a, "HorizontalAnchorPositions", { left: 0, center: -50, right: -100 }), _a);
var Ht = 1e5;
var _e2, _t2, _n, _W_instances, r_fn, o_fn, _a2;
var W = (_a2 = class {
  constructor({ container: t, viewport: n }) {
    __privateAdd(this, _W_instances);
    __publicField(this, "container");
    __privateAdd(this, _e2, /* @__PURE__ */ new Set());
    __privateAdd(this, _t2);
    __privateAdd(this, _n);
    this.container = t, __privateSet(this, _t2, n), __privateSet(this, _n, fe(this));
  }
  get DOM3DElement() {
    return __privateGet(this, _n);
  }
  _registerElement(t) {
    __privateGet(this, _e2).add(t), __privateGet(this, _t2).rendering_surface.redrawLastFrame();
  }
  _unregisterElement(t) {
    __privateGet(this, _e2).delete(t) || console.warn("Element ref not found in dom overlay");
  }
  _updateElement() {
    __privateGet(this, _t2).rendering_surface.redrawLastFrame();
  }
  resize({ width: t, height: n }) {
    this.container.style.width = t + "px", this.container.style.height = n + "px";
  }
  draw() {
    return __privateGet(this, _t2).isValid() && this.updateElements(), null;
  }
  updateElements() {
    let t = [];
    for (let n of __privateGet(this, _e2).values()) {
      let r = __privateMethod(this, _W_instances, r_fn).call(this, { react_element: n });
      t.push({ projection: r, react_element: n });
    }
    t.sort((n, r) => r.projection.screen_position[2] - n.projection.screen_position[2]), t.forEach(({ projection: n, react_element: r }, o) => {
      r.setProjection({ ...n, z_index: o });
    });
  }
  release() {
    setTimeout(() => {
      __privateGet(this, _e2).clear();
    }, 0);
  }
}, _e2 = new WeakMap(), _t2 = new WeakMap(), _n = new WeakMap(), _W_instances = new WeakSet(), r_fn = function({ react_element: t }) {
  let n = __privateGet(this, _t2).projectWorldToScreen({ world_position: t.world_position, out_screen_position: t.screen_position }), r = t.scale_factor ? __privateMethod(this, _W_instances, o_fn).call(this, { screen_position: n, scale_factor: t.scale_factor }) : 1, o = n[2] < 1 && n[2] > 0;
  return { screen_position: n, scale: r, is_visible: o };
}, o_fn = function({ screen_position: t, scale_factor: n }) {
  var _a3, _b, _c;
  let r = (_a3 = __privateGet(this, _t2).camera_projection) == null ? void 0 : _a3.camera_entity;
  if (!r) throw new Error("Viewport has no camera");
  let o = (r.perspective_lens ? r.perspective_lens.nearPlane : (_b = r.orthographic_lens) == null ? void 0 : _b.zFar) ?? 0;
  return (((r.perspective_lens ? r.perspective_lens.farPlane || Ht : (_c = r.orthographic_lens) == null ? void 0 : _c.zNear) ?? 1) - o) * (1 - t[2]) * n;
}, _a2);
var Q = (0, import_react8.createContext)(null);
function pr({ children: e, ...t }) {
  let n = (0, import_react8.useRef)(null), [r, o] = (0, import_react8.useState)(null), { viewport: i } = (0, import_react8.useContext)(O);
  return (0, import_react8.useEffect)(() => {
    if (!i || !n.current) return;
    let s = new W({ container: n.current, viewport: i });
    return i.addOverlay({ overlay: s }), o(s), () => {
      i.removeOverlay({ overlay: s });
    };
  }, [i, n]), import_react8.default.createElement(Q.Provider, { value: r }, import_react8.default.createElement("div", { ref: n, "data-role": "dom-3d-overlay", style: { position: "absolute", width: "100%", height: "100%", top: "0", pointerEvents: "none", padding: "inherit", overflow: "hidden" }, ...t }, e));
}
function ye({ worldPosition: e, anchor: t = "center", scaleFactor: n, children: r }) {
  let o = (0, import_react10.useContext)(Q);
  return o ? import_react10.default.createElement(o.DOM3DElement, { worldPosition: e, anchor: t, scaleFactor: n }, r) : null;
}
function Cr({ entity: e, scaleFactor: t, anchor: n, children: r }) {
  let [o, i] = (0, import_react11.useState)(e ? e.global_transform.position : [0, 0, 0]), [s, a] = (0, import_react11.useState)(e ? e.is_visible : false);
  return (0, import_react11.useEffect)(() => {
    if (!e) return;
    let l = () => i(e.global_transform.position), p = () => a(e.is_visible);
    return l(), p(), e.addEventListener("on-entity-updated", l), e.addEventListener("on-entity-visibility-changed", p), () => {
      e.removeEventListener("on-entity-updated", l), e.removeEventListener("on-entity-visibility-changed", p);
    };
  }, [e]), !e || !s ? null : import_react11.default.createElement(ye, { worldPosition: o, anchor: n, scaleFactor: t }, r);
}
typeof window < "u" && (window.__LIVELINK__ || (window.__LIVELINK__ = {}), Object.prototype.hasOwnProperty.call(window.__LIVELINK__, "@3dverse/livelink-react") ? console.warn("⚠️ WARNING ⚠️ Multiple instances of Livelink React ⚛️ being imported.") : window.__LIVELINK__["@3dverse/livelink-react"] = "0.2.49");

export {
  P,
  nn,
  ee,
  pn,
  un,
  k,
  gn,
  O,
  Dn,
  Ye,
  Un,
  Jn,
  fe,
  Y,
  W,
  Q,
  pr,
  ye,
  Cr
};
//# sourceMappingURL=chunk-P4RZCITW.js.map
